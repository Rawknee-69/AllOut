{"file_contents":{"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n          border: \"var(--success-border)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n          border: \"var(--warning-border)\",\n        },\n        gamification: {\n          DEFAULT: \"hsl(var(--gamification) / <alpha-value>)\",\n          foreground: \"hsl(var(--gamification-foreground) / <alpha-value>)\",\n          border: \"var(--gamification-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4679},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, boolean, timestamp, jsonb, index } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (required for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table with Replit Auth integration and degree/class information\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  degree: text(\"degree\"),\n  className: text(\"class_name\"),\n  totalStudyTime: integer(\"total_study_time\").notNull().default(0), // in minutes\n  currentStreak: integer(\"current_streak\").notNull().default(0), // days\n  longestStreak: integer(\"longest_streak\").notNull().default(0), // days\n  lastStudyDate: timestamp(\"last_study_date\"),\n  totalQuizScore: integer(\"total_quiz_score\").notNull().default(0),\n  quizzesCompleted: integer(\"quizzes_completed\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Study materials (PDFs uploaded by users)\nexport const studyMaterials = pgTable(\"study_materials\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  fileName: text(\"file_name\").notNull(),\n  fileUrl: text(\"file_url\").notNull(), // Object storage URL\n  fileSize: integer(\"file_size\").notNull(), // in bytes\n  uploadedAt: timestamp(\"uploaded_at\").notNull().defaultNow(),\n});\n\n// Flashcards generated from study materials\nexport const flashcards = pgTable(\"flashcards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  materialId: varchar(\"material_id\").references(() => studyMaterials.id, { onDelete: \"cascade\" }),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  isAIGenerated: boolean(\"is_ai_generated\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Quizzes with questions and answers\nexport const quizzes = pgTable(\"quizzes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  materialId: varchar(\"material_id\").references(() => studyMaterials.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  questions: jsonb(\"questions\").notNull(), // Array of {question, options, correctAnswer}\n  isAIGenerated: boolean(\"is_ai_generated\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Quiz attempts with scores and tab-switch tracking\nexport const quizAttempts = pgTable(\"quiz_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  quizId: varchar(\"quiz_id\").notNull().references(() => quizzes.id, { onDelete: \"cascade\" }),\n  score: integer(\"score\").notNull(),\n  totalQuestions: integer(\"total_questions\").notNull(),\n  tabSwitchCount: integer(\"tab_switch_count\").notNull().default(0),\n  isCancelled: boolean(\"is_cancelled\").notNull().default(false), // Cancelled due to tab switching\n  completedAt: timestamp(\"completed_at\").notNull().defaultNow(),\n});\n\n// Mind maps generated from study materials\nexport const mindMaps = pgTable(\"mind_maps\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  materialId: varchar(\"material_id\").notNull().references(() => studyMaterials.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  content: jsonb(\"content\").notNull(), // Node structure for mind map\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// AI-generated summaries\nexport const summaries = pgTable(\"summaries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  materialId: varchar(\"material_id\").notNull().references(() => studyMaterials.id, { onDelete: \"cascade\" }),\n  content: text(\"content\").notNull(),\n  audioUrl: text(\"audio_url\"), // URL to Deepgram-generated audio in object storage\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Study sessions for tracking focused time\nexport const studySessions = pgTable(\"study_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  startTime: timestamp(\"start_time\").notNull().defaultNow(),\n  endTime: timestamp(\"end_time\"),\n  duration: integer(\"duration\").notNull().default(0), // in minutes\n  tabSwitches: integer(\"tab_switches\").notNull().default(0),\n  timeWasted: integer(\"time_wasted\").notNull().default(0), // in minutes\n  isConcentrationMode: boolean(\"is_concentration_mode\").notNull().default(false),\n  pauseCount: integer(\"pause_count\").notNull().default(0), // number of times paused\n  pauseDuration: integer(\"pause_duration\").notNull().default(0), // total pause time in seconds\n  pauseReasons: jsonb(\"pause_reasons\").default(sql`'[]'::jsonb`), // Array of {reason, duration, timestamp}\n});\n\n// Todo list items\nexport const todos = pgTable(\"todos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  isCompleted: boolean(\"is_completed\").notNull().default(false),\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Pomodoro sessions\nexport const pomodoroSessions = pgTable(\"pomodoro_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  workDuration: integer(\"work_duration\").notNull(), // in minutes\n  breakDuration: integer(\"break_duration\").notNull(), // in minutes\n  completedCycles: integer(\"completed_cycles\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Chat messages with AI\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  materialId: varchar(\"material_id\").references(() => studyMaterials.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull(), // 'user' or 'assistant'\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Collaboration sessions for group study\nexport const collabSessions = pgTable(\"collab_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  hostUserId: varchar(\"host_user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  sessionCode: varchar(\"session_code\", { length: 10 }).notNull().unique(), // For invitations\n  isActive: boolean(\"is_active\").notNull().default(true),\n  concentrationMode: boolean(\"concentration_mode\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  endedAt: timestamp(\"ended_at\"),\n});\n\n// Participants in collaboration sessions\nexport const collabParticipants = pgTable(\"collab_participants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").notNull().references(() => collabSessions.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  role: text(\"role\").notNull().default(\"member\"), // 'host' or 'member'\n  isMuted: boolean(\"is_muted\").notNull().default(false),\n  isBanned: boolean(\"is_banned\").notNull().default(false),\n  tabSwitches: integer(\"tab_switches\").notNull().default(0),\n  pauseCount: integer(\"pause_count\").notNull().default(0),\n  isOnBreak: boolean(\"is_on_break\").notNull().default(false),\n  breakStartTime: timestamp(\"break_start_time\"),\n  breakDuration: integer(\"break_duration\").notNull().default(0), // in seconds\n  joinedAt: timestamp(\"joined_at\").notNull().defaultNow(),\n  leftAt: timestamp(\"left_at\"),\n});\n\n// Whiteboard data for collaboration sessions\nexport const collabWhiteboards = pgTable(\"collab_whiteboards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").notNull().references(() => collabSessions.id, { onDelete: \"cascade\" }).unique(),\n  content: jsonb(\"content\").notNull().default(sql`'{}'::jsonb`), // Canvas drawing data\n  lastSavedAt: timestamp(\"last_saved_at\").notNull().defaultNow(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Activity tracking for collaboration sessions\nexport const collabActivities = pgTable(\"collab_activities\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").notNull().references(() => collabSessions.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  activityType: text(\"activity_type\").notNull(), // 'tab_switch', 'pause', 'unpause', 'break_start', 'break_end', 'join', 'leave'\n  metadata: jsonb(\"metadata\"), // Additional activity data\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Group chat messages in collaboration sessions\nexport const collabChatMessages = pgTable(\"collab_chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").notNull().references(() => collabSessions.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"idx_chat_session_created\").on(table.sessionId, table.createdAt),\n]);\n\n// Presentation files (pictures/PDFs) shared in collaboration sessions\nexport const collabPresentations = pgTable(\"collab_presentations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").notNull().references(() => collabSessions.id, { onDelete: \"cascade\" }),\n  uploadedBy: varchar(\"uploaded_by\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  fileName: text(\"file_name\").notNull(),\n  fileUrl: text(\"file_url\").notNull(), // Object storage URL\n  fileType: text(\"file_type\").notNull(), // 'image' or 'pdf'\n  currentPage: integer(\"current_page\").notNull().default(1), // For PDF navigation\n  isActive: boolean(\"is_active\").notNull().default(false), // Currently being presented\n  uploadedAt: timestamp(\"uploaded_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"idx_presentation_session\").on(table.sessionId),\n  // Ensure only one active presentation per session\n  index(\"idx_presentation_active_session\").on(table.sessionId).where(sql`${table.isActive} = true`),\n]);\n\n// Presentation editor permissions (normalized join table)\nexport const collabPresentationEditors = pgTable(\"collab_presentation_editors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  presentationId: varchar(\"presentation_id\").notNull().references(() => collabPresentations.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  grantedAt: timestamp(\"granted_at\").notNull().defaultNow(),\n}, (table) => [\n  index(\"idx_presentation_user\").on(table.presentationId, table.userId),\n]);\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  totalStudyTime: true,\n  currentStreak: true,\n  longestStreak: true,\n  lastStudyDate: true,\n  totalQuizScore: true,\n  quizzesCompleted: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const upsertUserSchema = createInsertSchema(users).pick({\n  id: true,\n  email: true,\n  firstName: true,\n  lastName: true,\n  profileImageUrl: true,\n});\n\nexport const updateUserProfileSchema = createInsertSchema(users).pick({\n  degree: true,\n  className: true,\n});\n\nexport const insertStudyMaterialSchema = createInsertSchema(studyMaterials).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertFlashcardSchema = createInsertSchema(flashcards).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQuizSchema = createInsertSchema(quizzes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertQuizAttemptSchema = createInsertSchema(quizAttempts).omit({\n  id: true,\n  completedAt: true,\n});\n\nexport const insertMindMapSchema = createInsertSchema(mindMaps).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSummarySchema = createInsertSchema(summaries).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStudySessionSchema = createInsertSchema(studySessions).omit({\n  id: true,\n  startTime: true,\n});\n\nexport const insertTodoSchema = createInsertSchema(todos).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPomodoroSessionSchema = createInsertSchema(pomodoroSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCollabSessionSchema = createInsertSchema(collabSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCollabParticipantSchema = createInsertSchema(collabParticipants).omit({\n  id: true,\n  joinedAt: true,\n});\n\nexport const insertCollabWhiteboardSchema = createInsertSchema(collabWhiteboards).omit({\n  id: true,\n  createdAt: true,\n  lastSavedAt: true,\n});\n\nexport const insertCollabActivitySchema = createInsertSchema(collabActivities).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCollabChatMessageSchema = createInsertSchema(collabChatMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCollabPresentationSchema = createInsertSchema(collabPresentations).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertCollabPresentationEditorSchema = createInsertSchema(collabPresentationEditors).omit({\n  id: true,\n  grantedAt: true,\n});\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type UpsertUser = z.infer<typeof upsertUserSchema>;\nexport type UpdateUserProfile = z.infer<typeof updateUserProfileSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertStudyMaterial = z.infer<typeof insertStudyMaterialSchema>;\nexport type StudyMaterial = typeof studyMaterials.$inferSelect;\n\nexport type InsertFlashcard = z.infer<typeof insertFlashcardSchema>;\nexport type Flashcard = typeof flashcards.$inferSelect;\n\n// Quiz question type structure\nexport interface QuizQuestion {\n  question: string;\n  options: string[];\n  correctAnswer: string;\n}\n\nexport type InsertQuiz = z.infer<typeof insertQuizSchema>;\nexport type Quiz = typeof quizzes.$inferSelect;\n\n// Extended Quiz type with properly typed questions array\nexport interface QuizWithQuestions extends Omit<Quiz, 'questions'> {\n  questions: QuizQuestion[];\n}\n\nexport type InsertQuizAttempt = z.infer<typeof insertQuizAttemptSchema>;\nexport type QuizAttempt = typeof quizAttempts.$inferSelect;\n\nexport type InsertMindMap = z.infer<typeof insertMindMapSchema>;\nexport type MindMap = typeof mindMaps.$inferSelect;\n\nexport type InsertSummary = z.infer<typeof insertSummarySchema>;\nexport type Summary = typeof summaries.$inferSelect;\n\nexport type InsertStudySession = z.infer<typeof insertStudySessionSchema>;\nexport type StudySession = typeof studySessions.$inferSelect;\n\nexport type InsertTodo = z.infer<typeof insertTodoSchema>;\nexport type Todo = typeof todos.$inferSelect;\n\nexport type InsertPomodoroSession = z.infer<typeof insertPomodoroSessionSchema>;\nexport type PomodoroSession = typeof pomodoroSessions.$inferSelect;\n\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\n\nexport type InsertCollabSession = z.infer<typeof insertCollabSessionSchema>;\nexport type CollabSession = typeof collabSessions.$inferSelect;\n\nexport type InsertCollabParticipant = z.infer<typeof insertCollabParticipantSchema>;\nexport type CollabParticipant = typeof collabParticipants.$inferSelect;\n\nexport type InsertCollabWhiteboard = z.infer<typeof insertCollabWhiteboardSchema>;\nexport type CollabWhiteboard = typeof collabWhiteboards.$inferSelect;\n\nexport type InsertCollabActivity = z.infer<typeof insertCollabActivitySchema>;\nexport type CollabActivity = typeof collabActivities.$inferSelect;\n\nexport type InsertCollabChatMessage = z.infer<typeof insertCollabChatMessageSchema>;\nexport type CollabChatMessage = typeof collabChatMessages.$inferSelect;\n\nexport type InsertCollabPresentation = z.infer<typeof insertCollabPresentationSchema>;\nexport type CollabPresentation = typeof collabPresentations.$inferSelect;\n\nexport type InsertCollabPresentationEditor = z.infer<typeof insertCollabPresentationEditorSchema>;\nexport type CollabPresentationEditor = typeof collabPresentationEditors.$inferSelect;\n","size_bytes":17683},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { BookOpen, Brain, Target, Trophy, Timer, Zap } from \"lucide-react\";\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"border-b\">\n        <div className=\"container mx-auto px-4 py-4 flex justify-between items-center\">\n          <div className=\"flex items-center gap-2\">\n            <BookOpen className=\"h-8 w-8 text-primary\" data-testid=\"logo-icon\" />\n            <span className=\"text-2xl font-heading font-bold\" data-testid=\"logo-text\">All Out</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <ThemeToggle />\n            <Button asChild data-testid=\"button-login\">\n              <a href=\"/api/login\">Sign In</a>\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <section className=\"relative py-20 md:py-32 overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-secondary/5 to-gamification/5\" />\n        <div className=\"container mx-auto px-4 relative\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <h1 className=\"font-heading font-bold text-4xl md:text-6xl mb-6 bg-gradient-to-r from-primary via-secondary to-gamification bg-clip-text text-transparent\" data-testid=\"text-hero-title\">\n              All Out\n            </h1>\n            <p className=\"text-xl md:text-2xl text-muted-foreground mb-8\" data-testid=\"text-hero-subtitle\">\n              Transform your PDFs into flashcards, quizzes, mind maps, and summaries with cutting-edge AI. Track your progress, compete on leaderboards, and master your studies.\n            </p>\n            <div className=\"flex flex-wrap gap-4 justify-center\">\n              <Button size=\"lg\" asChild className=\"text-lg\" data-testid=\"button-get-started\">\n                <a href=\"/api/login\">Get Started Free</a>\n              </Button>\n              <Button size=\"lg\" variant=\"outline\" className=\"text-lg\" asChild data-testid=\"button-learn-more\">\n                <a href=\"#features\">Learn More</a>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <section id=\"features\" className=\"py-16 md:py-24\">\n        <div className=\"container mx-auto px-4\">\n          <h2 className=\"font-heading font-bold text-3xl md:text-4xl text-center mb-12\" data-testid=\"text-features-title\">\n            Powerful AI Study Tools\n          </h2>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-ai-chat\">\n              <Brain className=\"h-12 w-12 text-primary mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">AI Study Chat</h3>\n              <p className=\"text-muted-foreground\">\n                Ask questions about your study materials and get instant, intelligent answers from our AI assistant.\n              </p>\n            </Card>\n\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-flashcards\">\n              <Zap className=\"h-12 w-12 text-secondary mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">Auto Flashcards</h3>\n              <p className=\"text-muted-foreground\">\n                Generate flashcards automatically from your PDFs using AI. Review and master key concepts effortlessly.\n              </p>\n            </Card>\n\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-quizzes\">\n              <Target className=\"h-12 w-12 text-success mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">Smart Quizzes</h3>\n              <p className=\"text-muted-foreground\">\n                AI-generated quizzes with anti-cheat tab detection. Test your knowledge and track your scores.\n              </p>\n            </Card>\n\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-mind-maps\">\n              <BookOpen className=\"h-12 w-12 text-warning mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">Mind Maps</h3>\n              <p className=\"text-muted-foreground\">\n                Visualize complex topics with AI-generated mind maps. See connections and understand concepts better.\n              </p>\n            </Card>\n\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-leaderboards\">\n              <Trophy className=\"h-12 w-12 text-gamification mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">Global Leaderboards</h3>\n              <p className=\"text-muted-foreground\">\n                Compete with students worldwide. Earn points for study time, quiz scores, and maintain daily streaks.\n              </p>\n            </Card>\n\n            <Card className=\"p-6 hover-elevate\" data-testid=\"card-feature-productivity\">\n              <Timer className=\"h-12 w-12 text-destructive mb-4\" />\n              <h3 className=\"font-heading font-semibold text-xl mb-2\">Productivity Tools</h3>\n              <p className=\"text-muted-foreground\">\n                Pomodoro timer, todo lists, and concentration mode with focus tracking to maximize your study sessions.\n              </p>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-16 md:py-24 bg-gradient-to-br from-primary/10 to-secondary/10\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-3xl mx-auto text-center\">\n            <h2 className=\"font-heading font-bold text-3xl md:text-4xl mb-6\" data-testid=\"text-cta-title\">\n              Ready to Transform Your Study Experience?\n            </h2>\n            <p className=\"text-xl text-muted-foreground mb-8\" data-testid=\"text-cta-subtitle\">\n              Join thousands of students who are already mastering their subjects with AI-powered learning tools.\n            </p>\n            <Button size=\"lg\" asChild className=\"text-lg\" data-testid=\"button-cta-start\">\n              <a href=\"/api/login\">Start Learning Today</a>\n            </Button>\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-12 border-t\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"grid md:grid-cols-4 gap-8\">\n            <div>\n              <h4 className=\"font-heading font-semibold mb-3\">Product</h4>\n              <ul className=\"space-y-2 text-muted-foreground\">\n                <li><a href=\"#features\" className=\"hover-elevate\">Features</a></li>\n                <li><a href=\"/api/login\" className=\"hover-elevate\">Pricing</a></li>\n                <li><a href=\"/api/login\" className=\"hover-elevate\">Dashboard</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-heading font-semibold mb-3\">Resources</h4>\n              <ul className=\"space-y-2 text-muted-foreground\">\n                <li><a href=\"#features\" className=\"hover-elevate\">How It Works</a></li>\n                <li><a href=\"#features\" className=\"hover-elevate\">Study Guides</a></li>\n                <li><a href=\"#features\" className=\"hover-elevate\">Blog</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-heading font-semibold mb-3\">Company</h4>\n              <ul className=\"space-y-2 text-muted-foreground\">\n                <li><a href=\"#features\" className=\"hover-elevate\">About Us</a></li>\n                <li><a href=\"#features\" className=\"hover-elevate\">Contact</a></li>\n                <li><a href=\"#features\" className=\"hover-elevate\">Careers</a></li>\n              </ul>\n            </div>\n            <div>\n              <h4 className=\"font-heading font-semibold mb-3\">Legal</h4>\n              <ul className=\"space-y-2 text-muted-foreground\">\n                <li><a href=\"#features\" className=\"hover-elevate\">Privacy Policy</a></li>\n                <li><a href=\"#features\" className=\"hover-elevate\">Terms of Service</a></li>\n              </ul>\n            </div>\n          </div>\n          <div className=\"mt-8 pt-8 border-t text-center text-muted-foreground\">\n            <p data-testid=\"text-copyright\">Â© 2024 StudyMaster. All rights reserved.</p>\n          </div>\n        </div>\n      </section>\n    </div>\n  );\n}\n","size_bytes":8354},"client/src/pages/dashboard.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Brain, FileText, Target, Trophy, Timer, CheckSquare, Flame } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ntype StudySession = {\n  id: string;\n  duration: number;\n  isConcentrationMode: boolean;\n  startTime: string;\n};\n\ntype QuizAttempt = {\n  id: string;\n  score: number;\n  isCancelled: boolean;\n};\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading, user } = useAuth();\n\n  const { data: studySessions } = useQuery<StudySession[]>({\n    queryKey: [\"/api/study-sessions\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: quizAttempts } = useQuery<QuizAttempt[]>({\n    queryKey: [\"/api/quiz-attempts\"],\n    enabled: isAuthenticated,\n  });\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  const needsProfile = !user.degree || !user.className;\n\n  const totalStudyTime = studySessions?.reduce((total, session) => total + session.duration, 0) || 0;\n  \n  const completedQuizzes = quizAttempts?.filter((a) => !a.isCancelled) || [];\n  const averageQuizScore = completedQuizzes.length > 0\n    ? Math.round(completedQuizzes.reduce((sum, a) => sum + a.score, 0) / completedQuizzes.length)\n    : 0;\n\n  const calculateStreak = () => {\n    if (!studySessions || studySessions.length === 0) return 0;\n    \n    const focusSessions = studySessions\n      .filter((s) => s.duration >= 30)\n      .sort((a, b) => new Date(b.startTime).getTime() - new Date(a.startTime).getTime());\n    \n    if (focusSessions.length === 0) return 0;\n    \n    let streak = 0;\n    let currentDate = new Date();\n    currentDate.setHours(0, 0, 0, 0);\n    \n    for (const session of focusSessions) {\n      const sessionDate = new Date(session.startTime);\n      sessionDate.setHours(0, 0, 0, 0);\n      \n      const diffDays = Math.floor((currentDate.getTime() - sessionDate.getTime()) / (1000 * 60 * 60 * 24));\n      \n      if (diffDays === streak) {\n        streak++;\n      } else if (diffDays > streak) {\n        break;\n      }\n    }\n    \n    return streak;\n  };\n\n  const currentStreak = calculateStreak();\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"font-heading font-bold text-3xl md:text-4xl mb-2\" data-testid=\"text-welcome\">\n          Welcome back, {user.firstName || user.email}!\n        </h1>\n        <p className=\"text-muted-foreground\" data-testid=\"text-subtitle\">\n          {needsProfile ? \"Complete your profile to get started\" : \"Ready to continue learning?\"}\n        </p>\n      </div>\n\n      {needsProfile && (\n        <Card className=\"p-6 mb-8 bg-warning/10 border-warning\" data-testid=\"card-complete-profile\">\n          <h3 className=\"font-heading font-semibold text-xl mb-2\">Complete Your Profile</h3>\n          <p className=\"text-muted-foreground mb-4\">\n            Add your degree and class information to unlock personalized study features.\n          </p>\n          <Button asChild data-testid=\"button-complete-profile\">\n            <Link href=\"/profile\">Complete Profile</Link>\n          </Button>\n        </Card>\n      )}\n\n      <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n        <Card className=\"p-6\" data-testid=\"card-study-time\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"p-3 rounded-lg bg-primary/10\">\n              <Timer className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\" data-testid=\"text-study-time\">\n                {Math.floor(totalStudyTime / 60)}h {totalStudyTime % 60}m\n              </p>\n              <p className=\"text-sm text-muted-foreground\">Total Study Time</p>\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\" data-testid=\"card-streak\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"p-3 rounded-lg bg-gamification/10\">\n              <Flame className=\"h-6 w-6 text-gamification\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\" data-testid=\"text-streak\">{currentStreak} days</p>\n              <p className=\"text-sm text-muted-foreground\">Current Streak</p>\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\" data-testid=\"card-quiz-score\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"p-3 rounded-lg bg-success/10\">\n              <Trophy className=\"h-6 w-6 text-success\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\" data-testid=\"text-quiz-score\">{averageQuizScore}%</p>\n              <p className=\"text-sm text-muted-foreground\">Average Quiz Score</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      <h2 className=\"font-heading font-semibold text-2xl mb-6\">Quick Access</h2>\n      <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Link href=\"/materials\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-materials\">\n            <BookOpen className=\"h-10 w-10 text-primary mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Study Materials</h3>\n            <p className=\"text-sm text-muted-foreground\">Upload and manage PDFs</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/chat\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-ai-chat\">\n            <Brain className=\"h-10 w-10 text-secondary mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">AI Chat</h3>\n            <p className=\"text-sm text-muted-foreground\">Ask study questions</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/flashcards\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-flashcards\">\n            <FileText className=\"h-10 w-10 text-warning mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Flashcards</h3>\n            <p className=\"text-sm text-muted-foreground\">Study with AI cards</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/quizzes\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-quizzes\">\n            <Target className=\"h-10 w-10 text-success mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Quizzes</h3>\n            <p className=\"text-sm text-muted-foreground\">Test your knowledge</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/leaderboard\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-leaderboard\">\n            <Trophy className=\"h-10 w-10 text-gamification mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Leaderboard</h3>\n            <p className=\"text-sm text-muted-foreground\">See your rankings</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/todos\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-todos\">\n            <CheckSquare className=\"h-10 w-10 text-primary mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">To-Do List</h3>\n            <p className=\"text-sm text-muted-foreground\">Manage your tasks</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/pomodoro\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-pomodoro\">\n            <Timer className=\"h-10 w-10 text-destructive mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Pomodoro</h3>\n            <p className=\"text-sm text-muted-foreground\">Focus timer</p>\n          </Card>\n        </Link>\n\n        <Link href=\"/concentration\">\n          <Card className=\"p-6 hover-elevate cursor-pointer\" data-testid=\"card-concentration\">\n            <Brain className=\"h-10 w-10 text-secondary mb-3\" />\n            <h3 className=\"font-heading font-semibold text-lg mb-1\">Concentration</h3>\n            <p className=\"text-sm text-muted-foreground\">Focus mode</p>\n          </Card>\n        </Link>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8965},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { eq, desc, sql, gt } from \"drizzle-orm\";\nimport type {\n  User,\n  InsertUser,\n  UpsertUser,\n  UpdateUserProfile,\n  StudyMaterial,\n  InsertStudyMaterial,\n  Flashcard,\n  InsertFlashcard,\n  Quiz,\n  InsertQuiz,\n  QuizAttempt,\n  InsertQuizAttempt,\n  MindMap,\n  InsertMindMap,\n  Summary,\n  InsertSummary,\n  StudySession,\n  InsertStudySession,\n  Todo,\n  InsertTodo,\n  PomodoroSession,\n  InsertPomodoroSession,\n  ChatMessage,\n  InsertChatMessage,\n  CollabSession,\n  InsertCollabSession,\n  CollabParticipant,\n  InsertCollabParticipant,\n  CollabWhiteboard,\n  InsertCollabWhiteboard,\n  CollabActivity,\n  InsertCollabActivity,\n  CollabChatMessage,\n  InsertCollabChatMessage,\n  CollabPresentation,\n  InsertCollabPresentation,\n  CollabPresentationEditor,\n  InsertCollabPresentationEditor,\n} from \"@shared/schema\";\nimport {\n  users,\n  studyMaterials,\n  flashcards,\n  quizzes,\n  quizAttempts,\n  mindMaps,\n  summaries,\n  studySessions,\n  todos,\n  pomodoroSessions,\n  chatMessages,\n  collabSessions,\n  collabParticipants,\n  collabWhiteboards,\n  collabActivities,\n  collabChatMessages,\n  collabPresentations,\n  collabPresentationEditors,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  updateUserProfile(userId: string, profile: UpdateUserProfile): Promise<User | undefined>;\n  updateUserStats(\n    userId: string,\n    stats: {\n      totalStudyTime?: number;\n      currentStreak?: number;\n      longestStreak?: number;\n      lastStudyDate?: Date;\n      totalQuizScore?: number;\n      quizzesCompleted?: number;\n    }\n  ): Promise<User | undefined>;\n  getTopUsersByStudyTime(limit: number): Promise<User[]>;\n  getTopUsersByQuizScore(limit: number): Promise<User[]>;\n\n  // Study Material operations\n  getStudyMaterial(id: string): Promise<StudyMaterial | undefined>;\n  getStudyMaterialsByUser(userId: string): Promise<StudyMaterial[]>;\n  createStudyMaterial(material: InsertStudyMaterial): Promise<StudyMaterial>;\n  deleteStudyMaterial(id: string): Promise<void>;\n\n  // Flashcard operations\n  getFlashcard(id: string): Promise<Flashcard | undefined>;\n  getFlashcardsByUser(userId: string): Promise<Flashcard[]>;\n  getFlashcardsByMaterial(materialId: string): Promise<Flashcard[]>;\n  createFlashcard(flashcard: InsertFlashcard): Promise<Flashcard>;\n  deleteFlashcard(id: string): Promise<void>;\n\n  // Quiz operations\n  getQuiz(id: string): Promise<Quiz | undefined>;\n  getQuizzesByUser(userId: string): Promise<Quiz[]>;\n  getQuizzesByMaterial(materialId: string): Promise<Quiz[]>;\n  createQuiz(quiz: InsertQuiz): Promise<Quiz>;\n  deleteQuiz(id: string): Promise<void>;\n\n  // Quiz Attempt operations\n  getQuizAttempt(id: string): Promise<QuizAttempt | undefined>;\n  getQuizAttemptsByUser(userId: string): Promise<QuizAttempt[]>;\n  getQuizAttemptsByQuiz(quizId: string): Promise<QuizAttempt[]>;\n  createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt>;\n\n  // Mind Map operations\n  getMindMap(id: string): Promise<MindMap | undefined>;\n  getMindMapsByUser(userId: string): Promise<MindMap[]>;\n  getMindMapsByMaterial(materialId: string): Promise<MindMap[]>;\n  createMindMap(mindMap: InsertMindMap): Promise<MindMap>;\n  deleteMindMap(id: string): Promise<void>;\n\n  // Summary operations\n  getSummary(id: string): Promise<Summary | undefined>;\n  getSummariesByUser(userId: string): Promise<Summary[]>;\n  getSummaryByMaterial(materialId: string): Promise<Summary | undefined>;\n  createSummary(summary: InsertSummary): Promise<Summary>;\n  updateSummary(id: string, updates: Partial<InsertSummary>): Promise<Summary | undefined>;\n  deleteSummary(id: string): Promise<void>;\n\n  // Study Session operations\n  getStudySession(id: string): Promise<StudySession | undefined>;\n  getStudySessionsByUser(userId: string): Promise<StudySession[]>;\n  createStudySession(session: InsertStudySession): Promise<StudySession>;\n  updateStudySession(\n    id: string,\n    updates: Partial<InsertStudySession>\n  ): Promise<StudySession | undefined>;\n\n  // Todo operations\n  getTodo(id: string): Promise<Todo | undefined>;\n  getTodosByUser(userId: string): Promise<Todo[]>;\n  createTodo(todo: InsertTodo): Promise<Todo>;\n  updateTodo(id: string, updates: Partial<InsertTodo>): Promise<Todo | undefined>;\n  deleteTodo(id: string): Promise<void>;\n\n  // Pomodoro operations\n  getPomodoroSession(id: string): Promise<PomodoroSession | undefined>;\n  getPomodoroSessionsByUser(userId: string): Promise<PomodoroSession[]>;\n  createPomodoroSession(session: InsertPomodoroSession): Promise<PomodoroSession>;\n\n  // Chat Message operations\n  getChatMessage(id: string): Promise<ChatMessage | undefined>;\n  getChatMessagesByUser(userId: string): Promise<ChatMessage[]>;\n  getChatMessagesByMaterial(materialId: string): Promise<ChatMessage[]>;\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n  deleteChatMessagesByMaterial(materialId: string): Promise<void>;\n\n  // Collaboration Session operations\n  getCollabSession(id: string): Promise<CollabSession | undefined>;\n  getCollabSessionByCode(code: string): Promise<CollabSession | undefined>;\n  getCollabSessionsByHost(hostUserId: string): Promise<CollabSession[]>;\n  getActiveCollabSessionsByHost(hostUserId: string): Promise<CollabSession[]>;\n  createCollabSession(session: InsertCollabSession): Promise<CollabSession>;\n  updateCollabSession(id: string, updates: Partial<InsertCollabSession>): Promise<CollabSession | undefined>;\n  endCollabSession(id: string): Promise<CollabSession | undefined>;\n\n  // Collaboration Participant operations\n  getCollabParticipant(id: string): Promise<CollabParticipant | undefined>;\n  getCollabParticipantsBySession(sessionId: string): Promise<CollabParticipant[]>;\n  getActiveCollabParticipantsBySession(sessionId: string): Promise<CollabParticipant[]>;\n  getCollabParticipantByUserAndSession(userId: string, sessionId: string): Promise<CollabParticipant | undefined>;\n  createCollabParticipant(participant: InsertCollabParticipant): Promise<CollabParticipant>;\n  updateCollabParticipant(id: string, updates: Partial<InsertCollabParticipant>): Promise<CollabParticipant | undefined>;\n  removeCollabParticipant(id: string): Promise<void>;\n\n  // Collaboration Whiteboard operations\n  getCollabWhiteboard(id: string): Promise<CollabWhiteboard | undefined>;\n  getCollabWhiteboardBySession(sessionId: string): Promise<CollabWhiteboard | undefined>;\n  createCollabWhiteboard(whiteboard: InsertCollabWhiteboard): Promise<CollabWhiteboard>;\n  updateCollabWhiteboard(id: string, updates: Partial<InsertCollabWhiteboard>): Promise<CollabWhiteboard | undefined>;\n\n  // Collaboration Activity operations\n  getCollabActivity(id: string): Promise<CollabActivity | undefined>;\n  getCollabActivitiesBySession(sessionId: string): Promise<CollabActivity[]>;\n  createCollabActivity(activity: InsertCollabActivity): Promise<CollabActivity>;\n\n  // Collaboration Chat Message operations\n  getCollabChatMessage(id: string): Promise<CollabChatMessage | undefined>;\n  getCollabChatMessagesBySession(sessionId: string): Promise<CollabChatMessage[]>;\n  createCollabChatMessage(message: InsertCollabChatMessage): Promise<CollabChatMessage>;\n\n  // Collaboration Presentation operations\n  getCollabPresentation(id: string): Promise<CollabPresentation | undefined>;\n  getCollabPresentationsBySession(sessionId: string): Promise<CollabPresentation[]>;\n  getActiveCollabPresentation(sessionId: string): Promise<CollabPresentation | undefined>;\n  createCollabPresentation(presentation: InsertCollabPresentation): Promise<CollabPresentation>;\n  updateCollabPresentation(id: string, updates: Partial<InsertCollabPresentation>): Promise<CollabPresentation | undefined>;\n  \n  // Collaboration Presentation Editor operations\n  getCollabPresentationEditors(presentationId: string): Promise<CollabPresentationEditor[]>;\n  hasCollabPresentationEditPermission(presentationId: string, userId: string): Promise<boolean>;\n  grantCollabPresentationEdit(editor: InsertCollabPresentationEditor): Promise<CollabPresentationEditor>;\n  revokeCollabPresentationEdit(presentationId: string, userId: string): Promise<void>;\n}\n\nexport class DbStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id));\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.email, email));\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    // Try to insert, handle conflict on either id or email\n    try {\n      const result = await db\n        .insert(users)\n        .values(userData)\n        .onConflictDoUpdate({\n          target: users.id,\n          set: {\n            email: userData.email,\n            firstName: userData.firstName,\n            lastName: userData.lastName,\n            profileImageUrl: userData.profileImageUrl,\n            updatedAt: new Date(),\n          },\n        })\n        .returning();\n      return result[0];\n    } catch (error: any) {\n      // If conflict is on email instead of id, update by email\n      if (error?.code === '23505' && error?.detail?.includes('email')) {\n        const result = await db\n          .update(users)\n          .set({\n            id: userData.id,\n            firstName: userData.firstName,\n            lastName: userData.lastName,\n            profileImageUrl: userData.profileImageUrl,\n            updatedAt: new Date(),\n          })\n          .where(eq(users.email, userData.email!))\n          .returning();\n        if (result[0]) {\n          return result[0];\n        }\n      }\n      throw error;\n    }\n  }\n\n  async updateUserProfile(userId: string, profile: UpdateUserProfile): Promise<User | undefined> {\n    const result = await db\n      .update(users)\n      .set({ ...profile, updatedAt: new Date() })\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  async updateUserStats(\n    userId: string,\n    stats: {\n      totalStudyTime?: number;\n      currentStreak?: number;\n      longestStreak?: number;\n      lastStudyDate?: Date;\n      totalQuizScore?: number;\n      quizzesCompleted?: number;\n    }\n  ): Promise<User | undefined> {\n    const result = await db.update(users).set(stats).where(eq(users.id, userId)).returning();\n    return result[0];\n  }\n\n  async getTopUsersByStudyTime(limit: number): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .where(gt(users.totalStudyTime, 0))\n      .orderBy(desc(users.totalStudyTime))\n      .limit(limit);\n  }\n\n  async getTopUsersByQuizScore(limit: number): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .where(gt(users.quizzesCompleted, 0))\n      .orderBy(desc(users.totalQuizScore))\n      .limit(limit);\n  }\n\n  // Study Material operations\n  async getStudyMaterial(id: string): Promise<StudyMaterial | undefined> {\n    const result = await db.select().from(studyMaterials).where(eq(studyMaterials.id, id));\n    return result[0];\n  }\n\n  async getStudyMaterialsByUser(userId: string): Promise<StudyMaterial[]> {\n    return await db\n      .select()\n      .from(studyMaterials)\n      .where(eq(studyMaterials.userId, userId))\n      .orderBy(desc(studyMaterials.uploadedAt));\n  }\n\n  async createStudyMaterial(material: InsertStudyMaterial): Promise<StudyMaterial> {\n    const result = await db.insert(studyMaterials).values(material).returning();\n    return result[0];\n  }\n\n  async deleteStudyMaterial(id: string): Promise<void> {\n    await db.delete(studyMaterials).where(eq(studyMaterials.id, id));\n  }\n\n  // Flashcard operations\n  async getFlashcard(id: string): Promise<Flashcard | undefined> {\n    const result = await db.select().from(flashcards).where(eq(flashcards.id, id));\n    return result[0];\n  }\n\n  async getFlashcardsByUser(userId: string): Promise<Flashcard[]> {\n    return await db\n      .select()\n      .from(flashcards)\n      .where(eq(flashcards.userId, userId))\n      .orderBy(desc(flashcards.createdAt));\n  }\n\n  async getFlashcardsByMaterial(materialId: string): Promise<Flashcard[]> {\n    return await db\n      .select()\n      .from(flashcards)\n      .where(eq(flashcards.materialId, materialId))\n      .orderBy(desc(flashcards.createdAt));\n  }\n\n  async createFlashcard(flashcard: InsertFlashcard): Promise<Flashcard> {\n    const result = await db.insert(flashcards).values(flashcard).returning();\n    return result[0];\n  }\n\n  async deleteFlashcard(id: string): Promise<void> {\n    await db.delete(flashcards).where(eq(flashcards.id, id));\n  }\n\n  // Quiz operations\n  async getQuiz(id: string): Promise<Quiz | undefined> {\n    const result = await db.select().from(quizzes).where(eq(quizzes.id, id));\n    return result[0];\n  }\n\n  async getQuizzesByUser(userId: string): Promise<Quiz[]> {\n    return await db\n      .select()\n      .from(quizzes)\n      .where(eq(quizzes.userId, userId))\n      .orderBy(desc(quizzes.createdAt));\n  }\n\n  async getQuizzesByMaterial(materialId: string): Promise<Quiz[]> {\n    return await db\n      .select()\n      .from(quizzes)\n      .where(eq(quizzes.materialId, materialId))\n      .orderBy(desc(quizzes.createdAt));\n  }\n\n  async createQuiz(quiz: InsertQuiz): Promise<Quiz> {\n    const result = await db.insert(quizzes).values(quiz).returning();\n    return result[0];\n  }\n\n  async deleteQuiz(id: string): Promise<void> {\n    await db.delete(quizzes).where(eq(quizzes.id, id));\n  }\n\n  // Quiz Attempt operations\n  async getQuizAttempt(id: string): Promise<QuizAttempt | undefined> {\n    const result = await db.select().from(quizAttempts).where(eq(quizAttempts.id, id));\n    return result[0];\n  }\n\n  async getQuizAttemptsByUser(userId: string): Promise<QuizAttempt[]> {\n    return await db\n      .select()\n      .from(quizAttempts)\n      .where(eq(quizAttempts.userId, userId))\n      .orderBy(desc(quizAttempts.completedAt));\n  }\n\n  async getQuizAttemptsByQuiz(quizId: string): Promise<QuizAttempt[]> {\n    return await db\n      .select()\n      .from(quizAttempts)\n      .where(eq(quizAttempts.quizId, quizId))\n      .orderBy(desc(quizAttempts.completedAt));\n  }\n\n  async createQuizAttempt(attempt: InsertQuizAttempt): Promise<QuizAttempt> {\n    const result = await db.insert(quizAttempts).values(attempt).returning();\n    return result[0];\n  }\n\n  // Mind Map operations\n  async getMindMap(id: string): Promise<MindMap | undefined> {\n    const result = await db.select().from(mindMaps).where(eq(mindMaps.id, id));\n    return result[0];\n  }\n\n  async getMindMapsByUser(userId: string): Promise<MindMap[]> {\n    return await db\n      .select()\n      .from(mindMaps)\n      .where(eq(mindMaps.userId, userId))\n      .orderBy(desc(mindMaps.createdAt));\n  }\n\n  async getMindMapsByMaterial(materialId: string): Promise<MindMap[]> {\n    return await db\n      .select()\n      .from(mindMaps)\n      .where(eq(mindMaps.materialId, materialId))\n      .orderBy(desc(mindMaps.createdAt));\n  }\n\n  async createMindMap(mindMap: InsertMindMap): Promise<MindMap> {\n    const result = await db.insert(mindMaps).values(mindMap).returning();\n    return result[0];\n  }\n\n  async deleteMindMap(id: string): Promise<void> {\n    await db.delete(mindMaps).where(eq(mindMaps.id, id));\n  }\n\n  // Summary operations\n  async getSummary(id: string): Promise<Summary | undefined> {\n    const result = await db.select().from(summaries).where(eq(summaries.id, id));\n    return result[0];\n  }\n\n  async getSummariesByUser(userId: string): Promise<Summary[]> {\n    return await db\n      .select()\n      .from(summaries)\n      .where(eq(summaries.userId, userId))\n      .orderBy(desc(summaries.createdAt));\n  }\n\n  async getSummaryByMaterial(materialId: string): Promise<Summary | undefined> {\n    const result = await db\n      .select()\n      .from(summaries)\n      .where(eq(summaries.materialId, materialId))\n      .orderBy(desc(summaries.createdAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async createSummary(summary: InsertSummary): Promise<Summary> {\n    const result = await db.insert(summaries).values(summary).returning();\n    return result[0];\n  }\n\n  async updateSummary(id: string, updates: Partial<InsertSummary>): Promise<Summary | undefined> {\n    const result = await db.update(summaries).set(updates).where(eq(summaries.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteSummary(id: string): Promise<void> {\n    await db.delete(summaries).where(eq(summaries.id, id));\n  }\n\n  // Study Session operations\n  async getStudySession(id: string): Promise<StudySession | undefined> {\n    const result = await db.select().from(studySessions).where(eq(studySessions.id, id));\n    return result[0];\n  }\n\n  async getStudySessionsByUser(userId: string): Promise<StudySession[]> {\n    return await db\n      .select()\n      .from(studySessions)\n      .where(eq(studySessions.userId, userId))\n      .orderBy(desc(studySessions.startTime));\n  }\n\n  async createStudySession(session: InsertStudySession): Promise<StudySession> {\n    const result = await db.insert(studySessions).values(session).returning();\n    return result[0];\n  }\n\n  async updateStudySession(\n    id: string,\n    updates: Partial<InsertStudySession>\n  ): Promise<StudySession | undefined> {\n    const result = await db\n      .update(studySessions)\n      .set(updates)\n      .where(eq(studySessions.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Todo operations\n  async getTodo(id: string): Promise<Todo | undefined> {\n    const result = await db.select().from(todos).where(eq(todos.id, id));\n    return result[0];\n  }\n\n  async getTodosByUser(userId: string): Promise<Todo[]> {\n    return await db\n      .select()\n      .from(todos)\n      .where(eq(todos.userId, userId))\n      .orderBy(desc(todos.createdAt));\n  }\n\n  async createTodo(todo: InsertTodo): Promise<Todo> {\n    const result = await db.insert(todos).values(todo).returning();\n    return result[0];\n  }\n\n  async updateTodo(id: string, updates: Partial<InsertTodo>): Promise<Todo | undefined> {\n    const result = await db.update(todos).set(updates).where(eq(todos.id, id)).returning();\n    return result[0];\n  }\n\n  async deleteTodo(id: string): Promise<void> {\n    await db.delete(todos).where(eq(todos.id, id));\n  }\n\n  // Pomodoro operations\n  async getPomodoroSession(id: string): Promise<PomodoroSession | undefined> {\n    const result = await db.select().from(pomodoroSessions).where(eq(pomodoroSessions.id, id));\n    return result[0];\n  }\n\n  async getPomodoroSessionsByUser(userId: string): Promise<PomodoroSession[]> {\n    return await db\n      .select()\n      .from(pomodoroSessions)\n      .where(eq(pomodoroSessions.userId, userId))\n      .orderBy(desc(pomodoroSessions.createdAt));\n  }\n\n  async createPomodoroSession(session: InsertPomodoroSession): Promise<PomodoroSession> {\n    const result = await db.insert(pomodoroSessions).values(session).returning();\n    return result[0];\n  }\n\n  // Chat Message operations\n  async getChatMessage(id: string): Promise<ChatMessage | undefined> {\n    const result = await db.select().from(chatMessages).where(eq(chatMessages.id, id));\n    return result[0];\n  }\n\n  async getChatMessagesByUser(userId: string): Promise<ChatMessage[]> {\n    return await db\n      .select()\n      .from(chatMessages)\n      .where(eq(chatMessages.userId, userId))\n      .orderBy(desc(chatMessages.createdAt));\n  }\n\n  async getChatMessagesByMaterial(materialId: string): Promise<ChatMessage[]> {\n    return await db\n      .select()\n      .from(chatMessages)\n      .where(eq(chatMessages.materialId, materialId))\n      .orderBy(chatMessages.createdAt);\n  }\n\n  async createChatMessage(message: InsertChatMessage): Promise<ChatMessage> {\n    const result = await db.insert(chatMessages).values(message).returning();\n    return result[0];\n  }\n\n  async deleteChatMessagesByMaterial(materialId: string): Promise<void> {\n    await db.delete(chatMessages).where(eq(chatMessages.materialId, materialId));\n  }\n\n  // Collaboration Session operations\n  async getCollabSession(id: string): Promise<CollabSession | undefined> {\n    const result = await db.select().from(collabSessions).where(eq(collabSessions.id, id));\n    return result[0];\n  }\n\n  async getCollabSessionByCode(code: string): Promise<CollabSession | undefined> {\n    const result = await db.select().from(collabSessions).where(eq(collabSessions.sessionCode, code));\n    return result[0];\n  }\n\n  async getCollabSessionsByHost(hostUserId: string): Promise<CollabSession[]> {\n    return await db\n      .select()\n      .from(collabSessions)\n      .where(eq(collabSessions.hostUserId, hostUserId))\n      .orderBy(desc(collabSessions.createdAt));\n  }\n\n  async getActiveCollabSessionsByHost(hostUserId: string): Promise<CollabSession[]> {\n    return await db\n      .select()\n      .from(collabSessions)\n      .where(sql`${collabSessions.hostUserId} = ${hostUserId} AND ${collabSessions.isActive} = true`)\n      .orderBy(desc(collabSessions.createdAt));\n  }\n\n  async createCollabSession(session: InsertCollabSession): Promise<CollabSession> {\n    const result = await db.insert(collabSessions).values(session).returning();\n    return result[0];\n  }\n\n  async updateCollabSession(id: string, updates: Partial<InsertCollabSession>): Promise<CollabSession | undefined> {\n    const result = await db\n      .update(collabSessions)\n      .set(updates)\n      .where(eq(collabSessions.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async endCollabSession(id: string): Promise<CollabSession | undefined> {\n    const result = await db\n      .update(collabSessions)\n      .set({ isActive: false, endedAt: new Date() })\n      .where(eq(collabSessions.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Collaboration Participant operations\n  async getCollabParticipant(id: string): Promise<CollabParticipant | undefined> {\n    const result = await db.select().from(collabParticipants).where(eq(collabParticipants.id, id));\n    return result[0];\n  }\n\n  async getCollabParticipantsBySession(sessionId: string): Promise<CollabParticipant[]> {\n    return await db\n      .select()\n      .from(collabParticipants)\n      .where(eq(collabParticipants.sessionId, sessionId))\n      .orderBy(collabParticipants.joinedAt);\n  }\n\n  async getActiveCollabParticipantsBySession(sessionId: string): Promise<CollabParticipant[]> {\n    return await db\n      .select()\n      .from(collabParticipants)\n      .where(sql`${collabParticipants.sessionId} = ${sessionId} AND ${collabParticipants.leftAt} IS NULL`)\n      .orderBy(collabParticipants.joinedAt);\n  }\n\n  async getCollabParticipantByUserAndSession(userId: string, sessionId: string): Promise<CollabParticipant | undefined> {\n    const result = await db\n      .select()\n      .from(collabParticipants)\n      .where(sql`${collabParticipants.userId} = ${userId} AND ${collabParticipants.sessionId} = ${sessionId} AND ${collabParticipants.leftAt} IS NULL`);\n    return result[0];\n  }\n\n  async createCollabParticipant(participant: InsertCollabParticipant): Promise<CollabParticipant> {\n    const result = await db.insert(collabParticipants).values(participant).returning();\n    return result[0];\n  }\n\n  async updateCollabParticipant(id: string, updates: Partial<InsertCollabParticipant>): Promise<CollabParticipant | undefined> {\n    const result = await db\n      .update(collabParticipants)\n      .set(updates)\n      .where(eq(collabParticipants.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async removeCollabParticipant(id: string): Promise<void> {\n    await db\n      .update(collabParticipants)\n      .set({ leftAt: new Date() })\n      .where(eq(collabParticipants.id, id));\n  }\n\n  // Collaboration Whiteboard operations\n  async getCollabWhiteboard(id: string): Promise<CollabWhiteboard | undefined> {\n    const result = await db.select().from(collabWhiteboards).where(eq(collabWhiteboards.id, id));\n    return result[0];\n  }\n\n  async getCollabWhiteboardBySession(sessionId: string): Promise<CollabWhiteboard | undefined> {\n    const result = await db.select().from(collabWhiteboards).where(eq(collabWhiteboards.sessionId, sessionId));\n    return result[0];\n  }\n\n  async createCollabWhiteboard(whiteboard: InsertCollabWhiteboard): Promise<CollabWhiteboard> {\n    const result = await db.insert(collabWhiteboards).values(whiteboard).returning();\n    return result[0];\n  }\n\n  async updateCollabWhiteboard(id: string, updates: Partial<InsertCollabWhiteboard>): Promise<CollabWhiteboard | undefined> {\n    const result = await db\n      .update(collabWhiteboards)\n      .set({ ...updates, lastSavedAt: new Date() })\n      .where(eq(collabWhiteboards.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Collaboration Activity operations\n  async getCollabActivity(id: string): Promise<CollabActivity | undefined> {\n    const result = await db.select().from(collabActivities).where(eq(collabActivities.id, id));\n    return result[0];\n  }\n\n  async getCollabActivitiesBySession(sessionId: string): Promise<CollabActivity[]> {\n    return await db\n      .select()\n      .from(collabActivities)\n      .where(eq(collabActivities.sessionId, sessionId))\n      .orderBy(collabActivities.createdAt);\n  }\n\n  async createCollabActivity(activity: InsertCollabActivity): Promise<CollabActivity> {\n    const result = await db.insert(collabActivities).values(activity).returning();\n    return result[0];\n  }\n\n  // Collaboration Chat Message operations\n  async getCollabChatMessage(id: string): Promise<CollabChatMessage | undefined> {\n    const result = await db.select().from(collabChatMessages).where(eq(collabChatMessages.id, id));\n    return result[0];\n  }\n\n  async getCollabChatMessagesBySession(sessionId: string): Promise<CollabChatMessage[]> {\n    return await db\n      .select()\n      .from(collabChatMessages)\n      .where(eq(collabChatMessages.sessionId, sessionId))\n      .orderBy(collabChatMessages.createdAt);\n  }\n\n  async createCollabChatMessage(message: InsertCollabChatMessage): Promise<CollabChatMessage> {\n    const result = await db.insert(collabChatMessages).values(message).returning();\n    return result[0];\n  }\n\n  // Collaboration Presentation operations\n  async getCollabPresentation(id: string): Promise<CollabPresentation | undefined> {\n    const result = await db.select().from(collabPresentations).where(eq(collabPresentations.id, id));\n    return result[0];\n  }\n\n  async getCollabPresentationsBySession(sessionId: string): Promise<CollabPresentation[]> {\n    return await db\n      .select()\n      .from(collabPresentations)\n      .where(eq(collabPresentations.sessionId, sessionId))\n      .orderBy(collabPresentations.uploadedAt);\n  }\n\n  async getActiveCollabPresentation(sessionId: string): Promise<CollabPresentation | undefined> {\n    const result = await db\n      .select()\n      .from(collabPresentations)\n      .where(sql`${collabPresentations.sessionId} = ${sessionId} AND ${collabPresentations.isActive} = true`);\n    return result[0];\n  }\n\n  async createCollabPresentation(presentation: InsertCollabPresentation): Promise<CollabPresentation> {\n    const result = await db.insert(collabPresentations).values(presentation).returning();\n    return result[0];\n  }\n\n  async updateCollabPresentation(id: string, updates: Partial<InsertCollabPresentation>): Promise<CollabPresentation | undefined> {\n    const result = await db\n      .update(collabPresentations)\n      .set(updates)\n      .where(eq(collabPresentations.id, id))\n      .returning();\n    return result[0];\n  }\n\n  // Collaboration Presentation Editor operations\n  async getCollabPresentationEditors(presentationId: string): Promise<CollabPresentationEditor[]> {\n    return await db\n      .select()\n      .from(collabPresentationEditors)\n      .where(eq(collabPresentationEditors.presentationId, presentationId));\n  }\n\n  async hasCollabPresentationEditPermission(presentationId: string, userId: string): Promise<boolean> {\n    const result = await db\n      .select()\n      .from(collabPresentationEditors)\n      .where(sql`${collabPresentationEditors.presentationId} = ${presentationId} AND ${collabPresentationEditors.userId} = ${userId}`);\n    return result.length > 0;\n  }\n\n  async grantCollabPresentationEdit(editor: InsertCollabPresentationEditor): Promise<CollabPresentationEditor> {\n    const result = await db.insert(collabPresentationEditors).values(editor).returning();\n    return result[0];\n  }\n\n  async revokeCollabPresentationEdit(presentationId: string, userId: string): Promise<void> {\n    await db\n      .delete(collabPresentationEditors)\n      .where(sql`${collabPresentationEditors.presentationId} = ${presentationId} AND ${collabPresentationEditors.userId} = ${userId}`);\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":28988},"client/src/pages/profile.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { User } from \"lucide-react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { useLocation } from \"wouter\";\n\nexport default function Profile() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const [degree, setDegree] = useState(\"\");\n  const [className, setClassName] = useState(\"\");\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n\n    if (user) {\n      setDegree(user.degree || \"\");\n      setClassName(user.className || \"\");\n    }\n  }, [isAuthenticated, isLoading, user, toast]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { degree: string; className: string }) => {\n      return await apiRequest(\"PATCH\", \"/api/user/profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been updated successfully.\",\n      });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!degree.trim() || !className.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    updateProfileMutation.mutate({ degree: degree.trim(), className: className.trim() });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-2xl\">\n      <div className=\"flex items-center gap-3 mb-6\">\n        <User className=\"h-8 w-8 text-primary\" />\n        <h1 className=\"font-heading font-bold text-3xl\" data-testid=\"text-profile-title\">\n          Complete Your Profile\n        </h1>\n      </div>\n\n      <Card className=\"p-6\" data-testid=\"card-profile-form\">\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div>\n            <Label htmlFor=\"email\">Email</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              value={user.email || \"\"}\n              disabled\n              className=\"bg-muted\"\n              data-testid=\"input-email\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"degree\">Degree / Program *</Label>\n            <Input\n              id=\"degree\"\n              type=\"text\"\n              value={degree}\n              onChange={(e) => setDegree(e.target.value)}\n              placeholder=\"e.g., Computer Science, Business Administration\"\n              required\n              data-testid=\"input-degree\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"className\">Class / Year *</Label>\n            <Input\n              id=\"className\"\n              type=\"text\"\n              value={className}\n              onChange={(e) => setClassName(e.target.value)}\n              placeholder=\"e.g., Freshman, Sophomore, Junior, Senior, Graduate\"\n              required\n              data-testid=\"input-class\"\n            />\n          </div>\n\n          <div className=\"flex gap-4\">\n            <Button\n              type=\"submit\"\n              disabled={updateProfileMutation.isPending}\n              className=\"flex-1\"\n              data-testid=\"button-save-profile\"\n            >\n              {updateProfileMutation.isPending ? \"Saving...\" : \"Save Profile\"}\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setLocation(\"/\")}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5297},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/pages/materials.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useEffect, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Upload, FileText, Trash2, Download, BookOpen, Sparkles } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { StudyMaterial } from \"@shared/schema\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport default function Materials() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: materials, isLoading } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      \n      const response = await fetch(\"/api/study-materials/upload\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.text();\n        throw new Error(error || \"Failed to upload file\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-materials\"] });\n      toast({\n        title: \"Success\",\n        description: \"PDF uploaded successfully!\",\n      });\n      setSelectedFile(null);\n      setIsUploading(false);\n    },\n    onError: (error: Error) => {\n      setIsUploading(false);\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload PDF\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/study-materials/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-materials\"] });\n      toast({\n        title: \"Deleted\",\n        description: \"Study material deleted successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete material\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.type !== \"application/pdf\") {\n        toast({\n          title: \"Invalid File\",\n          description: \"Please select a PDF file\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  const handleUpload = () => {\n    if (!selectedFile) {\n      toast({\n        title: \"No File Selected\",\n        description: \"Please select a PDF file to upload\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsUploading(true);\n    uploadMutation.mutate(selectedFile);\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(2) + \" MB\";\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-7xl\">\n      <motion.div \n        className=\"mb-8 md:mb-12\"\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n      >\n        <div className=\"flex items-center gap-3 mb-3\">\n          <div className=\"p-2 rounded-lg bg-primary/10\">\n            <BookOpen className=\"h-6 w-6 md:h-8 md:w-8 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h1 className=\"font-heading font-bold text-2xl md:text-4xl\" data-testid=\"text-materials-title\">\n              Study Materials\n            </h1>\n          </div>\n        </div>\n        <p className=\"text-muted-foreground text-sm md:text-base ml-14\" data-testid=\"text-materials-subtitle\">\n          Upload your PDF study materials to unlock AI-powered features\n        </p>\n      </motion.div>\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n      >\n        <Card className=\"p-4 md:p-8 mb-8 md:mb-12 border-2\" data-testid=\"card-upload\">\n          <div className=\"flex items-center gap-2 mb-6\">\n            <Sparkles className=\"h-5 w-5 text-primary\" />\n            <h2 className=\"font-heading font-semibold text-lg md:text-xl\">Upload New Material</h2>\n          </div>\n          <div className=\"flex flex-col lg:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <label\n                htmlFor=\"pdf-upload\"\n                className=\"group relative flex flex-col items-center justify-center w-full h-40 md:h-48 border-2 border-dashed rounded-xl cursor-pointer transition-all duration-300 hover:border-primary hover:bg-primary/5 overflow-visible\"\n                data-testid=\"label-upload\"\n              >\n                <motion.div \n                  className=\"flex flex-col items-center justify-center\"\n                  whileHover={{ scale: 1.05 }}\n                  transition={{ type: \"spring\", stiffness: 300 }}\n                >\n                  <div className=\"p-3 rounded-full bg-primary/10 mb-3 group-hover:bg-primary/20 transition-colors\">\n                    <Upload className=\"h-8 w-8 md:h-10 md:w-10 text-primary\" />\n                  </div>\n                  <p className=\"text-sm md:text-base font-medium text-foreground mb-1\">\n                    {selectedFile ? (\n                      <span className=\"text-primary\">{selectedFile.name}</span>\n                    ) : (\n                      \"Click to upload or drag and drop\"\n                    )}\n                  </p>\n                  <p className=\"text-xs md:text-sm text-muted-foreground\">PDF files only (max 50MB)</p>\n                </motion.div>\n                <input\n                  id=\"pdf-upload\"\n                  type=\"file\"\n                  accept=\".pdf,application/pdf\"\n                  className=\"hidden\"\n                  onChange={handleFileChange}\n                  data-testid=\"input-file\"\n                />\n              </label>\n            </div>\n            <div className=\"flex lg:items-end\">\n              <Button\n                onClick={handleUpload}\n                disabled={!selectedFile || isUploading}\n                size=\"lg\"\n                className=\"w-full lg:w-auto\"\n                data-testid=\"button-upload\"\n              >\n                {isUploading ? (\n                  <>\n                    <div className=\"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-primary-foreground border-t-transparent\"></div>\n                    Uploading...\n                  </>\n                ) : (\n                  <>\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    Upload PDF\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </Card>\n      </motion.div>\n\n      {isLoading ? (\n        <div className=\"text-center py-12\">\n          <div className=\"inline-block h-10 w-10 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground font-medium\">Loading materials...</p>\n        </div>\n      ) : materials && materials.length > 0 ? (\n        <>\n          <div className=\"mb-4 flex items-center justify-between\">\n            <p className=\"text-sm text-muted-foreground\">\n              {materials.length} {materials.length === 1 ? 'material' : 'materials'} uploaded\n            </p>\n          </div>\n          <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\n            <AnimatePresence mode=\"popLayout\">\n              {materials.map((material, index) => (\n                <motion.div\n                  key={material.id}\n                  initial={{ opacity: 0, scale: 0.9, y: 20 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.9, y: -20 }}\n                  transition={{\n                    duration: 0.3,\n                    delay: index * 0.05,\n                    ease: \"easeOut\"\n                  }}\n                  layout\n                >\n                  <Card\n                    className=\"group p-5 md:p-6 hover-elevate transition-all duration-300 h-full flex flex-col border-2\"\n                    data-testid={`card-material-${material.id}`}\n                  >\n                    <div className=\"flex items-start gap-4 mb-4\">\n                      <div className=\"p-2.5 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors flex-shrink-0\">\n                        <FileText className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h3\n                          className=\"font-semibold text-base md:text-lg mb-1.5 truncate group-hover:text-primary transition-colors\"\n                          data-testid={`text-material-title-${material.id}`}\n                          title={material.title}\n                        >\n                          {material.title}\n                        </h3>\n                        <div className=\"flex items-center gap-3 text-xs md:text-sm text-muted-foreground\">\n                          <span className=\"font-medium\">{formatFileSize(material.fileSize)}</span>\n                          <span>â¢</span>\n                          <span>{new Date(material.uploadedAt).toLocaleDateString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex gap-2 mt-auto\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"default\"\n                        className=\"flex-1\"\n                        asChild\n                        data-testid={`button-view-${material.id}`}\n                      >\n                        <a href={`/materials/${material.id}`}>\n                          <BookOpen className=\"h-4 w-4 mr-1.5\" />\n                          Open\n                        </a>\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => deleteMutation.mutate(material.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-${material.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </Card>\n                </motion.div>\n              ))}\n            </AnimatePresence>\n          </div>\n        </>\n      ) : (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.2 }}\n        >\n          <Card className=\"p-8 md:p-12 text-center border-2 border-dashed\" data-testid=\"card-empty-state\">\n            <div className=\"p-4 rounded-full bg-muted inline-block mb-4\">\n              <FileText className=\"h-12 w-12 md:h-16 md:w-16 text-muted-foreground\" />\n            </div>\n            <h3 className=\"font-heading font-semibold text-lg md:text-xl mb-2\">No Study Materials Yet</h3>\n            <p className=\"text-muted-foreground text-sm md:text-base mb-6 max-w-md mx-auto\">\n              Upload your first PDF to get started with AI-powered learning tools like flashcards, quizzes, and summaries\n            </p>\n            <div className=\"inline-flex items-center gap-2 text-sm text-muted-foreground\">\n              <div className=\"h-1.5 w-1.5 rounded-full bg-primary animate-pulse\"></div>\n              <span>Ready to transform your study experience</span>\n            </div>\n          </Card>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","size_bytes":13733},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","size_bytes":116},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/app-sidebar.tsx":{"content":"import {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport {\n  BookOpen,\n  Brain,\n  FileText,\n  Target,\n  Map,\n  FileStack,\n  Volume2,\n  Trophy,\n  CheckSquare,\n  Timer,\n  Focus,\n  Users,\n  User,\n  LogOut,\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\nconst studyItems = [\n  { title: \"Study Materials\", url: \"/materials\", icon: BookOpen },\n  { title: \"AI Chat\", url: \"/chat\", icon: Brain },\n  { title: \"Flashcards\", url: \"/flashcards\", icon: FileText },\n  { title: \"Quizzes\", url: \"/quizzes\", icon: Target },\n  { title: \"Mind Maps\", url: \"/mind-maps\", icon: Map },\n  { title: \"Summaries\", url: \"/summaries\", icon: FileStack },\n  { title: \"Audio Library\", url: \"/audio-library\", icon: Volume2 },\n];\n\nconst gamificationItems = [\n  { title: \"Leaderboards\", url: \"/leaderboard\", icon: Trophy },\n];\n\nconst productivityItems = [\n  { title: \"To-Do List\", url: \"/todos\", icon: CheckSquare },\n  { title: \"Pomodoro\", url: \"/pomodoro\", icon: Timer },\n  { title: \"Concentration\", url: \"/concentration\", icon: Focus },\n  { title: \"Collaboration\", url: \"/collab\", icon: Users },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const userInitials = user?.firstName && user?.lastName\n    ? `${user.firstName[0]}${user.lastName[0]}`\n    : user?.email?.[0]?.toUpperCase() || \"U\";\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <div className=\"flex items-center gap-2\">\n          <BookOpen className=\"h-6 w-6 text-primary\" />\n          <span className=\"font-heading font-bold text-xl\">All Out</span>\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>Study Tools</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {studyItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`sidebar-${item.title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon />\n                      <span>{item.title}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>Progress</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {gamificationItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`sidebar-${item.title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon />\n                      <span>{item.title}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <SidebarGroup>\n          <SidebarGroupLabel>Productivity</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {productivityItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url}\n                    data-testid={`sidebar-${item.title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n                  >\n                    <a href={item.url}>\n                      <item.icon />\n                      <span>{item.title}</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        <SidebarMenu>\n          <SidebarMenuItem>\n            <SidebarMenuButton asChild data-testid=\"sidebar-profile\">\n              <a href=\"/profile\" className=\"flex items-center gap-3\">\n                <Avatar className=\"h-8 w-8\">\n                  <AvatarImage src={user?.profileImageUrl || undefined} />\n                  <AvatarFallback>{userInitials}</AvatarFallback>\n                </Avatar>\n                <div className=\"flex flex-col\">\n                  <span className=\"text-sm font-medium\">\n                    {user?.firstName || user?.email}\n                  </span>\n                  <span className=\"text-xs text-muted-foreground\">Profile</span>\n                </div>\n              </a>\n            </SidebarMenuButton>\n          </SidebarMenuItem>\n          <SidebarMenuItem>\n            <SidebarMenuButton asChild data-testid=\"sidebar-logout\">\n              <a href=\"/api/logout\" className=\"text-destructive\">\n                <LogOut />\n                <span>Sign Out</span>\n              </a>\n            </SidebarMenuButton>\n          </SidebarMenuItem>\n        </SidebarMenu>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","size_bytes":5527},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport multer from \"multer\";\nimport { GoogleGenAI } from \"@google/genai\";\nimport { generateAudioFromText } from \"./deepgram\";\nimport { objectStorage } from \"./objectStorage\";\nimport { setObjectAclPolicy } from \"./objectAcl\";\nimport { sanitizeMarkdown, sanitizeUserInput, sanitizeForAudio, sanitizeMindMapNode } from \"./textUtils\";\nimport { setupCollabWebSocket } from \"./collabWebSocket\";\nimport {\n  insertStudyMaterialSchema,\n  insertFlashcardSchema,\n  insertQuizSchema,\n  insertQuizAttemptSchema,\n  insertMindMapSchema,\n  insertSummarySchema,\n  insertStudySessionSchema,\n  insertTodoSchema,\n  insertPomodoroSessionSchema,\n  insertChatMessageSchema,\n  updateUserProfileSchema,\n  insertCollabSessionSchema,\n  insertCollabParticipantSchema,\n  insertCollabWhiteboardSchema,\n  insertCollabActivitySchema,\n} from \"@shared/schema\";\n\n// Initialize Gemini AI\nconst genAI = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY! });\n\n// Setup multer for file uploads (in-memory storage)\nconst upload = multer({ storage: multer.memoryStorage() });\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n\n  // Auth routes\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // User profile routes\n  app.patch(\"/api/user/profile\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const profileData = updateUserProfileSchema.parse(req.body);\n      const updatedUser = await storage.updateUserProfile(userId, profileData);\n      res.json(updatedUser);\n    } catch (error: any) {\n      console.error(\"Error updating profile:\", error);\n      res.status(400).json({ message: error.message || \"Failed to update profile\" });\n    }\n  });\n\n  // Study Materials routes\n  app.get(\"/api/study-materials\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const materials = await storage.getStudyMaterialsByUser(userId);\n      res.json(materials);\n    } catch (error) {\n      console.error(\"Error fetching study materials:\", error);\n      res.status(500).json({ message: \"Failed to fetch study materials\" });\n    }\n  });\n\n  app.get(\"/api/study-materials/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const material = await storage.getStudyMaterial(req.params.id);\n      if (!material) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n      // Verify ownership\n      if (material.userId !== req.user.claims.sub) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n      res.json(material);\n    } catch (error) {\n      console.error(\"Error fetching study material:\", error);\n      res.status(500).json({ message: \"Failed to fetch study material\" });\n    }\n  });\n\n  app.post(\"/api/study-materials/upload\", isAuthenticated, upload.single(\"file\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const file = req.file;\n      \n      if (!file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      if (file.mimetype !== \"application/pdf\") {\n        return res.status(400).json({ message: \"Only PDF files are allowed\" });\n      }\n\n      const { ObjectStorageService, objectStorageClient } = await import(\"./objectStorage\");\n      const { setObjectAclPolicy } = await import(\"./objectAcl\");\n      \n      const objectStorageService = new ObjectStorageService();\n      const privateDir = objectStorageService.getPrivateObjectDir();\n      \n      const sanitizedFilename = file.originalname.replace(/[^a-zA-Z0-9.-]/g, '_');\n      const fileName = `pdfs/${userId}/${Date.now()}_${sanitizedFilename}`;\n      const fullPath = `${privateDir}/${fileName}`;\n      \n      const pathParts = fullPath.split(\"/\").filter(p => p);\n      const bucketName = pathParts[0];\n      const objectName = pathParts.slice(1).join(\"/\");\n      \n      const bucket = objectStorageClient.bucket(bucketName);\n      const bucketFile = bucket.file(objectName);\n      \n      await bucketFile.save(file.buffer, {\n        contentType: file.mimetype,\n        metadata: {\n          contentType: file.mimetype,\n        },\n      });\n      \n      const [exists] = await bucketFile.exists();\n      if (!exists) {\n        throw new Error(\"File failed to upload to object storage\");\n      }\n      \n      await setObjectAclPolicy(bucketFile, {\n        owner: userId,\n        visibility: \"private\",\n      });\n      \n      const objectPath = `/objects/${fileName}`;\n\n      const material = await storage.createStudyMaterial({\n        userId,\n        title: file.originalname.replace(\".pdf\", \"\"),\n        fileName: file.originalname,\n        fileUrl: objectPath,\n        fileSize: file.size,\n      });\n\n      res.json(material);\n    } catch (error: any) {\n      console.error(\"Error uploading study material:\", error);\n      res.status(500).json({ message: error.message || \"Failed to upload study material\" });\n    }\n  });\n\n  app.get(\"/objects/:objectPath(*)\", isAuthenticated, async (req: any, res) => {\n    const userId = req.user?.claims?.sub;\n    const { ObjectStorageService, ObjectNotFoundError } = await import(\"./objectStorage\");\n    const { ObjectPermission } = await import(\"./objectAcl\");\n    \n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      const canAccess = await objectStorageService.canAccessObjectEntity({\n        objectFile,\n        userId: userId,\n        requestedPermission: ObjectPermission.READ,\n      });\n      if (!canAccess) {\n        return res.sendStatus(401);\n      }\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error checking object access:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  app.delete(\"/api/study-materials/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const material = await storage.getStudyMaterial(req.params.id);\n      if (!material) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n      // Verify ownership\n      if (material.userId !== req.user.claims.sub) {\n        return res.status(403).json({ message: \"Forbidden\" });\n      }\n      await storage.deleteStudyMaterial(req.params.id);\n      res.json({ message: \"Study material deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting study material:\", error);\n      res.status(500).json({ message: \"Failed to delete study material\" });\n    }\n  });\n\n  // Flashcard routes\n  app.get(\"/api/flashcards\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.query;\n      \n      const flashcards = materialId\n        ? await storage.getFlashcardsByMaterial(materialId as string)\n        : await storage.getFlashcardsByUser(userId);\n      \n      res.json(flashcards);\n    } catch (error) {\n      console.error(\"Error fetching flashcards:\", error);\n      res.status(500).json({ message: \"Failed to fetch flashcards\" });\n    }\n  });\n\n  app.post(\"/api/flashcards/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId, count = 10 } = req.body;\n\n      const material = await storage.getStudyMaterial(materialId);\n      if (!material || material.userId !== userId) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n\n      // Use Gemini to generate flashcards\n      const prompt = `Generate ${count} flashcards from this study material titled \"${material.title}\". \n      Return ONLY a JSON array with objects containing 'question' and 'answer' fields. No additional text or markdown formatting.\n      Use plain text only - no asterisks, underscores, or markdown syntax.\n      Example format: [{\"question\": \"What is X?\", \"answer\": \"X is...\"}, ...]`;\n\n      const result = await genAI.models.generateContent({\n        model: \"gemini-2.0-flash-exp\",\n        contents: prompt,\n      });\n      const text = result.text || \"\";\n      \n      // Extract JSON from response\n      const jsonMatch = text.match(/\\[[\\s\\S]*\\]/);\n      if (!jsonMatch) {\n        throw new Error(\"Failed to parse AI response\");\n      }\n      \n      const flashcardsData = JSON.parse(jsonMatch[0]);\n\n      // Save flashcards to database with sanitized content\n      const createdFlashcards = [];\n      for (const card of flashcardsData) {\n        const flashcard = await storage.createFlashcard({\n          userId,\n          materialId,\n          question: sanitizeMarkdown(card.question || \"\"),\n          answer: sanitizeMarkdown(card.answer || \"\"),\n          isAIGenerated: true,\n        });\n        createdFlashcards.push(flashcard);\n      }\n\n      res.json(createdFlashcards);\n    } catch (error: any) {\n      console.error(\"Error generating flashcards:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate flashcards\" });\n    }\n  });\n\n  app.post(\"/api/flashcards\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const flashcardData = insertFlashcardSchema.parse({ ...req.body, userId });\n      const flashcard = await storage.createFlashcard(flashcardData);\n      res.json(flashcard);\n    } catch (error: any) {\n      console.error(\"Error creating flashcard:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create flashcard\" });\n    }\n  });\n\n  app.delete(\"/api/flashcards/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const flashcard = await storage.getFlashcard(req.params.id);\n      if (!flashcard || flashcard.userId !== req.user.claims.sub) {\n        return res.status(404).json({ message: \"Flashcard not found\" });\n      }\n      await storage.deleteFlashcard(req.params.id);\n      res.json({ message: \"Flashcard deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting flashcard:\", error);\n      res.status(500).json({ message: \"Failed to delete flashcard\" });\n    }\n  });\n\n  // Quiz routes\n  app.get(\"/api/quizzes\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.query;\n      \n      const quizzes = materialId\n        ? await storage.getQuizzesByMaterial(materialId as string)\n        : await storage.getQuizzesByUser(userId);\n      \n      res.json(quizzes);\n    } catch (error) {\n      console.error(\"Error fetching quizzes:\", error);\n      res.status(500).json({ message: \"Failed to fetch quizzes\" });\n    }\n  });\n\n  app.get(\"/api/quizzes/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const quiz = await storage.getQuiz(req.params.id);\n      if (!quiz || quiz.userId !== req.user.claims.sub) {\n        return res.status(404).json({ message: \"Quiz not found\" });\n      }\n      res.json(quiz);\n    } catch (error) {\n      console.error(\"Error fetching quiz:\", error);\n      res.status(500).json({ message: \"Failed to fetch quiz\" });\n    }\n  });\n\n  app.post(\"/api/quizzes/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId, questionCount = 10 } = req.body;\n\n      const material = await storage.getStudyMaterial(materialId);\n      if (!material || material.userId !== userId) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n\n      // Use Gemini to generate quiz\n      const prompt = `Generate ${questionCount} multiple choice quiz questions from this study material titled \"${material.title}\". \n      Return ONLY a JSON array with objects containing 'question', 'options' (array of 4 choices), and 'correctAnswer' (the correct option text). No additional text or markdown formatting.\n      Use plain text only - no asterisks, underscores, or markdown syntax.\n      Example format: [{\"question\": \"What is X?\", \"options\": [\"A\", \"B\", \"C\", \"D\"], \"correctAnswer\": \"A\"}, ...]`;\n\n      const result = await genAI.models.generateContent({\n        model: \"gemini-2.0-flash-exp\",\n        contents: prompt,\n      });\n      const text = result.text || \"\";\n      \n      // Extract JSON from response\n      const jsonMatch = text.match(/\\[[\\s\\S]*\\]/);\n      if (!jsonMatch) {\n        throw new Error(\"Failed to parse AI response\");\n      }\n      \n      const questions = JSON.parse(jsonMatch[0]);\n\n      // Sanitize quiz questions and options\n      const sanitizedQuestions = questions.map((q: any) => ({\n        question: sanitizeMarkdown(q.question || \"\"),\n        options: (q.options || []).map((opt: string) => sanitizeMarkdown(opt)),\n        correctAnswer: sanitizeMarkdown(q.correctAnswer || \"\"),\n      }));\n\n      // Save quiz to database\n      const quiz = await storage.createQuiz({\n        userId,\n        materialId,\n        title: `${material.title} Quiz`,\n        questions: sanitizedQuestions,\n        isAIGenerated: true,\n      });\n\n      res.json(quiz);\n    } catch (error: any) {\n      console.error(\"Error generating quiz:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate quiz\" });\n    }\n  });\n\n  // Quiz Attempt routes\n  app.get(\"/api/quiz-attempts\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const attempts = await storage.getQuizAttemptsByUser(userId);\n      res.json(attempts);\n    } catch (error) {\n      console.error(\"Error fetching quiz attempts:\", error);\n      res.status(500).json({ message: \"Failed to fetch quiz attempts\" });\n    }\n  });\n\n  app.post(\"/api/quiz-attempts\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const attemptData = insertQuizAttemptSchema.parse({ ...req.body, userId });\n      \n      const attempt = await storage.createQuizAttempt(attemptData);\n\n      // Update user quiz stats if not cancelled\n      if (!attemptData.isCancelled) {\n        const user = await storage.getUser(userId);\n        if (user) {\n          await storage.updateUserStats(userId, {\n            totalQuizScore: user.totalQuizScore + attemptData.score,\n            quizzesCompleted: user.quizzesCompleted + 1,\n          });\n        }\n      }\n\n      res.json(attempt);\n    } catch (error: any) {\n      console.error(\"Error creating quiz attempt:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create quiz attempt\" });\n    }\n  });\n\n  // Summary routes\n  app.get(\"/api/summaries\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.query;\n      \n      if (materialId) {\n        const summary = await storage.getSummaryByMaterial(materialId as string);\n        res.json(summary || null);\n      } else {\n        const summaries = await storage.getSummariesByUser(userId);\n        res.json(summaries);\n      }\n    } catch (error) {\n      console.error(\"Error fetching summaries:\", error);\n      res.status(500).json({ message: \"Failed to fetch summaries\" });\n    }\n  });\n\n  app.post(\"/api/summaries/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.body;\n\n      const material = await storage.getStudyMaterial(materialId);\n      if (!material || material.userId !== userId) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n\n      // Check if summary already exists\n      const existingSummary = await storage.getSummaryByMaterial(materialId);\n      if (existingSummary && existingSummary.audioUrl) {\n        // Summary with audio already exists, return it\n        return res.json(existingSummary);\n      }\n      \n      // If summary exists but no audio, we'll regenerate both for consistency\n      let content = \"\";\n      if (existingSummary) {\n        // Sanitize existing content in case it has old markdown\n        content = sanitizeMarkdown(existingSummary.content);\n      } else {\n\n        // Use Gemini to generate an educational summary with examples\n        const prompt = `You are an expert tutor helping a student understand the study material titled \"${material.title}\".\n\nGenerate a comprehensive educational summary that:\n1. Explains the main concepts in simple, everyday language\n2. Provides real-world examples to illustrate difficult concepts\n3. Uses analogies and metaphors to make complex ideas easy to understand\n4. Breaks down challenging topics step-by-step\n5. Includes practical applications of the concepts\n\nMake the explanation engaging and conversational, as if you're speaking directly to the student.\nFormat the summary to be clear and well-organized with headings and sections.\n\nIMPORTANT: \n- Use plain text only. Do not use markdown formatting like asterisks, underscores, or special characters for emphasis.\n- If the content includes mathematical formulas, symbols, or equations, ALWAYS spell them out in words so they sound natural when spoken aloud.\n- For example, write \"alpha\" instead of \"Î±\", \"sum\" instead of \"â\", \"pi\" instead of \"Ï\"\n- Write \"x equals 2\" instead of \"x = 2\", \"x squared\" instead of \"xÂ²\"\n- Make all mathematical content readable and understandable when spoken.\n\nYour goal is to ensure that even the most difficult concepts become easy to understand through your explanations and examples.`;\n\n        const result = await genAI.models.generateContent({\n          model: \"gemini-2.0-flash-exp\",\n          contents: prompt,\n        });\n        content = sanitizeMarkdown(result.text || \"\");\n      }\n\n      // Generate audio from the summary using Deepgram\n      // Text will be automatically chunked if it exceeds Deepgram's 2000 char limit\n      let audioUrl: string | null = null;\n      try {\n        console.log(\"Generating audio summary with Deepgram...\");\n        \n        // Sanitize content for audio - removes markdown and converts symbols to readable text\n        const audioText = sanitizeForAudio(content);\n        console.log(\"Text sanitized for audio, length:\", audioText.length);\n        \n        const audioBuffer = await generateAudioFromText({ \n          text: audioText,\n          model: \"aura-asteria-en\" // Natural, clear voice for educational content\n        });\n\n        console.log(\"Audio buffer generated, size:\", audioBuffer.length, \"bytes\");\n\n        // Upload audio to object storage\n        const audioFileName = `summaries/audio_${materialId}_${Date.now()}.wav`;\n        console.log(\"Uploading audio to:\", audioFileName);\n        \n        await objectStorage.uploadFile(audioFileName, audioBuffer, \"audio/wav\");\n        console.log(\"Audio uploaded successfully\");\n        \n        // Set ACL policy so user can access the audio\n        const audioFile = await objectStorage.getObjectEntityFile(`/objects/${audioFileName}`);\n        await setObjectAclPolicy(audioFile, {\n          owner: userId,\n          visibility: \"private\"\n        });\n        \n        audioUrl = `/objects/${audioFileName}`;\n        console.log(\"Audio summary generated and uploaded:\", audioUrl);\n      } catch (audioError) {\n        console.error(\"Error generating audio summary:\", audioError);\n        console.error(\"Audio error stack:\", audioError instanceof Error ? audioError.stack : \"\");\n        // Continue without audio if generation fails\n      }\n\n      // Save or update summary in database with audio URL\n      let summary;\n      if (existingSummary) {\n        // Update existing summary with audio URL\n        summary = await storage.updateSummary(existingSummary.id, { audioUrl });\n      } else {\n        // Create new summary\n        summary = await storage.createSummary({\n          userId,\n          materialId,\n          content,\n          audioUrl,\n        });\n      }\n\n      res.json(summary);\n    } catch (error: any) {\n      console.error(\"Error generating summary:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate summary\" });\n    }\n  });\n\n  // Mind Map routes\n  app.get(\"/api/mind-maps\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.query;\n      \n      const mindMaps = materialId\n        ? await storage.getMindMapsByMaterial(materialId as string)\n        : await storage.getMindMapsByUser(userId);\n      \n      res.json(mindMaps);\n    } catch (error) {\n      console.error(\"Error fetching mind maps:\", error);\n      res.status(500).json({ message: \"Failed to fetch mind maps\" });\n    }\n  });\n\n  app.post(\"/api/mind-maps/generate\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.body;\n\n      const material = await storage.getStudyMaterial(materialId);\n      if (!material || material.userId !== userId) {\n        return res.status(404).json({ message: \"Study material not found\" });\n      }\n\n      // Use Gemini to generate mind map structure\n      const prompt = `Generate a mind map structure for this study material titled \"${material.title}\". \n      Return ONLY a JSON object with a hierarchical node structure. Each node should have 'id', 'label', and 'children' (array of child nodes).\n      Use plain text only for labels - no asterisks, underscores, or markdown syntax.\n      Example: {\"id\": \"root\", \"label\": \"Main Topic\", \"children\": [{\"id\": \"1\", \"label\": \"Subtopic 1\", \"children\": []}, ...]}`;\n\n      const result = await genAI.models.generateContent({\n        model: \"gemini-2.0-flash-exp\",\n        contents: prompt,\n      });\n      const text = result.text || \"\";\n      \n      // Extract JSON from response\n      const jsonMatch = text.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        throw new Error(\"Failed to parse AI response\");\n      }\n      \n      const mindMapContent = JSON.parse(jsonMatch[0]);\n\n      // Recursively sanitize node labels\n      const sanitizedContent = sanitizeMindMapNode(mindMapContent);\n\n      // Save mind map to database\n      const mindMap = await storage.createMindMap({\n        userId,\n        materialId,\n        title: `${material.title} Mind Map`,\n        content: sanitizedContent,\n      });\n\n      res.json(mindMap);\n    } catch (error: any) {\n      console.error(\"Error generating mind map:\", error);\n      res.status(500).json({ message: error.message || \"Failed to generate mind map\" });\n    }\n  });\n\n  // Chat routes\n  app.get(\"/api/chat/messages\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId } = req.query;\n      \n      const messages = materialId\n        ? await storage.getChatMessagesByMaterial(materialId as string)\n        : await storage.getChatMessagesByUser(userId);\n      \n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching chat messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch chat messages\" });\n    }\n  });\n\n  app.post(\"/api/chat/message\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { materialId, content } = req.body;\n\n      // Sanitize user input\n      const sanitizedContent = sanitizeUserInput(content);\n\n      // Save user message\n      const userMessage = await storage.createChatMessage({\n        userId,\n        materialId: materialId || null,\n        role: \"user\",\n        content: sanitizedContent,\n      });\n\n      // Set up SSE headers for streaming\n      res.setHeader(\"Content-Type\", \"text/event-stream\");\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      res.setHeader(\"Connection\", \"keep-alive\");\n\n      // Get conversation history\n      const history = materialId\n        ? await storage.getChatMessagesByMaterial(materialId)\n        : [];\n\n      // Generate AI response using Gemini with streaming\n      let prompt = sanitizedContent;\n      if (materialId) {\n        const material = await storage.getStudyMaterial(materialId);\n        if (material) {\n          prompt = `You are a helpful study assistant. The student is studying \"${material.title}\". \n          Previous conversation: ${history.slice(-5).map(m => `${m.role}: ${m.content}`).join(\"\\n\")}\n          Student question: ${sanitizedContent}\n          \n          Provide a helpful, educational response in plain text without any markdown formatting. Do not use asterisks, underscores, or other markdown syntax.`;\n        }\n      } else {\n        prompt = `You are a helpful study assistant. Student question: ${sanitizedContent}\n        \n        Provide a helpful, educational response in plain text without any markdown formatting. Do not use asterisks, underscores, or other markdown syntax.`;\n      }\n\n      // Send user message ID first\n      res.write(`data: ${JSON.stringify({ type: \"userMessage\", message: userMessage })}\\n\\n`);\n\n      let fullResponse = \"\";\n      \n      // Stream the AI response\n      const stream = await genAI.models.generateContentStream({\n        model: \"gemini-2.0-flash-exp\",\n        contents: prompt,\n      });\n\n      for await (const chunk of stream) {\n        const text = chunk.text;\n        if (text) {\n          fullResponse += text;\n          const sanitized = sanitizeMarkdown(text);\n          res.write(`data: ${JSON.stringify({ type: \"chunk\", content: sanitized })}\\n\\n`);\n        }\n      }\n\n      // Save the complete AI response\n      const assistantMessage = await storage.createChatMessage({\n        userId,\n        materialId: materialId || null,\n        role: \"assistant\",\n        content: sanitizeMarkdown(fullResponse),\n      });\n\n      // Send completion event with full message\n      res.write(`data: ${JSON.stringify({ type: \"complete\", message: assistantMessage })}\\n\\n`);\n      res.end();\n    } catch (error: any) {\n      console.error(\"Error processing chat message:\", error);\n      res.write(`data: ${JSON.stringify({ type: \"error\", message: error.message || \"Failed to process chat message\" })}\\n\\n`);\n      res.end();\n    }\n  });\n\n  // Study Session routes\n  app.get(\"/api/study-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessions = await storage.getStudySessionsByUser(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching study sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch study sessions\" });\n    }\n  });\n\n  app.post(\"/api/study-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionData = insertStudySessionSchema.parse({ ...req.body, userId });\n      const session = await storage.createStudySession(sessionData);\n      res.json(session);\n    } catch (error: any) {\n      console.error(\"Error creating study session:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create study session\" });\n    }\n  });\n\n  app.patch(\"/api/study-sessions/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const session = await storage.getStudySession(req.params.id);\n      if (!session || session.userId !== req.user.claims.sub) {\n        return res.status(404).json({ message: \"Study session not found\" });\n      }\n\n      const updates = req.body;\n      const updatedSession = await storage.updateStudySession(req.params.id, updates);\n\n      // Update user stats if session ended\n      if (updates.endTime && updates.duration) {\n        const user = await storage.getUser(req.user.claims.sub);\n        if (user) {\n          const totalStudyTime = user.totalStudyTime + updates.duration;\n          \n          // Update streak logic\n          const today = new Date();\n          today.setHours(0, 0, 0, 0);\n          const lastStudy = user.lastStudyDate ? new Date(user.lastStudyDate) : null;\n          lastStudy?.setHours(0, 0, 0, 0);\n          \n          let currentStreak = user.currentStreak;\n          if (updates.duration >= 30 && updates.tabSwitches === 0) { // Min 30 min focused study\n            if (!lastStudy || lastStudy.getTime() === today.getTime()) {\n              // Same day, no change\n            } else if (lastStudy && (today.getTime() - lastStudy.getTime() === 86400000)) {\n              // Consecutive day\n              currentStreak++;\n            } else {\n              // Streak broken\n              currentStreak = 1;\n            }\n          }\n\n          await storage.updateUserStats(req.user.claims.sub, {\n            totalStudyTime,\n            currentStreak,\n            longestStreak: Math.max(currentStreak, user.longestStreak),\n            lastStudyDate: today,\n          });\n        }\n      }\n\n      res.json(updatedSession);\n    } catch (error: any) {\n      console.error(\"Error updating study session:\", error);\n      res.status(400).json({ message: error.message || \"Failed to update study session\" });\n    }\n  });\n\n  // Todo routes\n  app.get(\"/api/todos\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const todos = await storage.getTodosByUser(userId);\n      res.json(todos);\n    } catch (error) {\n      console.error(\"Error fetching todos:\", error);\n      res.status(500).json({ message: \"Failed to fetch todos\" });\n    }\n  });\n\n  app.post(\"/api/todos\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const todoData = insertTodoSchema.parse({ ...req.body, userId });\n      const todo = await storage.createTodo(todoData);\n      res.json(todo);\n    } catch (error: any) {\n      console.error(\"Error creating todo:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create todo\" });\n    }\n  });\n\n  app.patch(\"/api/todos/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const todo = await storage.getTodo(req.params.id);\n      if (!todo || todo.userId !== req.user.claims.sub) {\n        return res.status(404).json({ message: \"Todo not found\" });\n      }\n      const updatedTodo = await storage.updateTodo(req.params.id, req.body);\n      res.json(updatedTodo);\n    } catch (error: any) {\n      console.error(\"Error updating todo:\", error);\n      res.status(400).json({ message: error.message || \"Failed to update todo\" });\n    }\n  });\n\n  app.delete(\"/api/todos/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const todo = await storage.getTodo(req.params.id);\n      if (!todo || todo.userId !== req.user.claims.sub) {\n        return res.status(404).json({ message: \"Todo not found\" });\n      }\n      await storage.deleteTodo(req.params.id);\n      res.json({ message: \"Todo deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting todo:\", error);\n      res.status(500).json({ message: \"Failed to delete todo\" });\n    }\n  });\n\n  // Pomodoro routes\n  app.get(\"/api/pomodoro-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessions = await storage.getPomodoroSessionsByUser(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching pomodoro sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch pomodoro sessions\" });\n    }\n  });\n\n  app.post(\"/api/pomodoro-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionData = insertPomodoroSessionSchema.parse({ ...req.body, userId });\n      const session = await storage.createPomodoroSession(sessionData);\n      res.json(session);\n    } catch (error: any) {\n      console.error(\"Error creating pomodoro session:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create pomodoro session\" });\n    }\n  });\n\n  // Leaderboard routes\n  app.get(\"/api/leaderboard/study-time\", isAuthenticated, async (req: any, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 50;\n      const topUsers = await storage.getTopUsersByStudyTime(limit);\n      \n      // Transform data to match frontend expectations\n      const leaderboard = topUsers.map(user => ({\n        userId: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profileImageUrl: user.profileImageUrl,\n        totalTime: user.totalStudyTime, // in minutes\n      }));\n      \n      res.json(leaderboard);\n    } catch (error) {\n      console.error(\"Error fetching study time leaderboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch study time leaderboard\" });\n    }\n  });\n\n  app.get(\"/api/leaderboard/quiz-score\", isAuthenticated, async (req: any, res) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 50;\n      const topUsers = await storage.getTopUsersByQuizScore(limit);\n      \n      // Transform data to match frontend expectations\n      const leaderboard = topUsers.map(user => ({\n        userId: user.id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profileImageUrl: user.profileImageUrl,\n        averageScore: user.quizzesCompleted > 0 \n          ? (user.totalQuizScore / user.quizzesCompleted) \n          : 0,\n        quizCount: user.quizzesCompleted,\n      }));\n      \n      res.json(leaderboard);\n    } catch (error) {\n      console.error(\"Error fetching quiz score leaderboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch quiz score leaderboard\" });\n    }\n  });\n\n  // Collaboration Session routes\n  app.post(\"/api/collab/sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionCode = Math.random().toString(36).substring(2, 12).toUpperCase();\n      const sessionData = insertCollabSessionSchema.parse({\n        ...req.body,\n        hostUserId: userId,\n        sessionCode,\n      });\n      const session = await storage.createCollabSession(sessionData);\n      \n      // Create whiteboard for session\n      await storage.createCollabWhiteboard({\n        sessionId: session.id,\n        content: { elements: [] },\n      });\n      \n      // Add host as participant\n      await storage.createCollabParticipant({\n        sessionId: session.id,\n        userId,\n        role: \"host\",\n      });\n      \n      res.json(session);\n    } catch (error: any) {\n      console.error(\"Error creating collab session:\", error);\n      res.status(400).json({ message: error.message || \"Failed to create collab session\" });\n    }\n  });\n\n  app.get(\"/api/collab/sessions/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const session = await storage.getCollabSession(req.params.id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      res.json(session);\n    } catch (error) {\n      console.error(\"Error fetching collab session:\", error);\n      res.status(500).json({ message: \"Failed to fetch collab session\" });\n    }\n  });\n\n  app.get(\"/api/collab/sessions/code/:code\", isAuthenticated, async (req: any, res) => {\n    try {\n      const session = await storage.getCollabSessionByCode(req.params.code);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      res.json(session);\n    } catch (error) {\n      console.error(\"Error fetching collab session by code:\", error);\n      res.status(500).json({ message: \"Failed to fetch collab session\" });\n    }\n  });\n\n  app.get(\"/api/collab/my-sessions\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessions = await storage.getCollabSessionsByHost(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching user's collab sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch collab sessions\" });\n    }\n  });\n\n  app.post(\"/api/collab/sessions/:id/end\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const session = await storage.getCollabSession(req.params.id);\n      \n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      \n      if (session.hostUserId !== userId) {\n        return res.status(403).json({ message: \"Only the host can end the session\" });\n      }\n      \n      const endedSession = await storage.endCollabSession(req.params.id);\n      res.json(endedSession);\n    } catch (error) {\n      console.error(\"Error ending collab session:\", error);\n      res.status(500).json({ message: \"Failed to end collab session\" });\n    }\n  });\n\n  // Collaboration Participant routes\n  app.post(\"/api/collab/sessions/:id/join\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const sessionId = req.params.id;\n      \n      const session = await storage.getCollabSession(sessionId);\n      if (!session || !session.isActive) {\n        return res.status(404).json({ message: \"Session not found or inactive\" });\n      }\n      \n      // Check if already a participant\n      const existing = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n      if (existing) {\n        return res.json(existing);\n      }\n      \n      const participantData = insertCollabParticipantSchema.parse({\n        sessionId,\n        userId,\n        role: \"member\",\n      });\n      \n      const participant = await storage.createCollabParticipant(participantData);\n      res.json(participant);\n    } catch (error: any) {\n      console.error(\"Error joining collab session:\", error);\n      res.status(400).json({ message: error.message || \"Failed to join collab session\" });\n    }\n  });\n\n  app.get(\"/api/collab/sessions/:id/participants\", isAuthenticated, async (req: any, res) => {\n    try {\n      const participants = await storage.getActiveCollabParticipantsBySession(req.params.id);\n      \n      // Fetch user details for each participant\n      const participantsWithUsers = await Promise.all(\n        participants.map(async (p) => {\n          const user = await storage.getUser(p.userId);\n          return { ...p, user };\n        })\n      );\n      \n      res.json(participantsWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching participants:\", error);\n      res.status(500).json({ message: \"Failed to fetch participants\" });\n    }\n  });\n\n  // Collaboration Whiteboard routes\n  app.get(\"/api/collab/sessions/:id/whiteboard\", isAuthenticated, async (req: any, res) => {\n    try {\n      const whiteboard = await storage.getCollabWhiteboardBySession(req.params.id);\n      if (!whiteboard) {\n        return res.status(404).json({ message: \"Whiteboard not found\" });\n      }\n      res.json(whiteboard);\n    } catch (error) {\n      console.error(\"Error fetching whiteboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch whiteboard\" });\n    }\n  });\n\n  app.patch(\"/api/collab/whiteboards/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const updates = { content: req.body.content };\n      const whiteboard = await storage.updateCollabWhiteboard(req.params.id, updates);\n      res.json(whiteboard);\n    } catch (error) {\n      console.error(\"Error updating whiteboard:\", error);\n      res.status(500).json({ message: \"Failed to update whiteboard\" });\n    }\n  });\n\n  // Collaboration Activity routes\n  app.get(\"/api/collab/sessions/:id/activities\", isAuthenticated, async (req: any, res) => {\n    try {\n      const activities = await storage.getCollabActivitiesBySession(req.params.id);\n      res.json(activities);\n    } catch (error) {\n      console.error(\"Error fetching activities:\", error);\n      res.status(500).json({ message: \"Failed to fetch activities\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  \n  // Setup WebSocket for collaboration\n  setupCollabWebSocket(httpServer);\n  \n  return httpServer;\n}\n","size_bytes":40359},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"replit.md":{"content":"# All Out - AI-Powered Study Platform\n\n## Overview\n\nAll Out is an AI-powered study platform designed to transform students' study materials (e.g., PDFs) into interactive learning content. Key features include AI-generated flashcards, quizzes, mind maps, summaries, and audio/video explanations. The platform also incorporates gamification elements like leaderboards and streak tracking, alongside productivity tools such as a Pomodoro timer, to-do lists, and a concentration mode. A core ambition is to foster collaborative learning through real-time shared study sessions.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\nThe frontend is a Single-Page Application (SPA) built with React and TypeScript, using Vite for development and Wouter for routing. It utilizes Shadcn UI (New York style) based on Radix UI primitives and Tailwind CSS for styling, following a design system inspired by Notion, Duolingo, and Khan Academy. State management relies on TanStack Query for server state and React Context for global states like authentication. Authentication is handled via Replit OpenID Connect (OIDC) and Passport.js, with session-based authentication. File uploads are managed by Multer and stored in Replit Object Storage, with access control.\n\n### Backend Architecture\nThe backend is an Express.js server on Node.js, written in TypeScript. It provides a RESTful API with Zod for request validation. Session management uses Express session middleware with a PostgreSQL store. Authentication integrates with Replit Auth via openid-client. AI functionalities, including content generation for flashcards, quizzes, mind maps, and summaries, are powered by Google Gemini AI. Audio explanations are generated using Deepgram API for text-to-speech. Centralized error handling uses HTTP status codes.\n\n### Data Storage Solutions\nThe platform uses PostgreSQL (Neon serverless) with Drizzle ORM for type-safe queries. Core entities include Users, Study Materials, Flashcards, Quizzes, Quiz Attempts, Mind Maps, Summaries, Study Sessions, Todos, Pomodoro Sessions, Chat Messages, and Sessions. Binary files like PDFs are stored in Replit Object Storage, with metadata and paths in PostgreSQL.\n\n### Collaboration System\nThe platform features a real-time collaboration system using WebSockets for shared study sessions. This includes a collaborative whiteboard with pen/eraser/highlighter tools (1px-8px sizes), host-controlled concentration mode, coordinated break timers, and activity tracking. WebSocket connections are authenticated via Express session cookies, and authorization is enforced for all actions. Session, participant, whiteboard, and activity data are stored in dedicated PostgreSQL tables with cascade deletes.\n\n### Gamification System\nThe platform includes a comprehensive leaderboard system that tracks and ranks users based on their study activity:\n- **Study Time Leaderboard**: Ranks users by total study time (in minutes), updated automatically when Pomodoro sessions complete\n- **Quiz Score Leaderboard**: Ranks users by total quiz score, displaying average score percentage and quiz count, updated when quiz attempts are submitted\n- User stats tracked: `totalStudyTime`, `totalQuizScore`, `quizzesCompleted`, `currentStreak`, `longestStreak`, `lastStudyDate`\n- Leaderboards filter to show only users with activity (study time > 0 or quizzes completed > 0)\n- Real-time UI updates with current user highlighting and rank indicators (trophies/medals for top 3)\n\n## External Dependencies\n\n### AI Services\n- **Google Gemini API**: For natural language processing and content generation (flashcards, quizzes, mind maps, summaries, chat responses).\n- **Deepgram API**: For text-to-speech conversion of summaries into audio explanations.\n\n### Database Service\n- **Neon PostgreSQL**: Serverless database for persistent data storage.\n\n### Authentication Provider\n- **Replit OpenID Connect (OIDC)**: For user authentication and profile syncing.\n\n### Third-Party UI Libraries\n- **Radix UI**: Primitives for building UI components.\n- **Shadcn UI**: Component library built on Radix UI.\n- **Tailwind CSS**: Utility-first CSS framework.\n- **React Flow**: For interactive mind map visualizations.\n- **Recharts**: For data visualization (charts).\n- **Lucide React**: For iconography.\n\n### Utility Libraries\n- **Zod**: For runtime schema validation.\n- **date-fns**: For date manipulation.\n\n### Build & Development Tools\n- **Vite**: Frontend build tool.\n- **TypeScript**: For type-safe development.\n- **ESBuild**: For server-side bundling.\n- **PostCSS**: CSS preprocessor.\n- **Drizzle Kit**: For database migrations.","size_bytes":4695},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":307},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"design_guidelines.md":{"content":"# Design Guidelines: All Out - AI-Powered Study Platform\n\n## Design Approach\n**Reference-Based Approach**: Drawing from Notion (clean document interface), Duolingo (gamification elements), and Khan Academy (learning dashboard). This experience-focused application requires visual appeal to drive engagement while maintaining functional clarity for productivity tools.\n\n## Core Design Elements\n\n### Typography\n- **Primary Font**: Inter for UI elements, body text, and data displays\n- **Secondary Font**: Poppins for headings, hero sections, and emphasis\n- **Hierarchy**:\n  - Hero/Display: Poppins Bold, 48px (mobile: 32px)\n  - Page Headings: Poppins SemiBold, 32px (mobile: 24px)\n  - Section Titles: Poppins Medium, 24px (mobile: 20px)\n  - Card Headers: Inter SemiBold, 18px\n  - Body Text: Inter Regular, 16px\n  - Labels/Captions: Inter Medium, 14px\n  - Small Text: Inter Regular, 12px\n\n### Layout System\n**Spacing Units**: Use Tailwind spacing of 2, 4, 6, 8, 12, 16, 20, 24 for consistent rhythm\n- Component padding: p-4 to p-6\n- Section spacing: py-12 to py-20\n- Card spacing: p-6\n- Gap between elements: gap-4 to gap-6\n\n**Grid System**:\n- Dashboard: 3-column grid (lg:grid-cols-3, md:grid-cols-2, grid-cols-1)\n- Leaderboards: 2-column split (stats left, rankings right)\n- Flashcards: 2-3 column masonry layout\n- Quiz: Single column centered max-w-3xl\n\n### Color Application\n- **Primary Actions**: #6366F1 (indigo) - CTAs, active states, focus indicators\n- **Gamification**: #8B5CF6 (purple) - badges, streaks, achievements\n- **Success States**: #10B981 (emerald) - completed tasks, correct answers, progress\n- **Warnings**: #F59E0B (amber) - concentration mode alerts, timer notifications\n- **Accent**: #EC4899 (pink) - leaderboard highlights, special features\n- **Background**: #F8FAFC (slate-50) - main canvas\n- **Text**: #1E293B (slate-800) - primary text, headers\n- **Cards**: White backgrounds with subtle shadow (shadow-md)\n\n### Component Library\n\n**Navigation**:\n- Persistent sidebar (w-64) with collapsible mobile drawer\n- Navigation items with icon + label, hover state with indigo background\n- Active state: bold text + indigo background + left border accent\n- Logo at top, user profile at bottom\n\n**Cards**:\n- White background, rounded-xl borders\n- shadow-md with hover:shadow-lg transition\n- p-6 internal padding\n- Header with icon + title + action button pattern\n\n**Dashboard Widgets**:\n- Stat cards: Large number display + label + trend indicator\n- Progress rings: Circular progress for streaks and goals\n- Activity feed: Timeline-style list with timestamps\n- Quick actions: Icon buttons in grid layout\n\n**Leaderboard**:\n- Glassmorphism effect: backdrop-blur-lg with semi-transparent white background\n- Top 3 users: Larger cards with medal icons (gold, silver, bronze)\n- Rank list: Compact rows with avatar, name, score, position indicator\n- Current user highlighted with indigo border\n\n**Study Tools**:\n- PDF viewer: Split view with document on left, chat on right\n- Flashcard: Flip animation on card with front/back states\n- Quiz: Progress bar at top, question card center, answer buttons below\n- Mind map: Interactive node-based diagram with zoom controls\n- Pomodoro: Large circular timer with start/pause controls\n\n**Forms**:\n- Input fields: border-gray-300, focus:border-indigo-500, focus:ring-2 focus:ring-indigo-200\n- Labels: Inter Medium, 14px, text-slate-700\n- Buttons: Rounded-lg, px-6 py-3, shadow-sm\n- File upload: Dashed border dropzone with icon and instructions\n\n**Gamification Elements**:\n- Achievement badges: Circular icons with glassmorphism background\n- Streak counter: Flame icon + number with gradient background\n- Level indicator: Progress bar with XP display\n- Daily goal: Circular progress ring with percentage\n\n### Animations\n**Minimal Motion**:\n- Card hover: scale(1.02) transition-transform duration-200\n- Button press: scale(0.98) active state\n- Modal entrance: fade-in with slight scale-up\n- Page transitions: Simple fade between routes\n- Tab switch alert: Shake animation for concentration mode violations\n\n### Images\n**Landing Page Hero**: \n- Full-width hero image showing students studying with laptops/tablets in modern setting\n- Overlay: Dark gradient (from-black/60 to-transparent) for text readability\n- Buttons on hero: Blurred background (backdrop-blur-md bg-white/20)\n\n**Dashboard Illustrations**:\n- Empty states: Friendly illustrations for \"no documents uploaded\" or \"no quizzes completed\"\n- Achievement unlocked: Celebratory graphics for milestones\n\n**Feature Showcases**:\n- Screenshots of AI chat, flashcards, mind maps in action\n- Product demo images showing interface highlights\n\n### Page-Specific Layouts\n\n**Landing Page**:\n- Hero: Full viewport with background image, centered heading + subheading + dual CTAs\n- Features: 3-column grid showcasing AI tools with icons\n- How It Works: Numbered steps in horizontal flow\n- Leaderboard Preview: Glassmorphism card with sample rankings\n- Testimonials: 2-column cards with student quotes\n- Footer: 4-column layout (product, resources, company, social)\n\n**Dashboard**:\n- Top bar: Greeting + quick stats (study time today, streak, rank)\n- 3-column grid: Study stats, Recent documents, Upcoming tasks\n- Activity timeline below grid\n- Floating Pomodoro timer widget (bottom-right)\n\n**Document Viewer**:\n- 60/40 split: PDF viewer left, AI tools sidebar right\n- Tools tabs: Chat, Flashcards, Quiz, Mind Map, Summary\n- Sticky header with document name and actions\n\n**Concentration Mode**:\n- Fullscreen overlay when active\n- Timer display center-top\n- Tab switch warning: Modal with beep sound indicator\n- Minimalist interface to reduce distractions","size_bytes":5647},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2210},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { ThemeProvider } from \"@/components/ThemeProvider\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Profile from \"@/pages/profile\";\nimport Materials from \"@/pages/materials\";\nimport MaterialDetail from \"@/pages/material-detail\";\nimport Chat from \"@/pages/chat\";\nimport Flashcards from \"@/pages/flashcards\";\nimport Quizzes from \"@/pages/quizzes\";\nimport MindMaps from \"@/pages/mind-maps\";\nimport Summaries from \"@/pages/summaries\";\nimport AudioLibrary from \"@/pages/audio-library\";\nimport Todos from \"@/pages/todos\";\nimport Pomodoro from \"@/pages/pomodoro\";\nimport Concentration from \"@/pages/concentration\";\nimport Leaderboard from \"@/pages/leaderboard\";\nimport Collab from \"@/pages/collab\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  return (\n    <Switch>\n      {isLoading || !isAuthenticated ? (\n        <Route path=\"/\" component={Landing} />\n      ) : (\n        <>\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/dashboard\" component={Dashboard} />\n          <Route path=\"/profile\" component={Profile} />\n          <Route path=\"/materials/:id\" component={MaterialDetail} />\n          <Route path=\"/materials\" component={Materials} />\n          <Route path=\"/chat\" component={Chat} />\n          <Route path=\"/flashcards\" component={Flashcards} />\n          <Route path=\"/quizzes\" component={Quizzes} />\n          <Route path=\"/mind-maps\" component={MindMaps} />\n          <Route path=\"/summaries\" component={Summaries} />\n          <Route path=\"/audio-library\" component={AudioLibrary} />\n          <Route path=\"/todos\" component={Todos} />\n          <Route path=\"/pomodoro\" component={Pomodoro} />\n          <Route path=\"/concentration\" component={Concentration} />\n          <Route path=\"/leaderboard\" component={Leaderboard} />\n          <Route path=\"/collab\" component={Collab} />\n          {/* Add more authenticated routes here */}\n        </>\n      )}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n  \n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <>\n      {isLoading || !isAuthenticated ? (\n        <>\n          <Toaster />\n          <Router />\n        </>\n      ) : (\n        <SidebarProvider style={style as React.CSSProperties}>\n          <div className=\"flex h-screen w-full\">\n            <AppSidebar />\n            <div className=\"flex flex-col flex-1 overflow-hidden\">\n              <header className=\"flex items-center justify-between p-4 border-b\">\n                <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                <ThemeToggle />\n              </header>\n              <main className=\"flex-1 overflow-y-auto\">\n                <Router />\n              </main>\n            </div>\n          </div>\n          <Toaster />\n        </SidebarProvider>\n      )}\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"light\">\n        <TooltipProvider>\n          <AppContent />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":3772},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 210 6% 98%;\n\n  --foreground: 215 25% 15%;\n\n  --border: 210 10% 88%;\n\n  --card: 210 6% 96%;\n\n  --card-foreground: 215 25% 15%;\n\n  --card-border: 210 8% 92%;\n\n  --sidebar: 210 6% 94%;\n\n  --sidebar-foreground: 215 25% 15%;\n\n  --sidebar-border: 210 8% 89%;\n\n  --sidebar-primary: 239 84% 67%;\n\n  --sidebar-primary-foreground: 210 20% 98%;\n\n  --sidebar-accent: 210 8% 88%;\n\n  --sidebar-accent-foreground: 215 25% 20%;\n\n  --sidebar-ring: 239 84% 67%;\n\n  --popover: 210 6% 92%;\n\n  --popover-foreground: 215 25% 15%;\n\n  --popover-border: 210 8% 86%;\n\n  --primary: 239 84% 67%;\n\n  --primary-foreground: 210 20% 98%;\n\n  --secondary: 271 76% 67%;\n\n  --secondary-foreground: 210 20% 98%;\n  \n  --success: 158 64% 52%;\n  \n  --success-foreground: 210 20% 98%;\n  \n  --warning: 38 92% 50%;\n  \n  --warning-foreground: 215 25% 15%;\n  \n  --gamification: 328 86% 70%;\n  \n  --gamification-foreground: 210 20% 98%;\n\n  --muted: 210 12% 90%;\n\n  --muted-foreground: 215 16% 35%;\n\n  --accent: 210 14% 88%;\n\n  --accent-foreground: 215 25% 20%;\n\n  --destructive: 0 84% 60%;\n\n  --destructive-foreground: 210 20% 98%;\n\n  --input: 215 20% 65%;\n  --ring: 239 84% 67%;\n  --chart-1: 239 84% 67%;\n  --chart-2: 277 92% 69%;\n  --chart-3: 158 64% 52%;\n  --chart-4: 38 92% 50%;\n  --chart-5: 328 86% 70%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --font-heading: Poppins, sans-serif;\n  --radius: .5rem;\n  --shadow-2xs: 0px 1px 2px 0px hsl(215 25% 15% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(215 25% 15% / 0.1);\n  --shadow-sm: 0px 1px 2px 0px hsl(215 25% 15% / 0.05), 0px 1px 3px -1px hsl(215 25% 15% / 0.1);\n  --shadow: 0px 1px 3px 0px hsl(215 25% 15% / 0.1), 0px 1px 2px -1px hsl(215 25% 15% / 0.1);\n  --shadow-md: 0px 4px 6px -1px hsl(215 25% 15% / 0.1), 0px 2px 4px -2px hsl(215 25% 15% / 0.1);\n  --shadow-lg: 0px 10px 15px -3px hsl(215 25% 15% / 0.1), 0px 4px 6px -4px hsl(215 25% 15% / 0.1);\n  --shadow-xl: 0px 20px 25px -5px hsl(215 25% 15% / 0.1), 0px 8px 10px -6px hsl(215 25% 15% / 0.1);\n  --shadow-2xl: 0px 25px 50px -12px hsl(215 25% 15% / 0.25);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  \n  /* Fallback for older browsers */\n  --success-border: hsl(var(--success));\n  --success-border: hsl(from hsl(var(--success)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  \n  /* Fallback for older browsers */\n  --warning-border: hsl(var(--warning));\n  --warning-border: hsl(from hsl(var(--warning)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  \n  /* Fallback for older browsers */\n  --gamification-border: hsl(var(--gamification));\n  --gamification-border: hsl(from hsl(var(--gamification)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 215 20% 8%;\n\n  --foreground: 210 20% 92%;\n\n  --border: 215 16% 16%;\n\n  --card: 215 18% 10%;\n\n  --card-foreground: 210 20% 92%;\n\n  --card-border: 215 16% 14%;\n\n  --sidebar: 215 18% 12%;\n\n  --sidebar-foreground: 210 20% 92%;\n\n  --sidebar-border: 215 16% 16%;\n\n  --sidebar-primary: 239 84% 67%;\n\n  --sidebar-primary-foreground: 210 20% 98%;\n\n  --sidebar-accent: 215 14% 18%;\n\n  --sidebar-accent-foreground: 210 20% 92%;\n\n  --sidebar-ring: 239 84% 67%;\n\n  --popover: 215 18% 14%;\n\n  --popover-foreground: 210 20% 92%;\n\n  --popover-border: 215 16% 18%;\n\n  --primary: 239 84% 67%;\n\n  --primary-foreground: 210 20% 98%;\n\n  --secondary: 271 76% 67%;\n\n  --secondary-foreground: 210 20% 98%;\n  \n  --success: 158 64% 52%;\n  \n  --success-foreground: 210 20% 98%;\n  \n  --warning: 38 92% 50%;\n  \n  --warning-foreground: 215 25% 15%;\n  \n  --gamification: 328 86% 70%;\n  \n  --gamification-foreground: 210 20% 98%;\n\n  --muted: 215 14% 16%;\n\n  --muted-foreground: 210 16% 65%;\n\n  --accent: 215 14% 18%;\n\n  --accent-foreground: 210 20% 92%;\n\n  --destructive: 0 84% 60%;\n\n  --destructive-foreground: 210 20% 98%;\n\n  --input: 215 16% 35%;\n  --ring: 239 84% 67%;\n  --chart-1: 239 84% 67%;\n  --chart-2: 277 92% 69%;\n  --chart-3: 158 64% 52%;\n  --chart-4: 38 92% 50%;\n  --chart-5: 328 86% 70%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.15);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.2);\n  --shadow-sm: 0px 1px 2px 0px hsl(0 0% 0% / 0.15), 0px 1px 3px -1px hsl(0 0% 0% / 0.2);\n  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.2), 0px 1px 2px -1px hsl(0 0% 0% / 0.2);\n  --shadow-md: 0px 4px 6px -1px hsl(0 0% 0% / 0.2), 0px 2px 4px -2px hsl(0 0% 0% / 0.2);\n  --shadow-lg: 0px 10px 15px -3px hsl(0 0% 0% / 0.2), 0px 4px 6px -4px hsl(0 0% 0% / 0.2);\n  --shadow-xl: 0px 20px 25px -5px hsl(0 0% 0% / 0.2), 0px 8px 10px -6px hsl(0 0% 0% / 0.2);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.35);\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --success-border: hsl(from hsl(var(--success)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --warning-border: hsl(from hsl(var(--warning)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --gamification-border: hsl(from hsl(var(--gamification)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":12153},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nlet globalSessionStore: any = null;\n\nexport function getSessionStore() {\n  if (!globalSessionStore) {\n    const pgStore = connectPg(session);\n    globalSessionStore = new pgStore({\n      conString: process.env.DATABASE_URL,\n      createTableIfMissing: false,\n      ttl: 7 * 24 * 60 * 60 * 1000, // 1 week\n      tableName: \"sessions\",\n    });\n  }\n  return globalSessionStore;\n}\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const sessionStore = getSessionStore();\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  // Keep track of registered strategies\n  const registeredStrategies = new Set<string>();\n\n  // Helper function to ensure strategy exists for a domain\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4684},"client/src/pages/quizzes.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sparkles, Play, FileText, Trophy, AlertTriangle, Target } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { Quiz, QuizWithQuestions, QuizAttempt, StudyMaterial } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport default function Quizzes() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [questionCount, setQuestionCount] = useState(\"10\");\n  const [activeQuiz, setActiveQuiz] = useState<QuizWithQuestions | null>(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [answers, setAnswers] = useState<Record<number, string>>({});\n  const [tabSwitchCount, setTabSwitchCount] = useState(0);\n  const [isQuizCancelled, setIsQuizCancelled] = useState(false);\n  const startTimeRef = useRef<number>(0);\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  // Tab switch detection\n  useEffect(() => {\n    if (!activeQuiz || isQuizCancelled) return;\n\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        setTabSwitchCount((prev) => prev + 1);\n        setIsQuizCancelled(true);\n        toast({\n          title: \"Quiz Cancelled\",\n          description: \"Tab switching detected. Your quiz attempt has been cancelled.\",\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => {\n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n    };\n  }, [activeQuiz, isQuizCancelled, toast]);\n\n  const { data: materials } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: quizzes } = useQuery<QuizWithQuestions[]>({\n    queryKey: [\"/api/quizzes\", selectedMaterial],\n    queryFn: async () => {\n      const url = selectedMaterial \n        ? `/api/quizzes?materialId=${selectedMaterial}`\n        : \"/api/quizzes\";\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch quizzes\");\n      return response.json();\n    },\n    enabled: isAuthenticated,\n  });\n\n  const { data: attempts } = useQuery<QuizAttempt[]>({\n    queryKey: [\"/api/quiz-attempts\"],\n    enabled: isAuthenticated,\n  });\n\n  const generateMutation = useMutation<QuizWithQuestions, Error, void>({\n    mutationFn: async () => {\n      if (!selectedMaterial) throw new Error(\"No material selected\");\n      const response = await apiRequest(\"POST\", \"/api/quizzes/generate\", {\n        materialId: selectedMaterial,\n        questionCount: parseInt(questionCount),\n      });\n      return response.json();\n    },\n    onSuccess: (quiz: QuizWithQuestions) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/quizzes\", selectedMaterial] });\n      toast({\n        title: \"Success\",\n        description: \"Quiz generated successfully!\",\n      });\n      startQuiz(quiz);\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate quiz\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const submitAttemptMutation = useMutation({\n    mutationFn: async (attemptData: any) => {\n      return await apiRequest(\"POST\", \"/api/quiz-attempts\", attemptData);\n    },\n    onSuccess: (data: any, variables: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/quiz-attempts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/quizzes\"] });\n      \n      if (variables.isCancelled) {\n        toast({\n          title: \"Quiz Cancelled\",\n          description: \"Your attempt was cancelled due to tab switching\",\n          variant: \"destructive\",\n        });\n      } else {\n        const score = variables.score;\n        const correctAnswers = variables.correctAnswers;\n        const totalQuestions = variables.totalQuestions;\n        toast({\n          title: \"Quiz Submitted!\",\n          description: `You scored ${score}% (${correctAnswers}/${totalQuestions} correct)`,\n        });\n      }\n      \n      setActiveQuiz(null);\n      setAnswers({});\n      setCurrentQuestionIndex(0);\n      setTabSwitchCount(0);\n      setIsQuizCancelled(false);\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to submit quiz\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const startQuiz = (quiz: QuizWithQuestions) => {\n    // Safety check: ensure quiz has questions array\n    if (!quiz.questions || !Array.isArray(quiz.questions) || quiz.questions.length === 0) {\n      toast({\n        title: \"Error\",\n        description: \"This quiz has no questions\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setActiveQuiz(quiz);\n    setAnswers({});\n    setCurrentQuestionIndex(0);\n    setTabSwitchCount(0);\n    setIsQuizCancelled(false);\n    startTimeRef.current = Date.now();\n  };\n\n  const handleGenerate = () => {\n    if (!selectedMaterial) {\n      toast({\n        title: \"No Material Selected\",\n        description: \"Please select a study material first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateMutation.mutate();\n  };\n\n  const handleAnswerChange = (answer: string) => {\n    setAnswers({ ...answers, [currentQuestionIndex]: answer });\n  };\n\n  const handleNext = () => {\n    if (currentQuestionIndex < (activeQuiz?.questions?.length || 0) - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (!activeQuiz || !activeQuiz.questions || !Array.isArray(activeQuiz.questions)) return;\n\n    if (isQuizCancelled) {\n      submitAttemptMutation.mutate({\n        quizId: activeQuiz.id,\n        answers: {},\n        score: 0,\n        totalQuestions: activeQuiz.questions.length,\n        correctAnswers: 0,\n        timeSpentSeconds: Math.floor((Date.now() - startTimeRef.current) / 1000),\n        isCancelled: true,\n      });\n      return;\n    }\n\n    let correctCount = 0;\n    activeQuiz.questions.forEach((q, index: number) => {\n      if (answers[index] === q.correctAnswer) {\n        correctCount++;\n      }\n    });\n\n    const score = Math.round((correctCount / activeQuiz.questions.length) * 100);\n\n    submitAttemptMutation.mutate({\n      quizId: activeQuiz.id,\n      answers,\n      score,\n      totalQuestions: activeQuiz.questions.length,\n      correctAnswers: correctCount,\n      timeSpentSeconds: Math.floor((Date.now() - startTimeRef.current) / 1000),\n      isCancelled: false,\n    });\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  if (activeQuiz && activeQuiz.questions && activeQuiz.questions.length > 0) {\n    const currentQuestion = activeQuiz.questions[currentQuestionIndex];\n    if (!currentQuestion) {\n      // Safety: if current question is undefined, reset quiz\n      setActiveQuiz(null);\n      setCurrentQuestionIndex(0);\n      return null;\n    }\n    const progress = ((currentQuestionIndex + 1) / activeQuiz.questions.length) * 100;\n    const answeredCount = Object.keys(answers).length;\n\n    return (\n      <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-4xl\">\n        <AnimatePresence>\n          {isQuizCancelled && (\n            <motion.div\n              initial={{ opacity: 0, y: -20, scale: 0.95 }}\n              animate={{ opacity: 1, y: 0, scale: 1 }}\n              exit={{ opacity: 0, y: -20, scale: 0.95 }}\n              transition={{ duration: 0.3 }}\n            >\n              <Card className=\"p-4 mb-6 bg-destructive/10 border-2 border-destructive\" data-testid=\"card-cancelled\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-full bg-gradient-to-br from-destructive/30 to-destructive/10\">\n                    <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n                  </div>\n                  <p className=\"text-destructive font-semibold\">\n                    Quiz Cancelled - Tab switching detected\n                  </p>\n                </div>\n              </Card>\n            </motion.div>\n          )}\n        </AnimatePresence>\n\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5 }}\n          className=\"mb-6\"\n        >\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-2 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10\">\n              <Target className=\"h-5 w-5 md:h-6 md:w-6 text-primary\" />\n            </div>\n            <h1 className=\"font-heading font-bold text-xl md:text-2xl\" data-testid=\"text-quiz-title\">\n              {activeQuiz.title}\n            </h1>\n          </div>\n          <div className=\"flex items-center justify-between text-sm md:text-base text-muted-foreground mb-3\">\n            <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border\">\n              <div className=\"h-2 w-2 rounded-full bg-primary animate-pulse\"></div>\n              <span className=\"font-medium\">\n                Question {currentQuestionIndex + 1} of {activeQuiz.questions.length}\n              </span>\n            </div>\n            <p className=\"font-medium\">\n              Answered: {answeredCount}/{activeQuiz.questions.length}\n            </p>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </motion.div>\n\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={currentQuestionIndex}\n            initial={{ opacity: 0, x: 20, scale: 0.98 }}\n            animate={{ opacity: 1, x: 0, scale: 1 }}\n            exit={{ opacity: 0, x: -20, scale: 0.98 }}\n            transition={{ duration: 0.3, ease: [0.43, 0.13, 0.23, 0.96] }}\n          >\n            <Card className=\"p-6 md:p-8 mb-6 border-2 shadow-lg\" data-testid={`card-question-${currentQuestionIndex}`}>\n              <motion.h2\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.1 }}\n                className=\"font-heading font-semibold text-lg md:text-xl mb-6 leading-relaxed\"\n              >\n                {currentQuestion.question}\n              </motion.h2>\n              <RadioGroup\n                value={answers[currentQuestionIndex] || \"\"}\n                onValueChange={handleAnswerChange}\n                disabled={isQuizCancelled}\n              >\n                {currentQuestion.options.map((option: string, index: number) => (\n                  <motion.div\n                    key={index}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: 0.15 + index * 0.05 }}\n                    className=\"flex items-center space-x-3 p-4 rounded-xl hover-elevate border-2 mb-3 last:mb-0\"\n                    data-testid={`option-${index}`}\n                  >\n                    <RadioGroupItem value={option} id={`option-${index}`} />\n                    <Label htmlFor={`option-${index}`} className=\"flex-1 cursor-pointer text-sm md:text-base\">\n                      {option}\n                    </Label>\n                  </motion.div>\n                ))}\n              </RadioGroup>\n            </Card>\n          </motion.div>\n        </AnimatePresence>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.2 }}\n          className=\"flex flex-col sm:flex-row justify-between gap-4\"\n        >\n          <Button\n            variant=\"outline\"\n            onClick={handlePrevious}\n            disabled={currentQuestionIndex === 0}\n            data-testid=\"button-previous\"\n            className=\"w-full sm:w-auto shadow-sm\"\n          >\n            Previous\n          </Button>\n          <div className=\"flex gap-2 justify-end\">\n            {currentQuestionIndex === activeQuiz.questions.length - 1 ? (\n              <Button\n                onClick={handleSubmit}\n                disabled={isQuizCancelled && submitAttemptMutation.isPending}\n                data-testid=\"button-submit\"\n                className=\"w-full sm:w-auto shadow-sm\"\n              >\n                {submitAttemptMutation.isPending ? \"Submitting...\" : \"Submit Quiz\"}\n              </Button>\n            ) : (\n              <Button\n                onClick={handleNext}\n                disabled={isQuizCancelled}\n                data-testid=\"button-next\"\n                className=\"w-full sm:w-auto shadow-sm\"\n              >\n                Next\n              </Button>\n            )}\n          </div>\n        </motion.div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-6xl\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"mb-6 md:mb-8\"\n      >\n        <div className=\"flex items-center gap-3 mb-6\">\n          <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm\">\n            <Target className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h1 className=\"font-heading font-bold text-2xl md:text-3xl\" data-testid=\"text-quizzes-title\">\n              Quizzes\n            </h1>\n            <p className=\"text-muted-foreground text-sm md:text-base\" data-testid=\"text-quizzes-subtitle\">\n              Test your knowledge with AI-generated quizzes\n            </p>\n          </div>\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.1 }}\n          className=\"grid md:grid-cols-3 gap-4 mb-6\"\n        >\n          <div className=\"md:col-span-2\">\n            <Label className=\"mb-2 block text-sm font-medium\">Study Material</Label>\n            <Select value={selectedMaterial || \"\"} onValueChange={(val) => setSelectedMaterial(val || null)}>\n              <SelectTrigger data-testid=\"select-material\" className=\"border-2\">\n                <SelectValue placeholder=\"Select study material\" />\n              </SelectTrigger>\n              <SelectContent>\n                {materials?.map((material) => (\n                  <SelectItem key={material.id} value={material.id} data-testid={`option-material-${material.id}`}>\n                    {material.title}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div>\n            <Label className=\"mb-2 block text-sm font-medium\">Questions</Label>\n            <Input\n              type=\"number\"\n              min=\"5\"\n              max=\"20\"\n              value={questionCount}\n              onChange={(e) => setQuestionCount(e.target.value)}\n              data-testid=\"input-count\"\n              className=\"border-2\"\n            />\n          </div>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.2 }}\n        >\n          <Button\n            onClick={handleGenerate}\n            disabled={!selectedMaterial || generateMutation.isPending}\n            className=\"w-full sm:w-auto mb-8 shadow-sm\"\n            data-testid=\"button-generate\"\n          >\n            <Sparkles className=\"h-4 w-4 mr-2\" />\n            {generateMutation.isPending ? \"Generating...\" : \"Generate Quiz\"}\n          </Button>\n        </motion.div>\n      </motion.div>\n\n      <AnimatePresence mode=\"wait\">\n        {quizzes && quizzes.length > 0 ? (\n          <motion.div\n            key=\"quizzes\"\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            transition={{ duration: 0.3 }}\n            className=\"grid md:grid-cols-2 gap-6\"\n          >\n            {quizzes.map((quiz, index) => {\n              const quizAttempts = attempts?.filter((a) => a.quizId === quiz.id) || [];\n              const bestScore = quizAttempts.length > 0\n                ? Math.max(...quizAttempts.map((a) => a.score))\n                : null;\n\n              return (\n                <motion.div\n                  key={quiz.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  transition={{ duration: 0.3, delay: index * 0.1 }}\n                >\n                  <Card className=\"p-6 hover-elevate border-2 shadow-sm\" data-testid={`card-quiz-${quiz.id}`}>\n                    <div className=\"flex items-start gap-4 mb-4\">\n                      <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex-shrink-0\">\n                        <FileText className=\"h-6 w-6 text-primary\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-heading font-semibold text-lg mb-1\">\n                          {quiz.title}\n                        </h3>\n                        <p className=\"text-sm text-muted-foreground mb-2\">\n                          {quiz.questions.length} questions\n                        </p>\n                        {bestScore !== null && (\n                          <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-br from-gamification/20 to-gamification/10 border\">\n                            <Trophy className=\"h-3 w-3 text-gamification\" />\n                            <p className=\"text-xs font-semibold text-gamification\">\n                              Best: {bestScore}%\n                            </p>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    <Button\n                      onClick={() => startQuiz(quiz)}\n                      className=\"w-full shadow-sm\"\n                      data-testid={`button-start-${quiz.id}`}\n                    >\n                      <Play className=\"h-4 w-4 mr-2\" />\n                      Start Quiz\n                    </Button>\n                  </Card>\n                </motion.div>\n              );\n            })}\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"empty\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            transition={{ duration: 0.5 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2 border-dashed max-w-2xl mx-auto\" data-testid=\"card-empty-state\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-block p-4 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4\"\n              >\n                <Target className=\"h-12 w-12 md:h-16 md:w-16 text-primary\" />\n              </motion.div>\n              <motion.h3\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"font-heading font-semibold text-lg md:text-xl mb-2\"\n              >\n                No Quizzes Yet\n              </motion.h3>\n              <motion.p\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"text-muted-foreground mb-4 text-sm md:text-base\"\n              >\n                {selectedMaterial\n                  ? \"Generate a quiz with AI to get started and test your knowledge\"\n                  : \"Select a study material above to begin creating quizzes\"}\n              </motion.p>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.5 }}\n                className=\"flex items-center gap-1 justify-center text-xs text-muted-foreground\"\n              >\n                <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse\"></div>\n                <span>Powered by AI</span>\n              </motion.div>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","size_bytes":22664},"client/src/pages/summaries.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sparkles, FileText, Loader2, Volume2, VolumeX, FileStack, Play, Pause, RotateCcw } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { Summary, StudyMaterial } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Slider } from \"@/components/ui/slider\";\n\n// Custom Audio Player Component\nfunction CustomAudioPlayer({ audioUrl }: { audioUrl: string }) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [isMuted, setIsMuted] = useState(false);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const updateTime = () => setCurrentTime(audio.currentTime);\n    const updateDuration = () => setDuration(audio.duration);\n    const handleEnded = () => setIsPlaying(false);\n\n    audio.addEventListener(\"timeupdate\", updateTime);\n    audio.addEventListener(\"loadedmetadata\", updateDuration);\n    audio.addEventListener(\"ended\", handleEnded);\n\n    return () => {\n      audio.removeEventListener(\"timeupdate\", updateTime);\n      audio.removeEventListener(\"loadedmetadata\", updateDuration);\n      audio.removeEventListener(\"ended\", handleEnded);\n    };\n  }, []);\n\n  const togglePlay = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.pause();\n    } else {\n      audio.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const toggleMute = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.muted = !isMuted;\n    setIsMuted(!isMuted);\n  };\n\n  const handleSeek = (value: number[]) => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.currentTime = value[0];\n    setCurrentTime(value[0]);\n  };\n\n  const handleRestart = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.currentTime = 0;\n    setCurrentTime(0);\n  };\n\n  const formatTime = (time: number) => {\n    if (isNaN(time)) return \"0:00\";\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, \"0\")}`;\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: -10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.4 }}\n      className=\"mb-6\"\n    >\n      <Card className=\"p-6 border-2 bg-gradient-to-br from-primary/5 to-primary/10\" data-testid=\"audio-player-container\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <div className=\"p-2 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10\">\n            <Volume2 className=\"h-5 w-5 text-primary\" />\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold\">Listen to Summary</p>\n            <p className=\"text-xs text-muted-foreground\">AI-powered audio narration</p>\n          </div>\n        </div>\n\n        <audio ref={audioRef} src={audioUrl} preload=\"metadata\" />\n\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-xs font-medium text-muted-foreground min-w-[45px]\">\n              {formatTime(currentTime)}\n            </span>\n            <Slider\n              value={[currentTime]}\n              max={duration || 100}\n              step={0.1}\n              onValueChange={handleSeek}\n              className=\"flex-1\"\n              data-testid=\"audio-slider\"\n            />\n            <span className=\"text-xs font-medium text-muted-foreground min-w-[45px]\">\n              {formatTime(duration)}\n            </span>\n          </div>\n\n          <div className=\"flex items-center justify-center gap-2\">\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={handleRestart}\n              className=\"h-9 w-9\"\n              data-testid=\"button-restart\"\n            >\n              <RotateCcw className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              size=\"icon\"\n              onClick={togglePlay}\n              className=\"h-12 w-12\"\n              data-testid=\"button-play-pause\"\n            >\n              {isPlaying ? (\n                <Pause className=\"h-5 w-5\" />\n              ) : (\n                <Play className=\"h-5 w-5 ml-0.5\" />\n              )}\n            </Button>\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={toggleMute}\n              className=\"h-9 w-9\"\n              data-testid=\"button-mute\"\n            >\n              {isMuted ? (\n                <VolumeX className=\"h-4 w-4\" />\n              ) : (\n                <Volume2 className=\"h-4 w-4\" />\n              )}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </motion.div>\n  );\n}\n\nexport default function Summaries() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: materials } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: summary, isLoading: summaryLoading } = useQuery<Summary | null>({\n    queryKey: [\"/api/summaries\", selectedMaterial],\n    queryFn: async () => {\n      if (!selectedMaterial) return null;\n      const response = await fetch(`/api/summaries?materialId=${selectedMaterial}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch summary\");\n      return response.json();\n    },\n    enabled: isAuthenticated && !!selectedMaterial,\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedMaterial) throw new Error(\"No material selected\");\n      return await apiRequest(\"POST\", \"/api/summaries/generate\", {\n        materialId: selectedMaterial,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/summaries\", selectedMaterial] });\n      toast({\n        title: \"Success\",\n        description: \"Summary generated successfully!\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate summary\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerate = () => {\n    if (!selectedMaterial) {\n      toast({\n        title: \"No Material Selected\",\n        description: \"Please select a study material first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateMutation.mutate();\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-5xl\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"mb-6 md:mb-8\"\n      >\n        <div className=\"flex items-center gap-3 mb-6\">\n          <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm\">\n            <FileStack className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h1 className=\"font-heading font-bold text-2xl md:text-3xl\" data-testid=\"text-summaries-title\">\n              AI Summaries\n            </h1>\n            <p className=\"text-muted-foreground text-sm md:text-base\" data-testid=\"text-summaries-subtitle\">\n              Get comprehensive AI-generated summaries of your study materials\n            </p>\n          </div>\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.1 }}\n          className=\"mb-6\"\n        >\n          <Label className=\"mb-2 block text-sm font-medium\">Study Material</Label>\n          <Select value={selectedMaterial || \"\"} onValueChange={(val) => setSelectedMaterial(val || null)}>\n            <SelectTrigger data-testid=\"select-material\" className=\"border-2\">\n              <SelectValue placeholder=\"Select study material\" />\n            </SelectTrigger>\n            <SelectContent>\n              {materials?.map((material) => (\n                <SelectItem key={material.id} value={material.id} data-testid={`option-material-${material.id}`}>\n                  {material.title}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </motion.div>\n\n        <AnimatePresence>\n          {selectedMaterial && !summary && !summaryLoading && (\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -10 }}\n              transition={{ duration: 0.3 }}\n              className=\"mb-6\"\n            >\n              <Button\n                onClick={handleGenerate}\n                disabled={generateMutation.isPending}\n                data-testid=\"button-generate\"\n                className=\"w-full sm:w-auto shadow-sm\"\n              >\n                <Sparkles className=\"h-4 w-4 mr-2\" />\n                {generateMutation.isPending ? \"Generating...\" : \"Generate Summary\"}\n              </Button>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n\n      <AnimatePresence mode=\"wait\">\n        {summaryLoading ? (\n          <motion.div\n            key=\"loading\"\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            transition={{ duration: 0.3 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2\">\n              <motion.div\n                animate={{ rotate: 360 }}\n                transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n              >\n                <Loader2 className=\"h-12 w-12 mx-auto mb-4 text-primary\" />\n              </motion.div>\n              <p className=\"text-muted-foreground font-medium\">Loading summary...</p>\n            </Card>\n          </motion.div>\n        ) : generateMutation.isPending ? (\n          <motion.div\n            key=\"generating\"\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            transition={{ duration: 0.3 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2 bg-gradient-to-br from-primary/5 to-primary/10\">\n              <motion.div\n                animate={{ rotate: 360 }}\n                transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n              >\n                <Loader2 className=\"h-12 w-12 mx-auto mb-4 text-primary\" />\n              </motion.div>\n              <p className=\"text-muted-foreground font-medium mb-2\">Generating summary with AI...</p>\n              <p className=\"text-xs text-muted-foreground\">This may take a moment</p>\n            </Card>\n          </motion.div>\n        ) : summary ? (\n          <motion.div\n            key=\"summary\"\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -20 }}\n            transition={{ duration: 0.4 }}\n          >\n            <Card className=\"p-6 md:p-8 border-2 shadow-lg\" data-testid=\"card-summary\">\n              {summary.audioUrl && <CustomAudioPlayer audioUrl={summary.audioUrl} />}\n              \n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.2, duration: 0.4 }}\n                className=\"prose prose-sm md:prose max-w-none dark:prose-invert\"\n              >\n                <div className=\"whitespace-pre-wrap leading-relaxed\">{summary.content}</div>\n              </motion.div>\n              \n              <motion.div\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3, duration: 0.4 }}\n                className=\"mt-6 pt-6 border-t flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\"\n              >\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-2 w-2 rounded-full bg-primary animate-pulse\"></div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Generated on {new Date(summary.createdAt).toLocaleDateString()}\n                  </p>\n                </div>\n                <Button\n                  onClick={handleGenerate}\n                  variant=\"outline\"\n                  disabled={generateMutation.isPending}\n                  data-testid=\"button-regenerate\"\n                  className=\"w-full sm:w-auto shadow-sm\"\n                >\n                  <Sparkles className=\"h-4 w-4 mr-2\" />\n                  Regenerate Summary\n                </Button>\n              </motion.div>\n            </Card>\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"empty\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            transition={{ duration: 0.5 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2 border-dashed max-w-2xl mx-auto\" data-testid=\"card-empty-state\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-block p-4 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4\"\n              >\n                <FileText className=\"h-12 w-12 md:h-16 md:w-16 text-primary\" />\n              </motion.div>\n              <motion.h3\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"font-heading font-semibold text-lg md:text-xl mb-2\"\n              >\n                No Summary Yet\n              </motion.h3>\n              <motion.p\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"text-muted-foreground mb-4 text-sm md:text-base\"\n              >\n                {selectedMaterial\n                  ? \"Generate a comprehensive AI summary to get started\"\n                  : \"Select a study material above to create a summary\"}\n              </motion.p>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.5 }}\n                className=\"flex items-center gap-1 justify-center text-xs text-muted-foreground\"\n              >\n                <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse\"></div>\n                <span>Powered by AI</span>\n              </motion.div>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","size_bytes":16719},"client/src/pages/todos.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Plus, Trash2, CheckCircle2, CheckSquare } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { Todo } from \"@shared/schema\";\n\nexport default function Todos() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [newTodoTitle, setNewTodoTitle] = useState(\"\");\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: todos, isLoading } = useQuery<Todo[]>({\n    queryKey: [\"/api/todos\"],\n    enabled: isAuthenticated,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (title: string) => {\n      return await apiRequest(\"POST\", \"/api/todos\", {\n        title,\n        isCompleted: false,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/todos\"] });\n      setNewTodoTitle(\"\");\n      toast({\n        title: \"Success\",\n        description: \"Todo created successfully!\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create todo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, isCompleted }: { id: string; isCompleted: boolean }) => {\n      return await apiRequest(\"PATCH\", `/api/todos/${id}`, { isCompleted });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/todos\"] });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update todo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/todos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/todos\"] });\n      toast({\n        title: \"Deleted\",\n        description: \"Todo deleted successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete todo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreate = () => {\n    if (!newTodoTitle.trim()) {\n      toast({\n        title: \"Empty Todo\",\n        description: \"Please enter a todo title\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createMutation.mutate(newTodoTitle);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      handleCreate();\n    }\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  const completedTodos = todos?.filter((t) => t.isCompleted) || [];\n  const pendingTodos = todos?.filter((t) => !t.isCompleted) || [];\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-3xl\">\n      <div className=\"mb-8 flex items-center gap-3\">\n        <CheckSquare className=\"h-8 w-8 text-primary\" />\n        <div className=\"flex-1\">\n          <h1 className=\"font-heading font-bold text-3xl md:text-4xl mb-2\" data-testid=\"text-todos-title\">\n            Todo List\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-todos-subtitle\">\n            Manage your study tasks and stay organized\n          </p>\n        </div>\n      </div>\n\n      <Card className=\"p-6 mb-8\">\n        <div className=\"flex gap-2\">\n          <Input\n            value={newTodoTitle}\n            onChange={(e) => setNewTodoTitle(e.target.value)}\n            onKeyDown={handleKeyPress}\n            placeholder=\"Add a new todo...\"\n            disabled={createMutation.isPending}\n            data-testid=\"input-new-todo\"\n          />\n          <Button\n            onClick={handleCreate}\n            disabled={!newTodoTitle.trim() || createMutation.isPending}\n            data-testid=\"button-create\"\n          >\n            <Plus className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </Card>\n\n      {isLoading ? (\n        <div className=\"text-center py-8\">\n          <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading todos...</p>\n        </div>\n      ) : (\n        <div className=\"space-y-6\">\n          {pendingTodos.length > 0 && (\n            <div>\n              <h2 className=\"font-heading font-semibold text-lg mb-4\">Pending</h2>\n              <div className=\"space-y-2\">\n                {pendingTodos.map((todo) => (\n                  <Card\n                    key={todo.id}\n                    className=\"p-4 hover-elevate\"\n                    data-testid={`card-todo-${todo.id}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <Checkbox\n                        checked={todo.isCompleted}\n                        onCheckedChange={(checked) =>\n                          updateMutation.mutate({ id: todo.id, isCompleted: checked as boolean })\n                        }\n                        data-testid={`checkbox-${todo.id}`}\n                      />\n                      <span className=\"flex-1\">{todo.title}</span>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => deleteMutation.mutate(todo.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-${todo.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {completedTodos.length > 0 && (\n            <div>\n              <h2 className=\"font-heading font-semibold text-lg mb-4\">Completed</h2>\n              <div className=\"space-y-2\">\n                {completedTodos.map((todo) => (\n                  <Card\n                    key={todo.id}\n                    className=\"p-4 opacity-60 hover-elevate\"\n                    data-testid={`card-todo-${todo.id}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <CheckCircle2 className=\"h-5 w-5 text-success\" />\n                      <span className=\"flex-1 line-through\">{todo.title}</span>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => deleteMutation.mutate(todo.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-${todo.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {!todos || todos.length === 0 ? (\n            <Card className=\"p-12 text-center\" data-testid=\"card-empty-state\">\n              <CheckCircle2 className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n              <h3 className=\"font-heading font-semibold text-lg mb-2\">No Todos Yet</h3>\n              <p className=\"text-muted-foreground\">Add your first todo to get started</p>\n            </Card>\n          ) : null}\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":9456},"client/src/pages/flashcards.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Sparkles,\n  Plus,\n  Trash2,\n  ChevronLeft,\n  ChevronRight,\n  RotateCw,\n  FileText,\n} from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { Flashcard, StudyMaterial } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport default function Flashcards() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [currentCardIndex, setCurrentCardIndex] = useState(0);\n  const [isFlipped, setIsFlipped] = useState(false);\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [newQuestion, setNewQuestion] = useState(\"\");\n  const [newAnswer, setNewAnswer] = useState(\"\");\n  const [generateCount, setGenerateCount] = useState(\"10\");\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: materials } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: flashcards, isLoading: flashcardsLoading } = useQuery<Flashcard[]>({\n    queryKey: [\"/api/flashcards\", selectedMaterial],\n    queryFn: async () => {\n      const url = selectedMaterial \n        ? `/api/flashcards?materialId=${selectedMaterial}`\n        : \"/api/flashcards\";\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch flashcards\");\n      return response.json();\n    },\n    enabled: isAuthenticated,\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedMaterial) throw new Error(\"No material selected\");\n      return await apiRequest(\"POST\", \"/api/flashcards/generate\", {\n        materialId: selectedMaterial,\n        count: parseInt(generateCount),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/flashcards\", selectedMaterial] });\n      toast({\n        title: \"Success\",\n        description: \"Flashcards generated successfully!\",\n      });\n      setCurrentCardIndex(0);\n      setIsFlipped(false);\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate flashcards\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/flashcards\", {\n        materialId: selectedMaterial,\n        question: newQuestion,\n        answer: newAnswer,\n        isAIGenerated: false,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/flashcards\", selectedMaterial] });\n      toast({\n        title: \"Success\",\n        description: \"Flashcard created successfully!\",\n      });\n      setIsCreateDialogOpen(false);\n      setNewQuestion(\"\");\n      setNewAnswer(\"\");\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create flashcard\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/flashcards/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/flashcards\", selectedMaterial] });\n      toast({\n        title: \"Deleted\",\n        description: \"Flashcard deleted successfully\",\n      });\n      if (currentCardIndex >= (flashcards?.length || 0) - 1) {\n        setCurrentCardIndex(Math.max(0, (flashcards?.length || 0) - 2));\n      }\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete flashcard\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFlip = () => setIsFlipped(!isFlipped);\n  \n  const handleNext = () => {\n    if (flashcards && currentCardIndex < flashcards.length - 1) {\n      setCurrentCardIndex(currentCardIndex + 1);\n      setIsFlipped(false);\n    }\n  };\n  \n  const handlePrevious = () => {\n    if (currentCardIndex > 0) {\n      setCurrentCardIndex(currentCardIndex - 1);\n      setIsFlipped(false);\n    }\n  };\n\n  const handleGenerate = () => {\n    if (!selectedMaterial) {\n      toast({\n        title: \"No Material Selected\",\n        description: \"Please select a study material first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateMutation.mutate();\n  };\n\n  const handleCreate = () => {\n    if (!newQuestion.trim() || !newAnswer.trim()) {\n      toast({\n        title: \"Incomplete Flashcard\",\n        description: \"Please fill in both question and answer\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    createMutation.mutate();\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  const currentCard = flashcards?.[currentCardIndex];\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-6xl\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"mb-6 md:mb-8\"\n      >\n        <div className=\"flex items-center gap-3 mb-6\">\n          <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm\">\n            <FileText className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n          </div>\n          <div className=\"flex-1\">\n            <h1 className=\"font-heading font-bold text-2xl md:text-3xl\" data-testid=\"text-flashcards-title\">\n              Flashcards\n            </h1>\n            <p className=\"text-muted-foreground text-sm md:text-base\" data-testid=\"text-flashcards-subtitle\">\n              AI-generated or create your own flashcards for effective studying\n            </p>\n          </div>\n        </div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.1 }}\n          className=\"grid md:grid-cols-3 gap-4 mb-6\"\n        >\n          <div className=\"md:col-span-2\">\n            <Label className=\"mb-2 block text-sm font-medium\">Study Material</Label>\n            <Select value={selectedMaterial || \"\"} onValueChange={(val) => setSelectedMaterial(val || null)}>\n              <SelectTrigger data-testid=\"select-material\" className=\"border-2\">\n                <SelectValue placeholder=\"Select study material\" />\n              </SelectTrigger>\n              <SelectContent>\n                {materials?.map((material) => (\n                  <SelectItem key={material.id} value={material.id} data-testid={`option-material-${material.id}`}>\n                    {material.title}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <div>\n            <Label className=\"mb-2 block text-sm font-medium\">Number of Cards</Label>\n            <Input\n              type=\"number\"\n              min=\"5\"\n              max=\"20\"\n              value={generateCount}\n              onChange={(e) => setGenerateCount(e.target.value)}\n              data-testid=\"input-count\"\n              className=\"border-2\"\n            />\n          </div>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.4, delay: 0.2 }}\n          className=\"flex gap-2 mb-8 flex-wrap\"\n        >\n          <Button\n            onClick={handleGenerate}\n            disabled={!selectedMaterial || generateMutation.isPending}\n            data-testid=\"button-generate\"\n            className=\"shadow-sm\"\n          >\n            <Sparkles className=\"h-4 w-4 mr-2\" />\n            {generateMutation.isPending ? \"Generating...\" : \"Generate with AI\"}\n          </Button>\n          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-create\" className=\"shadow-sm\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Manually\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create Flashcard</DialogTitle>\n                <DialogDescription>Add a new flashcard manually</DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"question\">Question</Label>\n                  <Textarea\n                    id=\"question\"\n                    value={newQuestion}\n                    onChange={(e) => setNewQuestion(e.target.value)}\n                    placeholder=\"Enter question...\"\n                    data-testid=\"input-question\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"answer\">Answer</Label>\n                  <Textarea\n                    id=\"answer\"\n                    value={newAnswer}\n                    onChange={(e) => setNewAnswer(e.target.value)}\n                    placeholder=\"Enter answer...\"\n                    data-testid=\"input-answer\"\n                  />\n                </div>\n              </div>\n              <DialogFooter>\n                <Button onClick={handleCreate} disabled={createMutation.isPending} data-testid=\"button-save\">\n                  {createMutation.isPending ? \"Creating...\" : \"Create Flashcard\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </motion.div>\n      </motion.div>\n\n      <AnimatePresence mode=\"wait\">\n        {flashcardsLoading ? (\n          <motion.div\n            key=\"loading\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"text-center py-12\"\n          >\n            <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n            <p className=\"mt-4 text-muted-foreground font-medium\">Loading flashcards...</p>\n          </motion.div>\n        ) : flashcards && flashcards.length > 0 ? (\n          <motion.div\n            key=\"flashcards\"\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            transition={{ duration: 0.3 }}\n            className=\"max-w-4xl mx-auto\"\n          >\n            <motion.div\n              initial={{ opacity: 0, y: -10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.3 }}\n              className=\"mb-6 text-center\"\n            >\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 backdrop-blur-sm border-2\">\n                <span className=\"text-sm font-medium\">\n                  Card {currentCardIndex + 1} of {flashcards.length}\n                </span>\n              </div>\n            </motion.div>\n            \n            <div className=\"perspective-1000 mb-8\" style={{ perspective: \"1000px\" }}>\n              <AnimatePresence mode=\"wait\" initial={false}>\n                <motion.div\n                  key={`${currentCard?.id}-${isFlipped}`}\n                  initial={{ rotateY: isFlipped ? -180 : 0, opacity: 0 }}\n                  animate={{ rotateY: 0, opacity: 1 }}\n                  exit={{ rotateY: isFlipped ? 180 : -180, opacity: 0 }}\n                  transition={{ duration: 0.6, ease: [0.43, 0.13, 0.23, 0.96] }}\n                  style={{ transformStyle: \"preserve-3d\" }}\n                  onClick={handleFlip}\n                  className=\"cursor-pointer\"\n                  data-testid={`card-flashcard-${currentCard?.id}`}\n                >\n                  <Card className=\"p-8 md:p-12 min-h-[24rem] md:min-h-[28rem] flex items-center justify-center border-2 shadow-lg hover-elevate\">\n                    <div className=\"text-center max-w-2xl\">\n                      <motion.div\n                        initial={{ opacity: 0, y: 10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.2 }}\n                      >\n                        <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-6\">\n                          <div className=\"h-2 w-2 rounded-full bg-primary animate-pulse\"></div>\n                          <span className=\"text-xs font-medium uppercase tracking-wide\">\n                            {isFlipped ? \"Answer\" : \"Question\"}\n                          </span>\n                        </div>\n                      </motion.div>\n                      \n                      <motion.h2\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.3 }}\n                        className=\"font-heading font-semibold text-xl md:text-3xl leading-relaxed mb-6\"\n                      >\n                        {isFlipped ? currentCard?.answer : currentCard?.question}\n                      </motion.h2>\n                      \n                      <motion.p\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.4 }}\n                        className=\"text-sm text-muted-foreground flex items-center gap-2 justify-center\"\n                      >\n                        <RotateCw className=\"h-3 w-3\" />\n                        Click to flip\n                      </motion.p>\n                    </div>\n                  </Card>\n                </motion.div>\n              </AnimatePresence>\n            </div>\n\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.4, delay: 0.3 }}\n              className=\"flex flex-col sm:flex-row justify-between items-center gap-4\"\n            >\n              <Button\n                variant=\"outline\"\n                onClick={handlePrevious}\n                disabled={currentCardIndex === 0}\n                data-testid=\"button-previous\"\n                className=\"w-full sm:w-auto shadow-sm\"\n              >\n                <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                Previous\n              </Button>\n              \n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={handleFlip}\n                  data-testid=\"button-flip\"\n                  className=\"shadow-sm\"\n                >\n                  <RotateCw className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => currentCard && deleteMutation.mutate(currentCard.id)}\n                  disabled={deleteMutation.isPending}\n                  data-testid=\"button-delete-current\"\n                  className=\"shadow-sm\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n\n              <Button\n                variant=\"outline\"\n                onClick={handleNext}\n                disabled={currentCardIndex === flashcards.length - 1}\n                data-testid=\"button-next\"\n                className=\"w-full sm:w-auto shadow-sm\"\n              >\n                Next\n                <ChevronRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </motion.div>\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"empty\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            transition={{ duration: 0.5 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2 border-dashed max-w-2xl mx-auto\" data-testid=\"card-empty-state\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-block p-4 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4\"\n              >\n                <FileText className=\"h-12 w-12 md:h-16 md:w-16 text-primary\" />\n              </motion.div>\n              <motion.h3\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"font-heading font-semibold text-lg md:text-xl mb-2\"\n              >\n                No Flashcards Yet\n              </motion.h3>\n              <motion.p\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"text-muted-foreground mb-4 text-sm md:text-base\"\n              >\n                {selectedMaterial\n                  ? \"Generate flashcards with AI or create them manually to get started\"\n                  : \"Select a study material above to begin creating flashcards\"}\n              </motion.p>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.5 }}\n                className=\"flex items-center gap-1 justify-center text-xs text-muted-foreground\"\n              >\n                <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse\"></div>\n                <span>Powered by AI</span>\n              </motion.div>\n            </Card>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","size_bytes":20165},"client/src/pages/pomodoro.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Play, Pause, RotateCcw, Settings, Clock, Timer, TrendingUp } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ntype PomodoroSession = {\n  id: string;\n  userId: string;\n  workDuration: number;\n  breakDuration: number;\n  completedCycles: number;\n  createdAt: string;\n};\n\ntype TimerState = \"idle\" | \"work\" | \"break\";\n\n// Circular Progress Component\nfunction CircularProgress({ \n  progress, \n  size = 280, \n  strokeWidth = 12,\n  state \n}: { \n  progress: number; \n  size?: number; \n  strokeWidth?: number;\n  state: TimerState;\n}) {\n  const radius = (size - strokeWidth) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const offset = circumference - (progress / 100) * circumference;\n\n  const getStateColors = () => {\n    switch (state) {\n      case \"work\":\n        return {\n          bg: \"stroke-primary/10\",\n          fg: \"stroke-primary\",\n          gradient: \"from-primary/20 to-primary/5\"\n        };\n      case \"break\":\n        return {\n          bg: \"stroke-green-500/10\",\n          fg: \"stroke-green-500\",\n          gradient: \"from-green-500/20 to-green-500/5\"\n        };\n      default:\n        return {\n          bg: \"stroke-muted\",\n          fg: \"stroke-primary/50\",\n          gradient: \"from-primary/10 to-primary/5\"\n        };\n    }\n  };\n\n  const colors = getStateColors();\n\n  return (\n    <div className=\"relative inline-flex items-center justify-center\">\n      <svg\n        width={size}\n        height={size}\n        className=\"transform -rotate-90\"\n      >\n        {/* Background circle */}\n        <circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          className={colors.bg}\n          strokeWidth={strokeWidth}\n        />\n        {/* Progress circle */}\n        <motion.circle\n          cx={size / 2}\n          cy={size / 2}\n          r={radius}\n          fill=\"none\"\n          className={colors.fg}\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n          initial={{ strokeDashoffset: circumference }}\n          animate={{ strokeDashoffset: offset }}\n          transition={{ duration: 0.5, ease: \"easeInOut\" }}\n        />\n      </svg>\n      <div className={`absolute inset-0 flex items-center justify-center rounded-full bg-gradient-to-br ${colors.gradient} m-4`} />\n    </div>\n  );\n}\n\nexport default function Pomodoro() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  \n  const [workDuration, setWorkDuration] = useState(25);\n  const [breakDuration, setBreakDuration] = useState(5);\n  const [timerState, setTimerState] = useState<TimerState>(\"idle\");\n  const [timeLeft, setTimeLeft] = useState(workDuration * 60);\n  const [completedCycles, setCompletedCycles] = useState(0);\n  const [isRunning, setIsRunning] = useState(false);\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  \n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const notificationPermissionRef = useRef<NotificationPermission | null>(null);\n\n  const { data: sessions } = useQuery<PomodoroSession[]>({\n    queryKey: [\"/api/pomodoro-sessions\"],\n    enabled: isAuthenticated,\n  });\n\n  const createSessionMutation = useMutation({\n    mutationFn: async (data: { workDuration: number; breakDuration: number; completedCycles: number }) => {\n      return await apiRequest(\"POST\", \"/api/pomodoro-sessions\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/pomodoro-sessions\"] });\n      toast({\n        title: \"Session Saved\",\n        description: `Completed ${completedCycles} cycle${completedCycles !== 1 ? 's' : ''}!`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    if (\"Notification\" in window) {\n      Notification.requestPermission().then((permission) => {\n        notificationPermissionRef.current = permission;\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isRunning) {\n      timerRef.current = setInterval(() => {\n        setTimeLeft((prev) => {\n          if (prev <= 1) {\n            handleTimerComplete();\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [isRunning, timerState]);\n\n  const showNotification = (title: string, body: string) => {\n    if (notificationPermissionRef.current === \"granted\") {\n      new Notification(title, { body, icon: \"/favicon.ico\" });\n    }\n  };\n\n  const handleTimerComplete = () => {\n    setIsRunning(false);\n    \n    if (timerState === \"work\") {\n      const newCycles = completedCycles + 1;\n      setCompletedCycles(newCycles);\n      \n      createSessionMutation.mutate({\n        workDuration,\n        breakDuration,\n        completedCycles: 1,\n      });\n      \n      setTimerState(\"break\");\n      setTimeLeft(breakDuration * 60);\n      showNotification(\"Work Session Complete!\", \"Great job! Time for a break.\");\n      toast({\n        title: \"Work Session Complete!\",\n        description: \"Time for a break\",\n      });\n    } else if (timerState === \"break\") {\n      setTimerState(\"work\");\n      setTimeLeft(workDuration * 60);\n      showNotification(\"Break Complete!\", \"Ready to focus again?\");\n      toast({\n        title: \"Break Complete!\",\n        description: \"Ready for another work session?\",\n      });\n    }\n  };\n\n  const handleStart = () => {\n    if (timerState === \"idle\") {\n      setTimerState(\"work\");\n      setTimeLeft(workDuration * 60);\n    }\n    setIsRunning(true);\n  };\n\n  const handlePause = () => {\n    setIsRunning(false);\n  };\n\n  const handleReset = () => {\n    setIsRunning(false);\n    setTimerState(\"idle\");\n    setTimeLeft(workDuration * 60);\n    setCompletedCycles(0);\n  };\n\n  const handleSettingsSave = (newWork: number, newBreak: number) => {\n    setWorkDuration(newWork);\n    setBreakDuration(newBreak);\n    \n    if (timerState === \"idle\" || !isRunning) {\n      setTimeLeft(newWork * 60);\n    }\n    \n    setSettingsOpen(false);\n    toast({\n      title: \"Settings Updated\",\n      description: `Work: ${newWork}min, Break: ${newBreak}min`,\n    });\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${String(mins).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`;\n  };\n\n  const totalStudyTime = sessions?.reduce((total, session) => {\n    return total + (session.workDuration * session.completedCycles);\n  }, 0) || 0;\n\n  if (!user) {\n    return null;\n  }\n\n  const getTotalDuration = () => {\n    return timerState === \"work\" ? workDuration * 60 : timerState === \"break\" ? breakDuration * 60 : workDuration * 60;\n  };\n\n  const progress = ((getTotalDuration() - timeLeft) / getTotalDuration()) * 100;\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-6xl\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"mb-6 md:mb-8\"\n      >\n        <div className=\"flex items-center gap-3 mb-2\">\n          <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm\">\n            <Timer className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-heading font-bold\" data-testid=\"text-page-title\">\n              Pomodoro Timer\n            </h1>\n            <p className=\"text-muted-foreground text-sm md:text-base\" data-testid=\"text-page-description\">\n              Stay focused with the Pomodoro Technique\n            </p>\n          </div>\n        </div>\n      </motion.div>\n\n      <div className=\"grid lg:grid-cols-3 gap-6\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.1 }}\n          className=\"lg:col-span-2\"\n        >\n          <Card className=\"p-6 md:p-8 border-2\">\n            <div className=\"text-center\">\n              <AnimatePresence mode=\"wait\">\n                <motion.div\n                  key={timerState}\n                  initial={{ scale: 0.9, opacity: 0 }}\n                  animate={{ scale: 1, opacity: 1 }}\n                  exit={{ scale: 0.9, opacity: 0 }}\n                  transition={{ duration: 0.3 }}\n                  className={`inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-br border mb-6 ${\n                    timerState === \"work\" \n                      ? \"from-primary/10 to-primary/5 border-primary/20\" \n                      : timerState === \"break\" \n                      ? \"from-green-500/10 to-green-500/5 border-green-500/20\" \n                      : \"from-muted/50 to-muted/30 border-muted\"\n                  }`}\n                >\n                  <Clock className={`h-4 w-4 ${\n                    timerState === \"work\" \n                      ? \"text-primary\" \n                      : timerState === \"break\" \n                      ? \"text-green-500\" \n                      : \"text-muted-foreground\"\n                  }`} />\n                  <span className=\"text-sm font-semibold\" data-testid=\"text-timer-state\">\n                    {timerState === \"idle\" && \"â³ Ready to Start\"}\n                    {timerState === \"work\" && \"ð¯ Focus Time\"}\n                    {timerState === \"break\" && \"â Break Time\"}\n                  </span>\n                </motion.div>\n              </AnimatePresence>\n              \n              <div className=\"relative flex justify-center mb-8\">\n                <CircularProgress progress={progress} size={280} strokeWidth={12} state={timerState} />\n                <motion.div\n                  key={timeLeft}\n                  initial={{ scale: 0.95 }}\n                  animate={{ scale: 1 }}\n                  className=\"absolute inset-0 flex flex-col items-center justify-center\"\n                >\n                  <div className=\"text-6xl md:text-7xl font-bold font-mono\" data-testid=\"text-timer-display\">\n                    {formatTime(timeLeft)}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground mt-2\">\n                    {timerState === \"work\" ? \"minutes of focus\" : timerState === \"break\" ? \"minutes of rest\" : \"ready when you are\"}\n                  </div>\n                </motion.div>\n              </div>\n\n              <div className=\"flex flex-wrap justify-center gap-3 mb-6\">\n                <AnimatePresence mode=\"wait\">\n                  {!isRunning ? (\n                    <motion.div\n                      key=\"start\"\n                      initial={{ scale: 0.9, opacity: 0 }}\n                      animate={{ scale: 1, opacity: 1 }}\n                      exit={{ scale: 0.9, opacity: 0 }}\n                    >\n                      <Button\n                        size=\"lg\"\n                        onClick={handleStart}\n                        data-testid=\"button-start\"\n                        className=\"shadow-lg min-w-[140px]\"\n                      >\n                        <Play className=\"h-5 w-5 mr-2\" />\n                        Start\n                      </Button>\n                    </motion.div>\n                  ) : (\n                    <motion.div\n                      key=\"pause\"\n                      initial={{ scale: 0.9, opacity: 0 }}\n                      animate={{ scale: 1, opacity: 1 }}\n                      exit={{ scale: 0.9, opacity: 0 }}\n                    >\n                      <Button\n                        size=\"lg\"\n                        onClick={handlePause}\n                        variant=\"secondary\"\n                        data-testid=\"button-pause\"\n                        className=\"shadow-lg min-w-[140px]\"\n                      >\n                        <Pause className=\"h-5 w-5 mr-2\" />\n                        Pause\n                      </Button>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n                \n                <Button\n                  size=\"lg\"\n                  onClick={handleReset}\n                  variant=\"outline\"\n                  data-testid=\"button-reset\"\n                  className=\"shadow-sm\"\n                >\n                  <RotateCcw className=\"h-5 w-5 mr-2\" />\n                  Reset\n                </Button>\n\n                <Dialog open={settingsOpen} onOpenChange={setSettingsOpen}>\n                  <DialogTrigger asChild>\n                    <Button\n                      size=\"lg\"\n                      variant=\"ghost\"\n                      data-testid=\"button-settings\"\n                    >\n                      <Settings className=\"h-5 w-5\" />\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"sm:max-w-md\">\n                    <DialogHeader>\n                      <DialogTitle>Timer Settings</DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"work-duration\">Work Duration (minutes)</Label>\n                        <Input\n                          id=\"work-duration\"\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"60\"\n                          defaultValue={workDuration}\n                          data-testid=\"input-work-duration\"\n                          className=\"border-2\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"break-duration\">Break Duration (minutes)</Label>\n                        <Input\n                          id=\"break-duration\"\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"30\"\n                          defaultValue={breakDuration}\n                          data-testid=\"input-break-duration\"\n                          className=\"border-2\"\n                        />\n                      </div>\n                      <Button\n                        onClick={() => {\n                          const workInput = document.getElementById(\"work-duration\") as HTMLInputElement;\n                          const breakInput = document.getElementById(\"break-duration\") as HTMLInputElement;\n                          handleSettingsSave(\n                            parseInt(workInput.value),\n                            parseInt(breakInput.value)\n                          );\n                        }}\n                        className=\"w-full shadow-sm\"\n                        data-testid=\"button-save-settings\"\n                      >\n                        Save Settings\n                      </Button>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n\n              <div className=\"border-t pt-6\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm text-muted-foreground\">Completed Cycles Today</span>\n                  <motion.span\n                    key={completedCycles}\n                    initial={{ scale: 1.2 }}\n                    animate={{ scale: 1 }}\n                    className=\"font-bold text-3xl text-primary\"\n                    data-testid=\"text-completed-cycles\"\n                  >\n                    {completedCycles}\n                  </motion.span>\n                </div>\n              </div>\n            </div>\n          </Card>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5, delay: 0.2 }}\n          className=\"space-y-6\"\n        >\n          <Card className=\"p-6 border-2\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <div className=\"p-2 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10\">\n                <TrendingUp className=\"h-4 w-4 text-primary\" />\n              </div>\n              <h3 className=\"font-semibold\">Session Stats</h3>\n            </div>\n            <div className=\"space-y-5\">\n              <div className=\"p-4 rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 border border-primary/20\">\n                <div className=\"text-xs text-muted-foreground mb-2\">Total Study Time</div>\n                <div className=\"text-2xl md:text-3xl font-bold text-primary\" data-testid=\"text-total-study-time\">\n                  {Math.floor(totalStudyTime / 60)}h {totalStudyTime % 60}m\n                </div>\n              </div>\n              <div className=\"p-4 rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 border border-primary/20\">\n                <div className=\"text-xs text-muted-foreground mb-2\">Total Sessions</div>\n                <div className=\"text-2xl md:text-3xl font-bold text-primary\" data-testid=\"text-total-sessions\">\n                  {sessions?.length || 0}\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          <Card className=\"p-6 border-2\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <div className=\"p-2 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10\">\n                <Clock className=\"h-4 w-4 text-primary\" />\n              </div>\n              <h3 className=\"font-semibold\">How it Works</h3>\n            </div>\n            <ol className=\"text-sm text-muted-foreground space-y-3\">\n              {[\n                \"Set your work and break durations\",\n                \"Focus during work intervals\",\n                \"Take breaks between cycles\",\n                \"Track your productivity over time\"\n              ].map((step, index) => (\n                <motion.li\n                  key={index}\n                  initial={{ opacity: 0, x: -10 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  transition={{ delay: 0.3 + index * 0.1 }}\n                  className=\"flex items-start gap-3\"\n                >\n                  <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center text-xs font-semibold text-primary mt-0.5\">\n                    {index + 1}\n                  </div>\n                  <span className=\"leading-relaxed\">{step}</span>\n                </motion.li>\n              ))}\n            </ol>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":19299},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\nexport enum ObjectAccessGroupType {}\n\nexport interface ObjectAccessGroup {\n  type: ObjectAccessGroupType;\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n  return granted === ObjectPermission.WRITE;\n}\n\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  if (!userId) {\n    return false;\n  }\n\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","size_bytes":2707},"client/src/pages/chat.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Send, Bot, User, FileText, Sparkles, Loader2 } from \"lucide-react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { ChatMessage, StudyMaterial } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport default function Chat() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [message, setMessage] = useState(\"\");\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: materials } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: messages, isLoading: messagesLoading } = useQuery<ChatMessage[]>({\n    queryKey: [\"/api/chat/messages\", selectedMaterial],\n    queryFn: async () => {\n      const url = selectedMaterial \n        ? `/api/chat/messages?materialId=${selectedMaterial}`\n        : \"/api/chat/messages\";\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch messages\");\n      return response.json();\n    },\n    enabled: isAuthenticated,\n  });\n\n  const sendMessageWithStreaming = async (content: string) => {\n    setIsStreaming(true);\n    setStreamingMessage(\"\");\n    \n    try {\n      const response = await fetch(\"/api/chat/message\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n          content,\n          materialId: selectedMaterial,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to send message\");\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      \n      if (!reader) {\n        throw new Error(\"No reader available\");\n      }\n\n      let buffer = \"\";\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        // Decode chunk with streaming mode to handle multi-byte characters\n        buffer += decoder.decode(value, { stream: true });\n        \n        // Process complete SSE events (terminated by \\n\\n)\n        const events = buffer.split(\"\\n\\n\");\n        // Keep the last incomplete event in the buffer\n        buffer = events.pop() || \"\";\n\n        for (const event of events) {\n          const lines = event.split(\"\\n\");\n          for (const line of lines) {\n            if (line.startsWith(\"data: \")) {\n              try {\n                const data = JSON.parse(line.slice(6));\n                \n                if (data.type === \"chunk\") {\n                  setStreamingMessage((prev) => prev + data.content);\n                  scrollToBottom();\n                } else if (data.type === \"complete\") {\n                  setIsStreaming(false);\n                  setStreamingMessage(\"\");\n                  queryClient.invalidateQueries({ queryKey: [\"/api/chat/messages\", selectedMaterial] });\n                  scrollToBottom();\n                } else if (data.type === \"error\") {\n                  throw new Error(data.message);\n                }\n              } catch (parseError) {\n                console.error(\"Failed to parse SSE data:\", line, parseError);\n              }\n            }\n          }\n        }\n      }\n      \n      // Process any remaining buffer content\n      if (buffer.trim()) {\n        const lines = buffer.split(\"\\n\");\n        for (const line of lines) {\n          if (line.startsWith(\"data: \")) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              if (data.type === \"complete\") {\n                setIsStreaming(false);\n                setStreamingMessage(\"\");\n                queryClient.invalidateQueries({ queryKey: [\"/api/chat/messages\", selectedMaterial] });\n              }\n            } catch (parseError) {\n              console.error(\"Failed to parse final SSE data:\", line, parseError);\n            }\n          }\n        }\n      }\n    } catch (error: any) {\n      setIsStreaming(false);\n      setStreamingMessage(\"\");\n      \n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      \n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send message\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const handleSend = () => {\n    if (!message.trim()) {\n      toast({\n        title: \"Empty Message\",\n        description: \"Please type a message\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    const msg = message;\n    setMessage(\"\");\n    sendMessageWithStreaming(msg);\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"h-full flex flex-col bg-background\">\n      <motion.div \n        className=\"p-4 md:p-6 border-b bg-card/50 backdrop-blur-sm\"\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3 }}\n      >\n        <div className=\"max-w-5xl mx-auto\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-2 rounded-lg bg-gradient-to-br from-primary/20 to-primary/10\">\n              <Sparkles className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h1 className=\"font-heading font-bold text-xl md:text-3xl\" data-testid=\"text-chat-title\">\n                AI Study Assistant\n              </h1>\n              <p className=\"text-muted-foreground text-sm md:text-base hidden sm:block\" data-testid=\"text-chat-subtitle\">\n                Ask questions about your study materials or get general study help\n              </p>\n            </div>\n          </div>\n\n          <div className=\"max-w-xs\">\n            <Select value={selectedMaterial || \"general\"} onValueChange={(val) => setSelectedMaterial(val === \"general\" ? null : val)}>\n              <SelectTrigger data-testid=\"select-material\" className=\"border-2\">\n                <SelectValue placeholder=\"Select study material\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"general\" data-testid=\"option-general\">General Questions</SelectItem>\n                {materials?.map((material) => (\n                  <SelectItem key={material.id} value={material.id} data-testid={`option-material-${material.id}`}>\n                    <div className=\"flex items-center gap-2\">\n                      <FileText className=\"h-4 w-4 text-primary\" />\n                      <span className=\"truncate\">{material.title}</span>\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </motion.div>\n\n      <div className=\"flex-1 overflow-y-auto px-4 py-6 md:px-6\" data-testid=\"chat-messages-container\">\n        <div className=\"max-w-5xl mx-auto space-y-4\">\n          {messagesLoading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"inline-block h-10 w-10 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n              <p className=\"mt-4 text-muted-foreground font-medium\">Loading messages...</p>\n            </div>\n          ) : messages && messages.length > 0 ? (\n            <AnimatePresence initial={false}>\n              {messages.map((msg, index) => (\n                <motion.div\n                  key={msg.id}\n                  initial={{ opacity: 0, y: 20, scale: 0.95 }}\n                  animate={{ opacity: 1, y: 0, scale: 1 }}\n                  transition={{ duration: 0.3, delay: index * 0.05 }}\n                  className={`flex gap-2 md:gap-3 ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n                  data-testid={`message-${msg.id}`}\n                >\n                  {msg.role === \"assistant\" && (\n                    <Avatar className=\"flex-shrink-0 w-8 h-8 md:w-9 md:h-9 ring-2 ring-primary/10\">\n                      <AvatarImage src=\"/ai-avatar.png\" alt=\"AI Assistant\" />\n                      <AvatarFallback className=\"bg-gradient-to-br from-primary/20 to-primary/10\">\n                        <Bot className=\"h-4 w-4 md:h-5 md:w-5 text-primary\" />\n                      </AvatarFallback>\n                    </Avatar>\n                  )}\n                  <div\n                    className={`rounded-2xl px-4 py-3 max-w-[85%] md:max-w-2xl shadow-sm ${\n                      msg.role === \"user\"\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"bg-card border-2\"\n                    }`}\n                  >\n                    <p className=\"whitespace-pre-wrap break-words text-sm md:text-base leading-relaxed\">{msg.content}</p>\n                    <p className={`text-xs mt-2 ${msg.role === \"user\" ? \"opacity-70\" : \"text-muted-foreground\"}`}>\n                      {new Date(msg.createdAt).toLocaleTimeString()}\n                    </p>\n                  </div>\n                  {msg.role === \"user\" && (\n                    <Avatar className=\"flex-shrink-0 w-8 h-8 md:w-9 md:h-9 shadow-sm\">\n                      <AvatarImage src={user?.profileImageUrl || \"/user-avatar.png\"} alt=\"User\" />\n                      <AvatarFallback className=\"bg-primary\">\n                        <User className=\"h-4 w-4 md:h-5 md:w-5 text-primary-foreground\" />\n                      </AvatarFallback>\n                    </Avatar>\n                  )}\n                </motion.div>\n              ))}\n              {isStreaming && streamingMessage && (\n                <motion.div\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"flex gap-2 md:gap-3 justify-start\"\n                >\n                  <Avatar className=\"flex-shrink-0 w-8 h-8 md:w-9 md:h-9 ring-2 ring-primary/10\">\n                    <AvatarImage src=\"/ai-avatar.png\" alt=\"AI Assistant\" />\n                    <AvatarFallback className=\"bg-gradient-to-br from-primary/20 to-primary/10\">\n                      <Loader2 className=\"h-4 w-4 md:h-5 md:w-5 text-primary animate-spin\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"rounded-2xl px-4 py-3 max-w-[85%] md:max-w-2xl bg-card border-2 shadow-sm\">\n                    <p className=\"whitespace-pre-wrap break-words text-sm md:text-base leading-relaxed\">{streamingMessage}</p>\n                    <div className=\"flex items-center gap-1 mt-2\">\n                      <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse\"></div>\n                      <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse delay-75\"></div>\n                      <div className=\"h-2 w-2 bg-primary rounded-full animate-pulse delay-150\"></div>\n                    </div>\n                  </div>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          ) : (\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.5 }}\n            >\n              <Card className=\"p-8 md:p-12 text-center border-2 border-dashed\" data-testid=\"card-empty-state\">\n                <div className=\"p-4 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 inline-block mb-4\">\n                  <Bot className=\"h-12 w-12 md:h-16 md:w-16 text-primary\" />\n                </div>\n                <h3 className=\"font-heading font-semibold text-lg md:text-xl mb-2\">Start a Conversation</h3>\n                <p className=\"text-muted-foreground text-sm md:text-base mb-4 max-w-md mx-auto\">\n                  {selectedMaterial\n                    ? \"Ask questions about your selected study material and get instant AI-powered assistance\"\n                    : \"Ask me anything about your studies and I'll help you learn better\"}\n                </p>\n                <div className=\"inline-flex items-center gap-2 text-sm text-muted-foreground\">\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-primary animate-pulse\"></div>\n                  <span>Powered by AI</span>\n                </div>\n              </Card>\n            </motion.div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n      </div>\n\n      <motion.div \n        className=\"p-4 md:p-6 border-t bg-card/50 backdrop-blur-sm\"\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.3, delay: 0.1 }}\n      >\n        <div className=\"max-w-5xl mx-auto\">\n          <div className=\"flex gap-2 md:gap-3\">\n            <Textarea\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              onKeyDown={handleKeyPress}\n              placeholder={selectedMaterial ? \"Ask a question about this material...\" : \"Ask me anything...\"}\n              className=\"resize-none border-2 text-sm md:text-base\"\n              rows={2}\n              disabled={isStreaming}\n              data-testid=\"input-message\"\n            />\n            <Button\n              onClick={handleSend}\n              disabled={!message.trim() || isStreaming}\n              size=\"icon\"\n              className=\"h-full min-w-[48px]\"\n              data-testid=\"button-send\"\n            >\n              {isStreaming ? (\n                <Loader2 className=\"h-5 w-5 animate-spin\" />\n              ) : (\n                <Send className=\"h-5 w-5\" />\n              )}\n            </Button>\n          </div>\n          <p className=\"text-xs text-muted-foreground mt-2 ml-1\">\n            Press Enter to send, Shift+Enter for new line\n          </p>\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":15729},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./ThemeProvider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      aria-label=\"Toggle theme\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n    </Button>\n  );\n}\n","size_bytes":527},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  toggleTheme: () => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined);\n\nexport function ThemeProvider({ children, defaultTheme = \"light\" }: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(defaultTheme);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme | null;\n      if (stored) {\n        setTheme(stored);\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    \n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(\"theme\", theme);\n    }\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeProviderContext.Provider value={{ theme, setTheme, toggleTheme }}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeProviderContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1428},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\nexport class ObjectStorageService {\n  constructor() {}\n\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n    return null;\n  }\n\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      const [metadata] = await file.getMetadata();\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      \n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${isPublic ? \"public\" : \"private\"}, max-age=${cacheTtlSec}`,\n      });\n\n      const stream = file.createReadStream();\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n\n  async uploadFile(\n    filePath: string,\n    fileBuffer: Buffer,\n    contentType: string = \"application/octet-stream\"\n  ): Promise<void> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    const fullPath = `${privateObjectDir}/${filePath}`;\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    const bucket = objectStorageClient.bucket(bucketName);\n    const file = bucket.file(objectName);\n\n    await file.save(fileBuffer, {\n      contentType,\n      metadata: {\n        contentType,\n      },\n    });\n  }\n}\n\nexport const objectStorage = new ObjectStorageService();\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n","size_bytes":7996},"client/src/pages/concentration.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Play, Pause, Square, Focus, AlertTriangle, Clock, Coffee } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\n\ntype StudySession = {\n  id: string;\n  userId: string;\n  startTime: string;\n  endTime: string | null;\n  duration: number;\n  tabSwitches: number;\n  timeWasted: number;\n  isConcentrationMode: boolean;\n  pauseCount: number;\n  pauseDuration: number;\n  pauseReasons: Array<{ reason: string; duration: number; timestamp: string }>;\n};\n\nconst PAUSE_REASONS = [\n  \"Bathroom break\",\n  \"Quick snack/water\",\n  \"Emergency call\",\n  \"Stretching/rest\",\n  \"Technical issue\",\n];\n\nexport default function Concentration() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  \n  const [isActive, setIsActive] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n  const [elapsedTime, setElapsedTime] = useState(0);\n  const [tabSwitches, setTabSwitches] = useState(0);\n  const [timeWasted, setTimeWasted] = useState(0);\n  const [pauseDuration, setPauseDuration] = useState(0);\n  const [pauseCount, setPauseCount] = useState(0);\n  const [pauseReasons, setPauseReasons] = useState<Array<{ reason: string; duration: number; timestamp: string }>>([]);\n  const [currentSessionId, setCurrentSessionId] = useState<string | null>(null);\n  \n  const [showPauseDialog, setShowPauseDialog] = useState(false);\n  const [selectedPauseReason, setSelectedPauseReason] = useState(\"\");\n  const [customPauseReason, setCustomPauseReason] = useState(\"\");\n  const [pauseStartTime, setPauseStartTime] = useState<number | null>(null);\n  \n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const beepIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const autoSaveIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const tabLeftTimeRef = useRef<number | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const elapsedTimeRef = useRef(0);\n  const tabSwitchesRef = useRef(0);\n  const timeWastedRef = useRef(0);\n  const isPausedRef = useRef(false);\n  const visibilityHandlerRef = useRef<(() => void) | null>(null);\n\n  const { data: sessions } = useQuery<StudySession[]>({\n    queryKey: [\"/api/study-sessions\"],\n    enabled: isAuthenticated,\n  });\n\n  const startSessionMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/study-sessions\", {\n        duration: 0,\n        tabSwitches: 0,\n        timeWasted: 0,\n        isConcentrationMode: true,\n        pauseCount: 0,\n        pauseDuration: 0,\n        pauseReasons: [],\n      });\n    },\n    onSuccess: (data: any) => {\n      setCurrentSessionId(data.id);\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-sessions\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setIsActive(false);\n    },\n  });\n\n  const updateSessionMutation = useMutation({\n    mutationFn: async (data: { \n      sessionId: string; \n      duration: number; \n      tabSwitches: number; \n      timeWasted: number;\n      pauseCount: number;\n      pauseDuration: number;\n      pauseReasons: Array<{ reason: string; duration: number; timestamp: string }>;\n    }) => {\n      return await apiRequest(\"PATCH\", `/api/study-sessions/${data.sessionId}`, {\n        duration: data.duration,\n        tabSwitches: data.tabSwitches,\n        timeWasted: data.timeWasted,\n        pauseCount: data.pauseCount,\n        pauseDuration: data.pauseDuration,\n        pauseReasons: data.pauseReasons,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-sessions\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const endSessionMutation = useMutation({\n    mutationFn: async (sessionId: string) => {\n      return await apiRequest(\"PATCH\", `/api/study-sessions/${sessionId}`, {\n        duration: Math.floor(elapsedTime / 60),\n        tabSwitches,\n        timeWasted: Math.floor(timeWasted / 60),\n        pauseCount,\n        pauseDuration, // Send in seconds as per schema\n        pauseReasons,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/study-sessions\"] });\n      const focusedTime = Math.floor((elapsedTime - timeWasted) / 60);\n      toast({\n        title: \"Session Complete!\",\n        description: `Focused for ${focusedTime} minutes with ${tabSwitches} interruptions and ${pauseCount} breaks.`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const playBeep = () => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    \n    const context = audioContextRef.current;\n    const oscillator = context.createOscillator();\n    const gainNode = context.createGain();\n    \n    oscillator.connect(gainNode);\n    gainNode.connect(context.destination);\n    \n    oscillator.frequency.value = 800;\n    oscillator.type = \"sine\";\n    \n    gainNode.gain.setValueAtTime(0.3, context.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);\n    \n    oscillator.start(context.currentTime);\n    oscillator.stop(context.currentTime + 0.5);\n  };\n\n  useEffect(() => {\n    elapsedTimeRef.current = elapsedTime;\n    tabSwitchesRef.current = tabSwitches;\n    timeWastedRef.current = timeWasted;\n  }, [elapsedTime, tabSwitches, timeWasted]);\n\n  useEffect(() => {\n    isPausedRef.current = isPaused;\n  }, [isPaused]);\n\n  useEffect(() => {\n    return () => {\n      if (timerRef.current) clearInterval(timerRef.current);\n      if (beepIntervalRef.current) clearInterval(beepIntervalRef.current);\n      if (autoSaveIntervalRef.current) clearInterval(autoSaveIntervalRef.current);\n      if (visibilityHandlerRef.current) {\n        document.removeEventListener(\"visibilitychange\", visibilityHandlerRef.current);\n      }\n    };\n  }, []);\n\n  const startTimers = (sessionId: string) => {\n    timerRef.current = setInterval(() => {\n      setElapsedTime((prev) => prev + 1);\n    }, 1000);\n\n    beepIntervalRef.current = setInterval(() => {\n      playBeep();\n      toast({\n        title: \"5 Minutes Passed\",\n        description: \"Keep focusing!\",\n      });\n    }, 5 * 60 * 1000);\n\n    autoSaveIntervalRef.current = setInterval(() => {\n      updateSessionMutation.mutate({\n        sessionId,\n        duration: Math.floor(elapsedTimeRef.current / 60),\n        tabSwitches: tabSwitchesRef.current,\n        timeWasted: Math.floor(timeWastedRef.current / 60),\n        pauseCount,\n        pauseDuration, // Send in seconds as per schema\n        pauseReasons,\n      });\n    }, 30 * 1000);\n\n    // Only track tab switches when timer is RUNNING (not paused)\n    const handleVisibilityChange = () => {\n      // Only track if session is active AND not paused (using ref to get current value)\n      if (!isPausedRef.current) {\n        if (document.hidden) {\n          tabLeftTimeRef.current = Date.now();\n        } else {\n          if (tabLeftTimeRef.current) {\n            const wastedSeconds = Math.floor((Date.now() - tabLeftTimeRef.current) / 1000);\n            setTimeWasted((prev) => prev + wastedSeconds);\n            setTabSwitches((prev) => prev + 1);\n            \n            toast({\n              title: \"Tab Switch Detected\",\n              description: `Lost focus for ${wastedSeconds} seconds. Stay concentrated!`,\n              variant: \"destructive\",\n            });\n            \n            tabLeftTimeRef.current = null;\n          }\n        }\n      }\n    };\n\n    visibilityHandlerRef.current = handleVisibilityChange;\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n  };\n\n  const stopTimers = () => {\n    if (timerRef.current) clearInterval(timerRef.current);\n    if (beepIntervalRef.current) clearInterval(beepIntervalRef.current);\n    if (autoSaveIntervalRef.current) clearInterval(autoSaveIntervalRef.current);\n    if (visibilityHandlerRef.current) {\n      document.removeEventListener(\"visibilitychange\", visibilityHandlerRef.current);\n      visibilityHandlerRef.current = null;\n    }\n  };\n\n  const pauseTimers = () => {\n    if (timerRef.current) clearInterval(timerRef.current);\n    if (beepIntervalRef.current) clearInterval(beepIntervalRef.current);\n    if (autoSaveIntervalRef.current) clearInterval(autoSaveIntervalRef.current);\n  };\n\n  const resumeTimers = (sessionId: string) => {\n    timerRef.current = setInterval(() => {\n      setElapsedTime((prev) => prev + 1);\n    }, 1000);\n\n    beepIntervalRef.current = setInterval(() => {\n      playBeep();\n      toast({\n        title: \"5 Minutes Passed\",\n        description: \"Keep focusing!\",\n      });\n    }, 5 * 60 * 1000);\n\n    autoSaveIntervalRef.current = setInterval(() => {\n      updateSessionMutation.mutate({\n        sessionId,\n        duration: Math.floor(elapsedTimeRef.current / 60),\n        tabSwitches: tabSwitchesRef.current,\n        timeWasted: Math.floor(timeWastedRef.current / 60),\n        pauseCount,\n        pauseDuration, // Send in seconds as per schema\n        pauseReasons,\n      });\n    }, 30 * 1000);\n  };\n\n  const handleStart = async () => {\n    setElapsedTime(0);\n    setTabSwitches(0);\n    setTimeWasted(0);\n    setPauseDuration(0);\n    setPauseCount(0);\n    setPauseReasons([]);\n    \n    try {\n      const data: any = await startSessionMutation.mutateAsync();\n      setCurrentSessionId(data.id);\n      setIsActive(true);\n      setIsPaused(false);\n      \n      startTimers(data.id);\n      \n      toast({\n        title: \"Concentration Mode Started\",\n        description: \"Stay focused! Beeps will sound every 5 minutes.\",\n      });\n    } catch (error) {\n      console.error(\"Failed to start session:\", error);\n    }\n  };\n\n  const handlePause = () => {\n    setShowPauseDialog(true);\n    setPauseStartTime(Date.now());\n    setIsPaused(true);\n    pauseTimers();\n  };\n\n  const handleResume = () => {\n    if (pauseStartTime && currentSessionId) {\n      const breakSeconds = Math.floor((Date.now() - pauseStartTime) / 1000);\n      const reason = selectedPauseReason === \"Other\" ? customPauseReason : selectedPauseReason;\n      \n      const newPauseEntry = {\n        reason: reason || \"No reason specified\",\n        duration: breakSeconds,\n        timestamp: new Date().toISOString(),\n      };\n      \n      setPauseDuration((prev) => prev + breakSeconds);\n      setPauseCount((prev) => prev + 1);\n      setPauseReasons((prev) => [...prev, newPauseEntry]);\n      \n      setIsPaused(false);\n      setShowPauseDialog(false);\n      setSelectedPauseReason(\"\");\n      setCustomPauseReason(\"\");\n      setPauseStartTime(null);\n      \n      resumeTimers(currentSessionId);\n      \n      toast({\n        title: \"Break Ended\",\n        description: `Break duration: ${Math.floor(breakSeconds / 60)}m ${breakSeconds % 60}s`,\n      });\n    }\n  };\n\n  const handleStop = () => {\n    stopTimers();\n    setIsActive(false);\n    setIsPaused(false);\n    \n    if (currentSessionId) {\n      endSessionMutation.mutate(currentSessionId);\n    }\n    \n    setCurrentSessionId(null);\n    setElapsedTime(0);\n    setTabSwitches(0);\n    setTimeWasted(0);\n    setPauseDuration(0);\n    setPauseCount(0);\n    setPauseReasons([]);\n  };\n\n  const formatTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const mins = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}:${String(mins).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`;\n    }\n    return `${String(mins).padStart(2, \"0\")}:${String(secs).padStart(2, \"0\")}`;\n  };\n\n  const totalFocusTime = sessions\n    ?.filter((s) => s.isConcentrationMode)\n    .reduce((total, session) => total + session.duration, 0) || 0;\n\n  const totalTabSwitches = sessions\n    ?.filter((s) => s.isConcentrationMode)\n    .reduce((total, session) => total + session.tabSwitches, 0) || 0;\n\n  const totalPauses = sessions\n    ?.filter((s) => s.isConcentrationMode)\n    .reduce((total, session) => total + (session.pauseCount || 0), 0) || 0;\n\n  const focusedTime = elapsedTime - timeWasted - pauseDuration;\n  const focusPercentage = elapsedTime > 0 ? Math.floor((focusedTime / elapsedTime) * 100) : 100;\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-4xl font-heading font-bold mb-2\" data-testid=\"text-page-title\">\n          Concentration Mode\n        </h1>\n        <p className=\"text-muted-foreground\" data-testid=\"text-page-description\">\n          Track your focus with tab-switch detection and regular beep reminders every 5 minutes.\n        </p>\n      </div>\n\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        <div className=\"md:col-span-2\">\n          <Card className=\"p-8\">\n            <div className=\"text-center mb-8\">\n              {isPaused ? (\n                <Badge variant=\"secondary\" className=\"mb-4\">\n                  <Coffee className=\"h-4 w-4 mr-2\" />\n                  On Break\n                </Badge>\n              ) : isActive ? (\n                <Badge variant=\"default\" className=\"mb-4\">\n                  <Focus className=\"h-4 w-4 mr-2\" />\n                  Concentrating\n                </Badge>\n              ) : (\n                <Badge variant=\"secondary\" className=\"mb-4\">\n                  <Clock className=\"h-4 w-4 mr-2\" />\n                  Not Started\n                </Badge>\n              )}\n              \n              <div className=\"text-8xl font-bold font-mono mb-2\" data-testid=\"text-timer-display\">\n                {formatTime(elapsedTime)}\n              </div>\n              \n              <div className=\"text-sm text-muted-foreground mb-8\">\n                Focus Score: {focusPercentage}%\n              </div>\n\n              <div className=\"flex justify-center gap-4\">\n                {!isActive ? (\n                  <Button\n                    size=\"lg\"\n                    onClick={handleStart}\n                    data-testid=\"button-start-session\"\n                  >\n                    <Play className=\"h-5 w-5 mr-2\" />\n                    Start Concentrating\n                  </Button>\n                ) : (\n                  <>\n                    {!isPaused ? (\n                      <Button\n                        size=\"lg\"\n                        onClick={handlePause}\n                        variant=\"secondary\"\n                        data-testid=\"button-pause-session\"\n                      >\n                        <Pause className=\"h-5 w-5 mr-2\" />\n                        Pause\n                      </Button>\n                    ) : (\n                      <Button\n                        size=\"lg\"\n                        onClick={handleResume}\n                        data-testid=\"button-resume-session\"\n                      >\n                        <Play className=\"h-5 w-5 mr-2\" />\n                        Resume\n                      </Button>\n                    )}\n                    <Button\n                      size=\"lg\"\n                      onClick={handleStop}\n                      variant=\"destructive\"\n                      data-testid=\"button-stop-session\"\n                    >\n                      <Square className=\"h-5 w-5 mr-2\" />\n                      Stop\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 border-t pt-6\">\n              <div className=\"text-center p-4 bg-muted rounded-md\">\n                <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-tab-switches\">\n                  {tabSwitches}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Tab Switches</div>\n              </div>\n              <div className=\"text-center p-4 bg-muted rounded-md\">\n                <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-time-wasted\">\n                  {Math.floor(timeWasted / 60)}m {timeWasted % 60}s\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Time Wasted</div>\n              </div>\n              <div className=\"text-center p-4 bg-muted rounded-md\">\n                <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-pause-count\">\n                  {pauseCount}\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Breaks Taken</div>\n              </div>\n              <div className=\"text-center p-4 bg-muted rounded-md\">\n                <div className=\"text-2xl font-bold mb-1\" data-testid=\"text-pause-duration\">\n                  {Math.floor(pauseDuration / 60)}m {pauseDuration % 60}s\n                </div>\n                <div className=\"text-sm text-muted-foreground\">Break Time</div>\n              </div>\n            </div>\n\n            {pauseReasons.length > 0 && (\n              <div className=\"mt-6 border-t pt-6\">\n                <h3 className=\"font-semibold mb-3\">Break History</h3>\n                <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                  {pauseReasons.map((pause, index) => (\n                    <div key={index} className=\"flex justify-between items-center text-sm p-2 bg-muted rounded\">\n                      <span className=\"text-muted-foreground\">{pause.reason}</span>\n                      <span className=\"font-medium\">\n                        {Math.floor(pause.duration / 60)}m {pause.duration % 60}s\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card className=\"p-6\">\n            <h3 className=\"font-semibold mb-4\">Your Stats</h3>\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"text-sm text-muted-foreground mb-1\">Total Focus Time</div>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-focus-time\">\n                  {Math.floor(totalFocusTime / 60)}h {totalFocusTime % 60}m\n                </div>\n              </div>\n              <div>\n                <div className=\"text-sm text-muted-foreground mb-1\">Total Sessions</div>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-sessions\">\n                  {sessions?.filter((s) => s.isConcentrationMode).length || 0}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-sm text-muted-foreground mb-1\">Total Interruptions</div>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-tab-switches\">\n                  {totalTabSwitches}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-sm text-muted-foreground mb-1\">Total Breaks</div>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-total-pauses\">\n                  {totalPauses}\n                </div>\n              </div>\n            </div>\n          </Card>\n\n          <Card className=\"p-6 bg-warning/10 border-warning\">\n            <div className=\"flex gap-2 mb-3\">\n              <AlertTriangle className=\"h-5 w-5 text-warning\" />\n              <h3 className=\"font-semibold\">How It Works</h3>\n            </div>\n            <ul className=\"text-sm text-muted-foreground space-y-2 list-disc list-inside\">\n              <li>Beep alert every 5 minutes</li>\n              <li>Tab switches tracked when running</li>\n              <li>Pause anytime for breaks</li>\n              <li>Track all break reasons</li>\n              <li>Build streaks with 30+ min focus</li>\n            </ul>\n          </Card>\n        </div>\n      </div>\n\n      <Dialog open={showPauseDialog} onOpenChange={setShowPauseDialog}>\n        <DialogContent data-testid=\"dialog-pause-reason\">\n          <DialogHeader>\n            <DialogTitle>Break Time</DialogTitle>\n            <DialogDescription>\n              Why are you taking a break? This helps track your study patterns.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <RadioGroup value={selectedPauseReason} onValueChange={setSelectedPauseReason}>\n              {PAUSE_REASONS.map((reason) => (\n                <div key={reason} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value={reason} id={reason} data-testid={`radio-${reason.toLowerCase().replace(/\\s+/g, '-')}`} />\n                  <Label htmlFor={reason} className=\"cursor-pointer\">{reason}</Label>\n                </div>\n              ))}\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"Other\" id=\"Other\" data-testid=\"radio-other\" />\n                <Label htmlFor=\"Other\" className=\"cursor-pointer\">Other (specify below)</Label>\n              </div>\n            </RadioGroup>\n\n            {selectedPauseReason === \"Other\" && (\n              <Input\n                placeholder=\"Enter custom reason...\"\n                value={customPauseReason}\n                onChange={(e) => setCustomPauseReason(e.target.value)}\n                data-testid=\"input-custom-reason\"\n              />\n            )}\n          </div>\n\n          <div className=\"flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowPauseDialog(false);\n                setIsPaused(false);\n                if (currentSessionId) {\n                  resumeTimers(currentSessionId);\n                }\n              }}\n              data-testid=\"button-cancel-pause\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleResume}\n              disabled={!selectedPauseReason || (selectedPauseReason === \"Other\" && !customPauseReason)}\n              data-testid=\"button-confirm-pause\"\n            >\n              End Break\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":22834},"client/src/pages/leaderboard.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Trophy, Clock, Target, Medal } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\n\ntype LeaderboardUser = {\n  userId: string;\n  email: string;\n  firstName: string | null;\n  lastName: string | null;\n  profileImageUrl: string | null;\n  totalTime?: number;\n  averageScore?: number;\n  quizCount?: number;\n  rank?: number;\n};\n\nexport default function Leaderboard() {\n  const { user, isAuthenticated } = useAuth();\n\n  const { data: studyTimeLeaderboard, isLoading: studyTimeLoading } = useQuery<LeaderboardUser[]>({\n    queryKey: [\"/api/leaderboard/study-time\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: quizScoreLeaderboard, isLoading: quizScoreLoading } = useQuery<LeaderboardUser[]>({\n    queryKey: [\"/api/leaderboard/quiz-score\"],\n    enabled: isAuthenticated,\n  });\n\n  const getRankColor = (rank: number) => {\n    if (rank === 1) return \"text-warning\";\n    if (rank === 2) return \"text-muted-foreground\";\n    if (rank === 3) return \"text-warning/60\";\n    return \"text-foreground\";\n  };\n\n  const getRankIcon = (rank: number) => {\n    if (rank === 1) return <Trophy className=\"h-6 w-6 text-warning\" />;\n    if (rank === 2) return <Medal className=\"h-6 w-6 text-muted-foreground\" />;\n    if (rank === 3) return <Medal className=\"h-6 w-6 text-warning/60\" />;\n    return <span className=\"text-xl font-bold text-muted-foreground\">#{rank}</span>;\n  };\n\n  const getUserInitials = (user: LeaderboardUser) => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName[0]}${user.lastName[0]}`;\n    }\n    return user.email[0].toUpperCase();\n  };\n\n  const getUserName = (user: LeaderboardUser) => {\n    if (user.firstName && user.lastName) {\n      return `${user.firstName} ${user.lastName}`;\n    }\n    return user.email;\n  };\n\n  const isCurrentUser = (leaderboardUser: LeaderboardUser) => {\n    return leaderboardUser.userId === user?.id;\n  };\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-5xl\">\n      <div className=\"mb-8 flex items-center gap-3\">\n        <Trophy className=\"h-8 w-8 text-primary\" />\n        <div className=\"flex-1\">\n          <h1 className=\"text-4xl font-heading font-bold mb-2\" data-testid=\"text-page-title\">\n            Leaderboards\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-page-description\">\n            Compete with fellow students and track your progress on the global rankings.\n          </p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"study-time\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n          <TabsTrigger value=\"study-time\" data-testid=\"tab-study-time\">\n            <Clock className=\"h-4 w-4 mr-2\" />\n            Study Time\n          </TabsTrigger>\n          <TabsTrigger value=\"quiz-scores\" data-testid=\"tab-quiz-scores\">\n            <Target className=\"h-4 w-4 mr-2\" />\n            Quiz Scores\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"study-time\">\n          <Card className=\"p-6\">\n            <div className=\"space-y-4\">\n              {studyTimeLoading ? (\n                <div className=\"text-center py-8 text-muted-foreground\">Loading rankings...</div>\n              ) : studyTimeLeaderboard && studyTimeLeaderboard.length > 0 ? (\n                studyTimeLeaderboard.map((leaderUser, index) => (\n                  <div\n                    key={leaderUser.userId}\n                    className={`flex items-center gap-4 p-4 rounded-md hover-elevate ${\n                      isCurrentUser(leaderUser) ? \"bg-primary/10 border-2 border-primary\" : \"\"\n                    }`}\n                    data-testid={`leaderboard-item-${index}`}\n                  >\n                    <div className=\"w-12 text-center\">\n                      {getRankIcon(index + 1)}\n                    </div>\n\n                    <Avatar className=\"h-12 w-12\">\n                      <AvatarImage src={leaderUser.profileImageUrl || undefined} />\n                      <AvatarFallback>{getUserInitials(leaderUser)}</AvatarFallback>\n                    </Avatar>\n\n                    <div className=\"flex-1\">\n                      <div className=\"font-semibold flex items-center gap-2\">\n                        {getUserName(leaderUser)}\n                        {isCurrentUser(leaderUser) && (\n                          <Badge variant=\"default\" className=\"text-xs\">You</Badge>\n                        )}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {leaderUser.email}\n                      </div>\n                    </div>\n\n                    <div className=\"text-right\">\n                      <div className=\"text-2xl font-bold\" data-testid={`study-time-${index}`}>\n                        {Math.floor((leaderUser.totalTime || 0) / 60)}h{\" \"}\n                        {(leaderUser.totalTime || 0) % 60}m\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">Total Study Time</div>\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <div className=\"text-center py-12\">\n                  <Trophy className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\" data-testid=\"text-empty-state\">\n                    No study time recorded yet. Start studying to climb the leaderboard!\n                  </p>\n                </div>\n              )}\n            </div>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"quiz-scores\">\n          <Card className=\"p-6\">\n            <div className=\"space-y-4\">\n              {quizScoreLoading ? (\n                <div className=\"text-center py-8 text-muted-foreground\">Loading rankings...</div>\n              ) : quizScoreLeaderboard && quizScoreLeaderboard.length > 0 ? (\n                quizScoreLeaderboard.map((leaderUser, index) => (\n                  <div\n                    key={leaderUser.userId}\n                    className={`flex items-center gap-4 p-4 rounded-md hover-elevate ${\n                      isCurrentUser(leaderUser) ? \"bg-primary/10 border-2 border-primary\" : \"\"\n                    }`}\n                    data-testid={`leaderboard-item-${index}`}\n                  >\n                    <div className=\"w-12 text-center\">\n                      {getRankIcon(index + 1)}\n                    </div>\n\n                    <Avatar className=\"h-12 w-12\">\n                      <AvatarImage src={leaderUser.profileImageUrl || undefined} />\n                      <AvatarFallback>{getUserInitials(leaderUser)}</AvatarFallback>\n                    </Avatar>\n\n                    <div className=\"flex-1\">\n                      <div className=\"font-semibold flex items-center gap-2\">\n                        {getUserName(leaderUser)}\n                        {isCurrentUser(leaderUser) && (\n                          <Badge variant=\"default\" className=\"text-xs\">You</Badge>\n                        )}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {leaderUser.email}\n                      </div>\n                    </div>\n\n                    <div className=\"text-right\">\n                      <div className=\"text-2xl font-bold\" data-testid={`quiz-score-${index}`}>\n                        {Math.round(leaderUser.averageScore || 0)}%\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {leaderUser.quizCount || 0} {leaderUser.quizCount === 1 ? 'quiz' : 'quizzes'}\n                      </div>\n                    </div>\n                  </div>\n                ))\n              ) : (\n                <div className=\"text-center py-12\">\n                  <Target className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\" data-testid=\"text-empty-state\">\n                    No quiz scores yet. Take quizzes to appear on the leaderboard!\n                  </p>\n                </div>\n              )}\n            </div>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":8521},"client/src/pages/material-detail.tsx":{"content":"import { useParams, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { ArrowLeft, Download, FileText, Volume2, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect } from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface StudyMaterial {\n  id: string;\n  userId: string;\n  title: string;\n  fileName: string;\n  fileUrl: string;\n  fileSize: number;\n  uploadedAt: string;\n}\n\ninterface Summary {\n  id: string;\n  userId: string;\n  materialId: string;\n  content: string;\n  audioUrl: string | null;\n  createdAt: string;\n}\n\nexport default function MaterialDetail() {\n  const { id } = useParams();\n  const { isAuthenticated, isLoading: authLoading } = useAuth();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: material, isLoading } = useQuery<StudyMaterial>({\n    queryKey: [\"/api/study-materials\", id],\n    enabled: isAuthenticated && !!id,\n  });\n\n  const { data: summary, isLoading: summaryLoading } = useQuery<Summary>({\n    queryKey: [\"/api/summaries\", \"material\", id],\n    queryFn: async () => {\n      const response = await fetch(`/api/summaries?materialId=${id}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        if (response.status === 404) return null;\n        throw new Error(\"Failed to fetch summary\");\n      }\n      return response.json();\n    },\n    enabled: isAuthenticated && !!id,\n  });\n\n  const generateAudioMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/summaries/generate\", {\n        materialId: id,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/summaries\", \"material\", id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/summaries\"] });\n      toast({\n        title: \"Success\",\n        description: \"Audio summary generated successfully! You can now listen to it below.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate audio summary\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(2) + \" MB\";\n  };\n\n  const handleDownload = () => {\n    if (material?.fileUrl) {\n      window.open(material.fileUrl, \"_blank\");\n    }\n  };\n\n  if (authLoading || isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\" data-testid=\"text-loading\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!material) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <Card className=\"p-12 text-center\">\n          <FileText className=\"h-16 w-16 text-muted-foreground mx-auto mb-4\" />\n          <h2 className=\"font-heading font-semibold text-xl mb-2\" data-testid=\"text-not-found\">Material Not Found</h2>\n          <p className=\"text-muted-foreground mb-4\">\n            The study material you're looking for doesn't exist or has been deleted.\n          </p>\n          <Button asChild data-testid=\"button-back-to-materials\">\n            <Link href=\"/materials\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Materials\n            </Link>\n          </Button>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"mb-6\">\n        <Button variant=\"ghost\" asChild data-testid=\"button-back\">\n          <Link href=\"/materials\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Materials\n          </Link>\n        </Button>\n      </div>\n\n      <Card className=\"p-6 mb-6\" data-testid=\"card-material-info\">\n        <div className=\"flex items-start gap-4 mb-4\">\n          <FileText className=\"h-12 w-12 text-primary flex-shrink-0\" />\n          <div className=\"flex-1\">\n            <h1 className=\"font-heading font-bold text-2xl md:text-3xl mb-2\" data-testid=\"text-material-title\">\n              {material.title}\n            </h1>\n            <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\n              <span data-testid=\"text-filename\">{material.fileName}</span>\n              <span data-testid=\"text-filesize\">{formatFileSize(material.fileSize)}</span>\n              <span data-testid=\"text-uploaded-date\">\n                Uploaded {new Date(material.uploadedAt).toLocaleDateString()}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex gap-2\">\n          <Button onClick={handleDownload} data-testid=\"button-download\">\n            <Download className=\"h-4 w-4 mr-2\" />\n            Download PDF\n          </Button>\n        </div>\n      </Card>\n\n      {summary?.audioUrl && (\n        <Card className=\"p-6 mb-6\" data-testid=\"card-audio-summary\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <Volume2 className=\"h-6 w-6 text-primary\" />\n            <h2 className=\"font-heading font-semibold text-xl\">Audio Summary</h2>\n          </div>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Listen to an AI-generated audio explanation of this study material\n          </p>\n          <div className=\"bg-muted/50 p-4 rounded-lg\" data-testid=\"audio-player-container\">\n            <audio\n              controls\n              className=\"w-full\"\n              data-testid=\"audio-player\"\n              src={summary.audioUrl}\n            >\n              Your browser does not support the audio element.\n            </audio>\n          </div>\n        </Card>\n      )}\n\n      <Card className=\"p-6\" data-testid=\"card-pdf-viewer\">\n        <h2 className=\"font-heading font-semibold text-xl mb-4\">PDF Preview</h2>\n        <div className=\"w-full\" style={{ height: \"600px\" }}>\n          <iframe\n            src={material.fileUrl}\n            className=\"w-full h-full border-0 rounded-lg\"\n            title={material.title}\n            data-testid=\"iframe-pdf\"\n          />\n        </div>\n      </Card>\n\n      <div className=\"mt-6 grid md:grid-cols-2 gap-4\">\n        <Card className=\"p-6\">\n          <h3 className=\"font-heading font-semibold text-lg mb-3\">AI Tools</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Generate AI-powered study aids from this material\n          </p>\n          <div className=\"space-y-2\">\n            <Button \n              variant=\"outline\" \n              className=\"w-full justify-start\" \n              onClick={() => generateAudioMutation.mutate()}\n              disabled={generateAudioMutation.isPending || summaryLoading}\n              data-testid=\"button-generate-audio\"\n            >\n              {generateAudioMutation.isPending ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Generating Audio...\n                </>\n              ) : (\n                <>\n                  <Volume2 className=\"h-4 w-4 mr-2\" />\n                  Generate Audio Summarization\n                </>\n              )}\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start\" asChild data-testid=\"button-generate-flashcards\">\n              <Link href={`/flashcards?materialId=${material.id}`}>\n                Generate Flashcards\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start\" asChild data-testid=\"button-generate-quiz\">\n              <Link href={`/quizzes?materialId=${material.id}`}>\n                Generate Quiz\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start\" asChild data-testid=\"button-generate-summary\">\n              <Link href={`/summaries?materialId=${material.id}`}>\n                Generate Summary\n              </Link>\n            </Button>\n            <Button variant=\"outline\" className=\"w-full justify-start\" asChild data-testid=\"button-chat\">\n              <Link href={`/chat?materialId=${material.id}`}>\n                Chat with AI\n              </Link>\n            </Button>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"font-heading font-semibold text-lg mb-3\">Study Statistics</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Track your progress with this material\n          </p>\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-muted-foreground\">Flashcards Created</span>\n              <span className=\"font-semibold\" data-testid=\"text-stat-flashcards\">0</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-muted-foreground\">Quizzes Taken</span>\n              <span className=\"font-semibold\" data-testid=\"text-stat-quizzes\">0</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-muted-foreground\">Study Sessions</span>\n              <span className=\"font-semibold\" data-testid=\"text-stat-sessions\">0</span>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10067},"client/src/pages/audio-library.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Volume2, FileText, Calendar, Play, Pause, RotateCcw, VolumeX, Headphones } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { Link } from \"wouter\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Slider } from \"@/components/ui/slider\";\n\ninterface Summary {\n  id: string;\n  userId: string;\n  materialId: string;\n  content: string;\n  audioUrl: string | null;\n  createdAt: string;\n}\n\ninterface StudyMaterial {\n  id: string;\n  title: string;\n  fileName: string;\n}\n\n// Compact Custom Audio Player for Library Cards\nfunction CompactAudioPlayer({ audioUrl, audioId }: { audioUrl: string; audioId: string }) {\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [isMuted, setIsMuted] = useState(false);\n\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const updateTime = () => setCurrentTime(audio.currentTime);\n    const updateDuration = () => setDuration(audio.duration);\n    const handleEnded = () => setIsPlaying(false);\n\n    audio.addEventListener(\"timeupdate\", updateTime);\n    audio.addEventListener(\"loadedmetadata\", updateDuration);\n    audio.addEventListener(\"ended\", handleEnded);\n\n    return () => {\n      audio.removeEventListener(\"timeupdate\", updateTime);\n      audio.removeEventListener(\"loadedmetadata\", updateDuration);\n      audio.removeEventListener(\"ended\", handleEnded);\n    };\n  }, []);\n\n  const togglePlay = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    if (isPlaying) {\n      audio.pause();\n    } else {\n      audio.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const toggleMute = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.muted = !isMuted;\n    setIsMuted(!isMuted);\n  };\n\n  const handleSeek = (value: number[]) => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.currentTime = value[0];\n    setCurrentTime(value[0]);\n  };\n\n  const handleRestart = () => {\n    const audio = audioRef.current;\n    if (!audio) return;\n    audio.currentTime = 0;\n    setCurrentTime(0);\n  };\n\n  const formatTime = (time: number) => {\n    if (isNaN(time)) return \"0:00\";\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes}:${seconds.toString().padStart(2, \"0\")}`;\n  };\n\n  return (\n    <div className=\"space-y-3\" data-testid={`audio-container-${audioId}`}>\n      <audio ref={audioRef} src={audioUrl} preload=\"metadata\" />\n      \n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-xs font-medium text-muted-foreground min-w-[38px]\">\n          {formatTime(currentTime)}\n        </span>\n        <Slider\n          value={[currentTime]}\n          max={duration || 100}\n          step={0.1}\n          onValueChange={handleSeek}\n          className=\"flex-1\"\n          data-testid={`audio-slider-${audioId}`}\n        />\n        <span className=\"text-xs font-medium text-muted-foreground min-w-[38px]\">\n          {formatTime(duration)}\n        </span>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-1.5\">\n        <Button\n          size=\"icon\"\n          variant=\"outline\"\n          onClick={handleRestart}\n          className=\"h-8 w-8\"\n          data-testid={`button-restart-${audioId}`}\n        >\n          <RotateCcw className=\"h-3.5 w-3.5\" />\n        </Button>\n        <Button\n          size=\"icon\"\n          onClick={togglePlay}\n          className=\"h-10 w-10\"\n          data-testid={`button-play-pause-${audioId}`}\n        >\n          {isPlaying ? (\n            <Pause className=\"h-4 w-4\" />\n          ) : (\n            <Play className=\"h-4 w-4 ml-0.5\" />\n          )}\n        </Button>\n        <Button\n          size=\"icon\"\n          variant=\"outline\"\n          onClick={toggleMute}\n          className=\"h-8 w-8\"\n          data-testid={`button-mute-${audioId}`}\n        >\n          {isMuted ? (\n            <VolumeX className=\"h-3.5 w-3.5\" />\n          ) : (\n            <Volume2 className=\"h-3.5 w-3.5\" />\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default function AudioLibrary() {\n  const { isAuthenticated, isLoading: authLoading } = useAuth();\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: summaries = [], isLoading: summariesLoading } = useQuery<Summary[]>({\n    queryKey: [\"/api/summaries\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: materials = [], isLoading: materialsLoading } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const audioSummaries = summaries.filter((summary) => summary.audioUrl);\n\n  const getMaterialTitle = (materialId: string) => {\n    const material = materials.find((m) => m.id === materialId);\n    return material?.title || \"Unknown Material\";\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  if (authLoading || summariesLoading || materialsLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <motion.div\n            animate={{ rotate: 360 }}\n            transition={{ duration: 2, repeat: Infinity, ease: \"linear\" }}\n          >\n            <div className=\"inline-block h-12 w-12 rounded-full border-4 border-primary border-t-transparent\"></div>\n          </motion.div>\n          <p className=\"mt-4 text-muted-foreground font-medium\" data-testid=\"text-loading\">\n            Loading audio library...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-6 md:py-8 max-w-7xl\">\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n        className=\"mb-6 md:mb-8\"\n      >\n        <div className=\"flex items-center gap-3 mb-2\">\n          <div className=\"p-3 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 backdrop-blur-sm\">\n            <Headphones className=\"h-6 w-6 md:h-7 md:w-7 text-primary\" />\n          </div>\n          <div>\n            <h1 className=\"font-heading font-bold text-2xl md:text-3xl\" data-testid=\"text-audio-library-title\">\n              Audio Library\n            </h1>\n            <p className=\"text-muted-foreground text-sm md:text-base\">\n              Listen to all your AI-generated audio summaries in one place\n            </p>\n          </div>\n        </div>\n      </motion.div>\n\n      <AnimatePresence mode=\"wait\">\n        {audioSummaries.length === 0 ? (\n          <motion.div\n            key=\"empty\"\n            initial={{ opacity: 0, scale: 0.9 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.9 }}\n            transition={{ duration: 0.5 }}\n          >\n            <Card className=\"p-8 md:p-12 text-center border-2 border-dashed max-w-2xl mx-auto\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-block p-4 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4\"\n              >\n                <Headphones className=\"h-12 w-12 md:h-16 md:w-16 text-primary\" />\n              </motion.div>\n              <motion.h2\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.3 }}\n                className=\"font-heading font-semibold text-lg md:text-xl mb-2\"\n                data-testid=\"text-no-audio\"\n              >\n                No Audio Summaries Yet\n              </motion.h2>\n              <motion.p\n                initial={{ opacity: 0, y: 10 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ delay: 0.4 }}\n                className=\"text-muted-foreground mb-6 text-sm md:text-base\"\n              >\n                Generate audio summaries from your study materials to listen to them here.\n              </motion.p>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                transition={{ delay: 0.5 }}\n              >\n                <Link href=\"/materials\">\n                  <Button className=\"w-full sm:w-auto shadow-sm\" data-testid=\"link-go-to-materials\">\n                    Go to Study Materials\n                  </Button>\n                </Link>\n              </motion.div>\n            </Card>\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"grid\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.4 }}\n            className=\"grid gap-4 md:gap-6 sm:grid-cols-2 lg:grid-cols-3\"\n          >\n            {audioSummaries.map((summary, index) => (\n              <motion.div\n                key={summary.id}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.4, delay: index * 0.1 }}\n              >\n                <Card className=\"p-5 md:p-6 border-2 hover-elevate h-full flex flex-col\" data-testid={`card-audio-${summary.id}`}>\n                  <div className=\"flex items-start gap-3 mb-4\">\n                    <div className=\"p-2 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 flex-shrink-0\">\n                      <FileText className=\"h-4 w-4 text-primary\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <Link\n                        href={`/materials/${summary.materialId}`}\n                        className=\"font-semibold text-sm hover:text-primary transition-colors block truncate\"\n                        data-testid={`link-material-${summary.id}`}\n                      >\n                        {getMaterialTitle(summary.materialId)}\n                      </Link>\n                      <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground mt-1\">\n                        <Calendar className=\"h-3 w-3\" />\n                        <span data-testid={`text-date-${summary.id}`}>\n                          {formatDate(summary.createdAt)}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"mb-4 p-4 rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 border border-primary/20\">\n                    <CompactAudioPlayer audioUrl={summary.audioUrl || \"\"} audioId={summary.id} />\n                  </div>\n\n                  <div className=\"text-xs text-muted-foreground line-clamp-2 leading-relaxed mt-auto\">\n                    {summary.content.substring(0, 120)}...\n                  </div>\n                </Card>\n              </motion.div>\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","size_bytes":11761},"server/collabWebSocket.ts":{"content":"import { WebSocketServer, WebSocket } from \"ws\";\nimport type { Server } from \"http\";\nimport type { IncomingMessage } from \"http\";\nimport { storage } from \"./storage\";\nimport { parse as parseCookie } from \"cookie\";\nimport { getSessionStore } from \"./replitAuth\";\n\n// WebSocket message types\nexport interface WSMessage {\n  type: string;\n  sessionId: string;\n  data?: any;\n}\n\n// Connected clients map: sessionId -> Set of WebSockets\nconst sessionClients = new Map<string, Set<WebSocket>>();\n\n// Client to session map for cleanup\nconst clientSessions = new Map<WebSocket, string>();\n\n// WebSocket to authenticated userId map\nconst authenticatedClients = new Map<WebSocket, string>();\n\nexport function setupCollabWebSocket(server: Server) {\n  const wss = new WebSocketServer({ \n    server,\n    path: \"/collab-ws\",\n    verifyClient: async (info, callback) => {\n      try {\n        // Extract session cookie\n        const cookies = parseCookie(info.req.headers.cookie || \"\");\n        const sessionId = cookies[\"connect.sid\"]?.split(\"s:\")[1]?.split(\".\")[0];\n        \n        if (!sessionId) {\n          callback(false, 401, \"Unauthorized\");\n          return;\n        }\n\n        // Verify session\n        const sessionStore = getSessionStore();\n        sessionStore.get(sessionId, (err: any, session: any) => {\n          if (err || !session || !session.passport?.user?.claims?.sub) {\n            callback(false, 401, \"Unauthorized\");\n            return;\n          }\n          \n          // Session is valid\n          callback(true);\n        });\n      } catch (error) {\n        console.error(\"WebSocket auth error:\", error);\n        callback(false, 500, \"Internal Server Error\");\n      }\n    }\n  });\n\n  wss.on(\"connection\", async (ws: WebSocket, req: IncomingMessage) => {\n    console.log(\"New WebSocket connection established\");\n\n    // Authenticate user from session\n    const cookies = parseCookie(req.headers.cookie || \"\");\n    const sessionId = cookies[\"connect.sid\"]?.split(\"s:\")[1]?.split(\".\")[0];\n    \n    let authenticatedUserId: string | null = null;\n    \n    if (sessionId) {\n      const sessionStore = getSessionStore();\n      await new Promise((resolve) => {\n        sessionStore.get(sessionId, (err: any, session: any) => {\n          if (!err && session?.passport?.user?.claims?.sub) {\n            authenticatedUserId = session.passport.user.claims.sub;\n          }\n          resolve(null);\n        });\n      });\n    }\n\n    if (!authenticatedUserId) {\n      ws.close(1008, \"Unauthorized\");\n      return;\n    }\n\n    // Store authenticated user\n    authenticatedClients.set(ws, authenticatedUserId);\n\n    ws.on(\"message\", async (message: string) => {\n      try {\n        const msg: WSMessage = JSON.parse(message.toString());\n        const userId = authenticatedClients.get(ws);\n        \n        if (!userId) {\n          ws.close(1008, \"Unauthorized\");\n          return;\n        }\n        \n        switch (msg.type) {\n          case \"join\":\n            await handleJoin(ws, msg, userId);\n            break;\n          case \"leave\":\n            await handleLeave(ws, msg, userId);\n            break;\n          case \"tab_switch\":\n            await handleTabSwitch(ws, msg, userId);\n            break;\n          case \"pause\":\n            await handlePause(ws, msg, userId);\n            break;\n          case \"unpause\":\n            await handleUnpause(ws, msg, userId);\n            break;\n          case \"break_start\":\n            await handleBreakStart(ws, msg, userId);\n            break;\n          case \"break_end\":\n            await handleBreakEnd(ws, msg, userId);\n            break;\n          case \"whiteboard_update\":\n            await handleWhiteboardUpdate(ws, msg, userId);\n            break;\n          case \"mute_participant\":\n            await handleMuteParticipant(ws, msg, userId);\n            break;\n          case \"kick_participant\":\n            await handleKickParticipant(ws, msg, userId);\n            break;\n          case \"mute_all\":\n            await handleMuteAll(ws, msg, userId);\n            break;\n          case \"concentration_toggle\":\n            await handleConcentrationToggle(ws, msg, userId);\n            break;\n          case \"chat_message\":\n            await handleChatMessage(ws, msg, userId);\n            break;\n          case \"reaction_add\":\n            await handleReactionAdd(ws, msg, userId);\n            break;\n          case \"presentation_upload\":\n            await handlePresentationUpload(ws, msg, userId);\n            break;\n          case \"presentation_control\":\n            await handlePresentationControl(ws, msg, userId);\n            break;\n          case \"drawing_state\":\n            await handleDrawingState(ws, msg, userId);\n            break;\n          default:\n            console.log(\"Unknown message type:\", msg.type);\n        }\n      } catch (error) {\n        console.error(\"Error handling WebSocket message:\", error);\n      }\n    });\n\n    ws.on(\"close\", async () => {\n      const userId = authenticatedClients.get(ws);\n      const sessionId = clientSessions.get(ws);\n      \n      if (sessionId && userId) {\n        // Mark participant as left\n        const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n        if (participant) {\n          await storage.removeCollabParticipant(participant.id);\n        }\n        \n        // Clean up client maps\n        const clients = sessionClients.get(sessionId);\n        if (clients) {\n          clients.delete(ws);\n          if (clients.size === 0) {\n            sessionClients.delete(sessionId);\n          }\n        }\n        clientSessions.delete(ws);\n        authenticatedClients.delete(ws);\n        \n        // Notify others\n        broadcast(sessionId, {\n          type: \"participant_left\",\n          sessionId,\n          data: { userId },\n        });\n      }\n      console.log(\"WebSocket connection closed\");\n    });\n\n    ws.on(\"error\", (error) => {\n      console.error(\"WebSocket error:\", error);\n    });\n  });\n\n  console.log(\"Collaboration WebSocket server initialized\");\n  return wss;\n}\n\n// Broadcast message to all clients in a session except sender\nfunction broadcast(sessionId: string, message: WSMessage, sender?: WebSocket) {\n  const clients = sessionClients.get(sessionId);\n  if (!clients) return;\n\n  const messageStr = JSON.stringify(message);\n  clients.forEach((client) => {\n    if (client !== sender && client.readyState === WebSocket.OPEN) {\n      client.send(messageStr);\n    }\n  });\n}\n\n// Send message to specific client\nfunction sendToClient(ws: WebSocket, message: WSMessage) {\n  if (ws.readyState === WebSocket.OPEN) {\n    ws.send(JSON.stringify(message));\n  }\n}\n\nasync function handleJoin(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify session exists and is active\n  const session = await storage.getCollabSession(sessionId);\n  if (!session || !session.isActive) {\n    ws.close(1008, \"Session not found or inactive\");\n    return;\n  }\n  \n  // Verify user is a participant in this session\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Not authorized to join this session\");\n    return;\n  }\n  \n  // Add client to session\n  if (!sessionClients.has(sessionId)) {\n    sessionClients.set(sessionId, new Set());\n  }\n  sessionClients.get(sessionId)!.add(ws);\n  clientSessions.set(ws, sessionId);\n\n  // Get user info\n  const user = await storage.getUser(userId);\n  \n  // Log join activity\n  await storage.createCollabActivity({\n    sessionId,\n    userId,\n    activityType: \"join\",\n    metadata: { userName: user ? `${user.firstName} ${user.lastName}` : \"Unknown\" },\n  });\n\n  // Get all active participants\n  const participants = await storage.getActiveCollabParticipantsBySession(sessionId);\n  \n  // Notify all other clients\n  broadcast(sessionId, {\n    type: \"participant_joined\",\n    sessionId,\n    data: { participant, allParticipants: participants, userId },\n  }, ws);\n\n  // Send current state to new participant\n  sendToClient(ws, {\n    type: \"session_state\",\n    sessionId,\n    data: { participants },\n  });\n}\n\nasync function handleLeave(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify participant authorization (allow leave even if not found)\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (participant) {\n    await storage.removeCollabParticipant(participant.id);\n  }\n\n  // Log leave activity\n  await storage.createCollabActivity({\n    sessionId,\n    userId,\n    activityType: \"leave\",\n  });\n\n  // Remove client from session\n  const clients = sessionClients.get(sessionId);\n  if (clients) {\n    clients.delete(ws);\n    if (clients.size === 0) {\n      sessionClients.delete(sessionId);\n    }\n  }\n  clientSessions.delete(ws);\n\n  // Notify others\n  broadcast(sessionId, {\n    type: \"participant_left\",\n    sessionId,\n    data: { userId },\n  });\n}\n\nasync function handleTabSwitch(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  if (participant) {\n    await storage.updateCollabParticipant(participant.id, {\n      tabSwitches: participant.tabSwitches + 1,\n    });\n\n    // Log activity\n    await storage.createCollabActivity({\n      sessionId,\n      userId,\n      activityType: \"tab_switch\",\n      metadata: { count: participant.tabSwitches + 1 },\n    });\n\n    // Broadcast to all participants\n    broadcast(sessionId, {\n      type: \"tab_switch\",\n      sessionId,\n      data: { userId, count: participant.tabSwitches + 1 },\n    });\n  }\n}\n\nasync function handlePause(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  if (participant) {\n    await storage.updateCollabParticipant(participant.id, {\n      pauseCount: participant.pauseCount + 1,\n    });\n\n    await storage.createCollabActivity({\n      sessionId,\n      userId,\n      activityType: \"pause\",\n    });\n\n    broadcast(sessionId, {\n      type: \"participant_paused\",\n      sessionId,\n      data: { userId },\n    });\n  }\n}\n\nasync function handleUnpause(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  await storage.createCollabActivity({\n    sessionId,\n    userId,\n    activityType: \"unpause\",\n  });\n\n  broadcast(sessionId, {\n    type: \"participant_unpaused\",\n    sessionId,\n    data: { userId },\n  });\n}\n\nasync function handleBreakStart(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  if (participant) {\n    await storage.updateCollabParticipant(participant.id, {\n      isOnBreak: true,\n      breakStartTime: new Date(),\n    });\n\n    await storage.createCollabActivity({\n      sessionId,\n      userId,\n      activityType: \"break_start\",\n      metadata: { duration: data?.duration || 0 },\n    });\n\n    // Broadcast break timer to all participants\n    broadcast(sessionId, {\n      type: \"break_started\",\n      sessionId,\n      data: { userId, duration: data?.duration },\n    });\n  }\n}\n\nasync function handleBreakEnd(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  if (participant) {\n    const breakDuration = data?.actualDuration || 0;\n    await storage.updateCollabParticipant(participant.id, {\n      isOnBreak: false,\n      breakStartTime: null,\n      breakDuration: participant.breakDuration + breakDuration,\n    });\n\n    await storage.createCollabActivity({\n      sessionId,\n      userId,\n      activityType: \"break_end\",\n      metadata: { duration: breakDuration },\n    });\n\n    // Notify all participants break is over\n    broadcast(sessionId, {\n      type: \"break_ended\",\n      sessionId,\n      data: { userId },\n    });\n  }\n}\n\nasync function handleWhiteboardUpdate(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Broadcast whiteboard changes to all other participants\n  broadcast(sessionId, {\n    type: \"whiteboard_update\",\n    sessionId,\n    data: data,\n  }, ws);\n}\n\nasync function handleMuteParticipant(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  const targetUserId = data?.targetUserId;\n  \n  if (!targetUserId) return;\n  \n  // Verify sender is participant and authorized\n  const senderParticipant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!senderParticipant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n\n  const participant = await storage.getCollabParticipantByUserAndSession(targetUserId, sessionId);\n  if (participant) {\n    await storage.updateCollabParticipant(participant.id, {\n      isMuted: !participant.isMuted,\n    });\n\n    broadcast(sessionId, {\n      type: \"participant_muted\",\n      sessionId,\n      data: { targetUserId, isMuted: !participant.isMuted },\n    });\n  }\n}\n\nasync function handleKickParticipant(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  const targetUserId = data?.targetUserId;\n  \n  if (!targetUserId) return;\n  \n  // Verify sender is participant\n  const senderParticipant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!senderParticipant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n\n  // Verify sender is host\n  const session = await storage.getCollabSession(sessionId);\n  if (session && session.hostUserId === userId) {\n    const participant = await storage.getCollabParticipantByUserAndSession(targetUserId, sessionId);\n    if (participant) {\n      await storage.updateCollabParticipant(participant.id, {\n        isBanned: true,\n      });\n      await storage.removeCollabParticipant(participant.id);\n\n      broadcast(sessionId, {\n        type: \"participant_kicked\",\n        sessionId,\n        data: { targetUserId },\n      });\n    }\n  }\n}\n\nasync function handleMuteAll(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId } = msg;\n  \n  // Verify sender is participant\n  const senderParticipant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!senderParticipant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Verify sender is host\n  const session = await storage.getCollabSession(sessionId);\n  if (session && session.hostUserId === userId) {\n    const participants = await storage.getActiveCollabParticipantsBySession(sessionId);\n    \n    for (const participant of participants) {\n      if (participant.userId !== userId) {\n        await storage.updateCollabParticipant(participant.id, {\n          isMuted: true,\n        });\n      }\n    }\n\n    broadcast(sessionId, {\n      type: \"all_muted\",\n      sessionId,\n      data: {},\n    });\n  }\n}\n\nasync function handleConcentrationToggle(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  console.log(\"[ConcentrationToggle] Received from userId:\", userId, \"sessionId:\", sessionId, \"data:\", data);\n  \n  // Verify sender is participant\n  const senderParticipant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!senderParticipant) {\n    console.log(\"[ConcentrationToggle] User not a participant, closing connection\");\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Verify sender is host\n  const session = await storage.getCollabSession(sessionId);\n  console.log(\"[ConcentrationToggle] Session:\", session?.id, \"hostUserId:\", session?.hostUserId, \"isHost:\", session?.hostUserId === userId);\n  \n  if (session && session.hostUserId === userId) {\n    const newMode = data?.enabled ?? !session.concentrationMode;\n    console.log(\"[ConcentrationToggle] Updating concentration mode to:\", newMode);\n    \n    await storage.updateCollabSession(sessionId, {\n      concentrationMode: newMode,\n    });\n\n    console.log(\"[ConcentrationToggle] Broadcasting concentration_toggled with enabled:\", newMode);\n    // Don't pass sender parameter so the host also receives the update\n    broadcast(sessionId, {\n      type: \"concentration_toggled\",\n      sessionId,\n      data: { enabled: newMode },\n    });\n  } else {\n    console.log(\"[ConcentrationToggle] User is not host, ignoring request\");\n  }\n}\n\nasync function handleChatMessage(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Check if participant is muted\n  if (participant.isMuted) {\n    sendToClient(ws, {\n      type: \"chat_error\",\n      sessionId,\n      data: { message: \"You are muted and cannot send messages\" },\n    });\n    return;\n  }\n  \n  // Save chat message\n  const chatMessage = await storage.createCollabChatMessage({\n    sessionId,\n    userId,\n    content: data.content,\n  });\n  \n  // Get user info\n  const user = await storage.getUser(userId);\n  \n  // Broadcast to all participants\n  broadcast(sessionId, {\n    type: \"chat_message\",\n    sessionId,\n    data: {\n      id: chatMessage.id,\n      userId,\n      userName: user ? `${user.firstName} ${user.lastName}` : \"Unknown\",\n      content: data.content,\n      createdAt: chatMessage.createdAt,\n    },\n  });\n}\n\nasync function handleReactionAdd(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Check if participant is muted\n  if (participant.isMuted) {\n    sendToClient(ws, {\n      type: \"action_blocked\",\n      sessionId,\n      data: { reason: \"You are currently muted\" },\n    });\n    return;\n  }\n  \n  // Get user info\n  const user = await storage.getUser(userId);\n  \n  // Broadcast ephemeral reaction to all participants (no DB storage)\n  broadcast(sessionId, {\n    type: \"reaction_added\",\n    sessionId,\n    data: {\n      userId,\n      userName: user ? `${user.firstName} ${user.lastName}` : \"Unknown\",\n      emoji: data.emoji,\n      x: data.x,\n      y: data.y,\n      timestamp: new Date().toISOString(),\n    },\n  });\n}\n\nasync function handlePresentationUpload(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Create presentation record\n  const presentation = await storage.createCollabPresentation({\n    sessionId,\n    uploadedBy: userId,\n    fileName: data.fileName,\n    fileUrl: data.fileUrl,\n    fileType: data.fileType,\n    currentPage: 1,\n    isActive: false,\n  });\n  \n  // Grant edit permissions if specified\n  if (data.canEdit && Array.isArray(data.canEdit)) {\n    for (const editorUserId of data.canEdit) {\n      await storage.grantCollabPresentationEdit({\n        presentationId: presentation.id,\n        userId: editorUserId,\n      });\n    }\n  }\n  \n  // Get user info\n  const user = await storage.getUser(userId);\n  \n  // Get editor list\n  const editors = await storage.getCollabPresentationEditors(presentation.id);\n  const editorUserIds = editors.map(e => e.userId);\n  \n  // Broadcast to all participants\n  broadcast(sessionId, {\n    type: \"presentation_uploaded\",\n    sessionId,\n    data: {\n      id: presentation.id,\n      uploadedBy: userId,\n      uploaderName: user ? `${user.firstName} ${user.lastName}` : \"Unknown\",\n      fileName: data.fileName,\n      fileUrl: data.fileUrl,\n      fileType: data.fileType,\n      canEdit: editorUserIds,\n      uploadedAt: presentation.uploadedAt,\n    },\n  });\n}\n\nasync function handlePresentationControl(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  const { presentationId, action, value } = data;\n  \n  // Get presentation\n  const presentation = await storage.getCollabPresentation(presentationId);\n  if (!presentation || presentation.sessionId !== sessionId) {\n    return;\n  }\n  \n  // Check if user has edit permissions\n  const isUploader = presentation.uploadedBy === userId;\n  const hasEditPermission = isUploader || await storage.hasCollabPresentationEditPermission(presentationId, userId);\n  \n  // Get session to check if user is host\n  const session = await storage.getCollabSession(sessionId);\n  const isHost = session?.hostUserId === userId;\n  \n  // Host can always control, others need edit permission for page changes\n  if (action === \"setPage\" && !isHost && !hasEditPermission) {\n    sendToClient(ws, {\n      type: \"presentation_error\",\n      sessionId,\n      data: { message: \"You don't have permission to control this presentation\" },\n    });\n    return;\n  }\n  \n  // Update presentation based on action\n  if (action === \"setPage\") {\n    await storage.updateCollabPresentation(presentationId, {\n      currentPage: value,\n    });\n  } else if (action === \"setActive\") {\n    await storage.updateCollabPresentation(presentationId, {\n      isActive: value,\n    });\n  } else if (action === \"grantEdit\") {\n    // Grant edit permission to a user\n    await storage.grantCollabPresentationEdit({\n      presentationId,\n      userId: value,\n    });\n  } else if (action === \"revokeEdit\") {\n    // Revoke edit permission from a user\n    await storage.revokeCollabPresentationEdit(presentationId, value);\n  }\n  \n  // Broadcast control change to all participants\n  broadcast(sessionId, {\n    type: \"presentation_control\",\n    sessionId,\n    data: {\n      presentationId,\n      action,\n      value,\n      controlledBy: userId,\n    },\n  });\n}\n\nasync function handleDrawingState(ws: WebSocket, msg: WSMessage, userId: string) {\n  const { sessionId, data } = msg;\n  \n  // Verify participant authorization\n  const participant = await storage.getCollabParticipantByUserAndSession(userId, sessionId);\n  if (!participant) {\n    ws.close(1008, \"Unauthorized\");\n    return;\n  }\n  \n  // Check if muted or if mute_all is active\n  if (participant.isMuted) {\n    return; // Silently ignore if muted\n  }\n  \n  // Get user info\n  const user = await storage.getUser(userId);\n  \n  // Broadcast drawing state to all participants\n  broadcast(sessionId, {\n    type: \"drawing_state\",\n    sessionId,\n    data: {\n      userId,\n      userName: user ? `${user.firstName} ${user.lastName}` : \"Unknown\",\n      isDrawing: data.isDrawing,\n      tool: data.tool, // pen, eraser, highlighter\n      color: data.color,\n      size: data.size,\n    },\n  }, ws);\n}\n","size_bytes":23884},"client/src/pages/mind-maps.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Sparkles, Network, Loader2, Eye, Map as MapIcon } from \"lucide-react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport type { MindMap, StudyMaterial } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { MindMapCanvas } from \"@/components/MindMapCanvas\";\n\ninterface MindMapNode {\n  id: string;\n  label: string;\n  children?: MindMapNode[];\n}\n\nexport default function MindMaps() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { isAuthenticated, isLoading: authLoading, user } = useAuth();\n  const [selectedMaterial, setSelectedMaterial] = useState<string | null>(null);\n  const [viewingMindMap, setViewingMindMap] = useState<MindMap | null>(null);\n\n  useEffect(() => {\n    if (!authLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, authLoading, toast]);\n\n  const { data: materials } = useQuery<StudyMaterial[]>({\n    queryKey: [\"/api/study-materials\"],\n    enabled: isAuthenticated,\n  });\n\n  const { data: mindMaps } = useQuery<MindMap[]>({\n    queryKey: [\"/api/mind-maps\", selectedMaterial],\n    queryFn: async () => {\n      const url = selectedMaterial\n        ? `/api/mind-maps?materialId=${selectedMaterial}`\n        : \"/api/mind-maps\";\n      const response = await fetch(url, { credentials: \"include\" });\n      if (!response.ok) throw new Error(\"Failed to fetch mind maps\");\n      return response.json();\n    },\n    enabled: isAuthenticated,\n  });\n\n  const generateMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedMaterial) throw new Error(\"No material selected\");\n      const response = await apiRequest(\"POST\", \"/api/mind-maps/generate\", {\n        materialId: selectedMaterial,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/mind-maps\", selectedMaterial] });\n      toast({\n        title: \"Success\",\n        description: \"Mind map generated successfully!\",\n      });\n    },\n    onError: (error: Error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to generate mind map\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGenerate = () => {\n    if (!selectedMaterial) {\n      toast({\n        title: \"No Material Selected\",\n        description: \"Please select a study material first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    generateMutation.mutate();\n  };\n\n  const handleViewMindMap = (mindMap: MindMap) => {\n    setViewingMindMap(mindMap);\n  };\n\n  const handleCloseMindMap = () => {\n    setViewingMindMap(null);\n  };\n\n  if (authLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent\"></div>\n          <p className=\"mt-4 text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"mb-8 flex items-center gap-3\">\n        <MapIcon className=\"h-8 w-8 text-primary\" />\n        <div className=\"flex-1\">\n          <h1 className=\"font-heading font-bold text-3xl md:text-4xl mb-2\" data-testid=\"text-mind-maps-title\">\n            Mind Maps\n          </h1>\n          <p className=\"text-muted-foreground\" data-testid=\"text-mind-maps-subtitle\">\n            Generate visual concept maps from your study materials\n          </p>\n        </div>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-8\">\n        <Card data-testid=\"card-generate-mind-map\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-primary\" />\n              Generate Mind Map\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"material\">Select Study Material</Label>\n              <Select value={selectedMaterial || \"\"} onValueChange={setSelectedMaterial}>\n                <SelectTrigger data-testid=\"select-material\">\n                  <SelectValue placeholder=\"Choose a material\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {materials?.map((material) => (\n                    <SelectItem key={material.id} value={material.id}>\n                      {material.title}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <Button\n              onClick={handleGenerate}\n              disabled={!selectedMaterial || generateMutation.isPending}\n              className=\"w-full\"\n              data-testid=\"button-generate-mind-map\"\n            >\n              {generateMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Generating...\n                </>\n              ) : (\n                <>\n                  <Sparkles className=\"mr-2 h-4 w-4\" />\n                  Generate Mind Map\n                </>\n              )}\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-mind-maps-list\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Network className=\"h-5 w-5 text-primary\" />\n              Your Mind Maps\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {mindMaps && mindMaps.length > 0 ? (\n              <div className=\"space-y-2\">\n                {mindMaps.map((mindMap) => (\n                  <Card key={mindMap.id} className=\"p-4\" data-testid={`card-mind-map-${mindMap.id}`}>\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold mb-2\">{mindMap.title}</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Created: {new Date(mindMap.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => handleViewMindMap(mindMap)}\n                        data-testid={`button-view-mind-map-${mindMap.id}`}\n                      >\n                        <Eye className=\"h-4 w-4 mr-2\" />\n                        View\n                      </Button>\n                    </div>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Network className=\"h-12 w-12 text-muted-foreground mx-auto mb-3\" />\n                <p className=\"text-muted-foreground\">No mind maps yet</p>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Select a material and click generate\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {viewingMindMap && (\n        <div className=\"mt-8\">\n          <Card className=\"p-6\" data-testid={`card-mind-map-canvas-${viewingMindMap.id}`}>\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h2 className=\"font-heading font-semibold text-2xl\">{viewingMindMap.title}</h2>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  Interactive mind map - Click arrows to collapse/expand nodes\n                </p>\n              </div>\n              <Button\n                variant=\"secondary\"\n                onClick={handleCloseMindMap}\n                data-testid=\"button-close-mind-map\"\n              >\n                Close\n              </Button>\n            </div>\n            <MindMapCanvas data={{ nodes: viewingMindMap.content as MindMapNode }} />\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":9146},"server/deepgram.ts":{"content":"import { createClient } from \"@deepgram/sdk\";\n\nconst DEEPGRAM_API_KEY = process.env.DEEPGRAM_API_KEY;\n\nif (!DEEPGRAM_API_KEY) {\n  throw new Error(\"DEEPGRAM_API_KEY environment variable is required\");\n}\n\nconst deepgram = createClient(DEEPGRAM_API_KEY);\n\nexport interface TextToSpeechOptions {\n  text: string;\n  model?: string;\n  voice?: string;\n}\n\n/**\n * Split text into chunks at sentence boundaries\n */\nfunction splitTextIntoChunks(text: string, maxChunkSize: number = 1900): string[] {\n  if (text.length <= maxChunkSize) {\n    return [text];\n  }\n\n  const chunks: string[] = [];\n  let remainingText = text;\n\n  while (remainingText.length > 0) {\n    if (remainingText.length <= maxChunkSize) {\n      chunks.push(remainingText);\n      break;\n    }\n\n    // Get a chunk\n    let chunk = remainingText.substring(0, maxChunkSize);\n    \n    // Try to find a sentence boundary\n    const lastPeriod = chunk.lastIndexOf('.');\n    const lastExclamation = chunk.lastIndexOf('!');\n    const lastQuestion = chunk.lastIndexOf('?');\n    const lastSentenceEnd = Math.max(lastPeriod, lastExclamation, lastQuestion);\n    \n    // If we found a sentence boundary in the last 20% of the chunk, use it\n    if (lastSentenceEnd > maxChunkSize * 0.8) {\n      chunk = chunk.substring(0, lastSentenceEnd + 1);\n    }\n    \n    chunks.push(chunk.trim());\n    remainingText = remainingText.substring(chunk.length).trim();\n  }\n\n  return chunks;\n}\n\n/**\n * Combine multiple WAV buffers into one\n * WAV files have a 44-byte header, we keep the first header and concatenate the audio data\n */\nfunction combineWavBuffers(buffers: Buffer[]): Buffer {\n  if (buffers.length === 0) {\n    throw new Error(\"No buffers to combine\");\n  }\n  \n  if (buffers.length === 1) {\n    return buffers[0];\n  }\n\n  // WAV header is 44 bytes\n  const WAV_HEADER_SIZE = 44;\n  \n  // Get the first buffer's header\n  const header = buffers[0].slice(0, WAV_HEADER_SIZE);\n  \n  // Collect all audio data (skip headers from all buffers)\n  const audioDataChunks = buffers.map(buffer => buffer.slice(WAV_HEADER_SIZE));\n  \n  // Calculate total audio data size\n  const totalAudioSize = audioDataChunks.reduce((sum, chunk) => sum + chunk.length, 0);\n  \n  // Update the file size in the header\n  // Bytes 4-7 contain file size - 8\n  const totalFileSize = WAV_HEADER_SIZE + totalAudioSize - 8;\n  header.writeUInt32LE(totalFileSize, 4);\n  \n  // Bytes 40-43 contain audio data size\n  header.writeUInt32LE(totalAudioSize, 40);\n  \n  // Combine header + all audio data\n  return Buffer.concat([header, ...audioDataChunks]);\n}\n\nasync function generateAudioForSingleChunk(text: string, model: string): Promise<Buffer> {\n  const response = await deepgram.speak.request(\n    { text },\n    {\n      model,\n      encoding: \"linear16\",\n      container: \"wav\",\n    }\n  );\n\n  const stream = await response.getStream();\n  if (!stream) {\n    throw new Error(\"Failed to get audio stream from Deepgram\");\n  }\n\n  const chunks: Uint8Array[] = [];\n  const reader = stream.getReader();\n\n  while (true) {\n    const { done, value } = await reader.read();\n    if (done) break;\n    chunks.push(value);\n  }\n\n  const totalLength = chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n  const audioBuffer = new Uint8Array(totalLength);\n  let offset = 0;\n  for (const chunk of chunks) {\n    audioBuffer.set(chunk, offset);\n    offset += chunk.length;\n  }\n\n  return Buffer.from(audioBuffer);\n}\n\nexport async function generateAudioFromText(options: TextToSpeechOptions): Promise<Buffer> {\n  const { text, model = \"aura-asteria-en\" } = options;\n\n  try {\n    // Split text into chunks if needed\n    const textChunks = splitTextIntoChunks(text, 1900);\n    \n    if (textChunks.length === 1) {\n      console.log(\"Generating audio for single chunk\");\n      return await generateAudioForSingleChunk(text, model);\n    }\n\n    console.log(`Generating audio in ${textChunks.length} chunks`);\n    \n    // Generate audio for each chunk\n    const audioBuffers: Buffer[] = [];\n    for (let i = 0; i < textChunks.length; i++) {\n      console.log(`Generating audio chunk ${i + 1}/${textChunks.length} (${textChunks[i].length} chars)`);\n      const buffer = await generateAudioForSingleChunk(textChunks[i], model);\n      audioBuffers.push(buffer);\n    }\n\n    // Combine all audio buffers\n    console.log(\"Combining audio chunks...\");\n    const combinedBuffer = combineWavBuffers(audioBuffers);\n    console.log(`Combined audio size: ${combinedBuffer.length} bytes`);\n    \n    return combinedBuffer;\n  } catch (error) {\n    console.error(\"Error generating audio from text:\", error);\n    throw new Error(\"Failed to generate audio with Deepgram\");\n  }\n}\n","size_bytes":4622},"client/src/pages/collab.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Users, Plus, LogIn, Copy, Clock, Pause, Play, Bell, Volume2, VolumeX, UserX, Eye, EyeOff, Pen, Eraser, Highlighter, Send } from \"lucide-react\";\nimport type { CollabSession, CollabParticipant, User } from \"@shared/schema\";\n\ninterface ParticipantWithUser extends CollabParticipant {\n  user?: User;\n}\n\ninterface ChatMessage {\n  id: string;\n  userId: string;\n  userName: string;\n  content: string;\n  createdAt: string | Date;\n}\n\nexport default function Collab() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [joinDialogOpen, setJoinDialogOpen] = useState(false);\n  const [sessionTitle, setSessionTitle] = useState(\"\");\n  const [sessionCode, setSessionCode] = useState(\"\");\n  const [activeSession, setActiveSession] = useState<CollabSession | null>(null);\n  const [participants, setParticipants] = useState<ParticipantWithUser[]>([]);\n  const [whiteboardContent, setWhiteboardContent] = useState<any>({ elements: [] });\n  const [isOnBreak, setIsOnBreak] = useState(false);\n  const [breakTimeLeft, setBreakTimeLeft] = useState(0);\n  const [tabSwitchCount, setTabSwitchCount] = useState(0);\n  const wsRef = useRef<WebSocket | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [drawColor, setDrawColor] = useState(\"#000000\");\n  const [drawTool, setDrawTool] = useState<\"pen\" | \"eraser\" | \"highlighter\">(\"pen\");\n  const [drawSize, setDrawSize] = useState<number>(2);\n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);\n  const [chatInput, setChatInput] = useState(\"\");\n  const chatScrollRef = useRef<HTMLDivElement | null>(null);\n\n  // Fetch user's sessions\n  const { data: mySessions } = useQuery<CollabSession[]>({\n    queryKey: [\"/api/collab/my-sessions\"],\n    enabled: !!user && !activeSession,\n  });\n\n  // Create session mutation\n  const createSessionMutation = useMutation({\n    mutationFn: async (title: string) => {\n      const response = await fetch(\"/api/collab/sessions\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ title }),\n      });\n      if (!response.ok) {\n        throw new Error(await response.text());\n      }\n      return response.json();\n    },\n    onSuccess: (session: CollabSession) => {\n      setActiveSession(session);\n      setCreateDialogOpen(false);\n      setSessionTitle(\"\");\n      connectWebSocket(session.id);\n      queryClient.invalidateQueries({ queryKey: [\"/api/collab/my-sessions\"] });\n      toast({\n        title: \"Session Created\",\n        description: `Session \"${session.title}\" created. Share code: ${session.sessionCode}`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create session\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Join session mutation\n  const joinSessionMutation = useMutation({\n    mutationFn: async (code: string) => {\n      const sessionRes = await fetch(`/api/collab/sessions/code/${code}`, {\n        credentials: \"include\",\n      });\n      if (!sessionRes.ok) {\n        throw new Error(await sessionRes.text());\n      }\n      const session = await sessionRes.json();\n      \n      const joinRes = await fetch(`/api/collab/sessions/${session.id}/join`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!joinRes.ok) {\n        throw new Error(await joinRes.text());\n      }\n      \n      return session;\n    },\n    onSuccess: (session: CollabSession) => {\n      setActiveSession(session);\n      setJoinDialogOpen(false);\n      setSessionCode(\"\");\n      connectWebSocket(session.id);\n      toast({\n        title: \"Joined Session\",\n        description: `You've joined \"${session.title}\"`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to join session\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // End session mutation\n  const endSessionMutation = useMutation({\n    mutationFn: async (sessionId: string) => {\n      const response = await fetch(`/api/collab/sessions/${sessionId}/end`, {\n        method: \"POST\",\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        throw new Error(await response.text());\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      disconnectWebSocket();\n      setActiveSession(null);\n      queryClient.invalidateQueries({ queryKey: [\"/api/collab/my-sessions\"] });\n      toast({\n        title: \"Session Ended\",\n        description: \"The session has been ended\",\n      });\n    },\n  });\n\n  // WebSocket connection\n  const connectWebSocket = (sessionId: string) => {\n    if (wsRef.current) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const ws = new WebSocket(`${protocol}//${window.location.host}/collab-ws`);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      ws.send(JSON.stringify({ type: \"join\", sessionId }));\n      fetchParticipants(sessionId);\n      fetchWhiteboard(sessionId);\n    };\n\n    ws.onmessage = (event) => {\n      const msg = JSON.parse(event.data);\n      console.log(\"[WebSocket] Received message:\", msg.type, msg);\n      handleWebSocketMessage(msg);\n    };\n\n    ws.onerror = (error) => {\n      console.error(\"WebSocket error:\", error);\n    };\n\n    ws.onclose = () => {\n      wsRef.current = null;\n    };\n  };\n\n  const disconnectWebSocket = () => {\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"leave\",\n        sessionId: activeSession.id,\n      }));\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n  };\n\n  const handleWebSocketMessage = (msg: any) => {\n    switch (msg.type) {\n      case \"participant_joined\":\n      case \"participant_left\":\n      case \"participant_muted\":\n      case \"participant_kicked\":\n        if (activeSession) {\n          fetchParticipants(activeSession.id);\n        }\n        break;\n      case \"tab_switch\":\n        if (msg.userId === user?.id) {\n          setTabSwitchCount(msg.data.count);\n        }\n        break;\n      case \"break_started\":\n        setIsOnBreak(true);\n        setBreakTimeLeft(msg.data.duration);\n        break;\n      case \"break_ended\":\n        setIsOnBreak(false);\n        setBreakTimeLeft(0);\n        break;\n      case \"whiteboard_update\":\n        setWhiteboardContent(msg.data);\n        renderCanvas(msg.data);\n        break;\n      case \"concentration_toggled\":\n        console.log(\"Received concentration_toggled:\", msg.data.enabled);\n        if (activeSession) {\n          console.log(\"Updating activeSession concentrationMode from\", activeSession.concentrationMode, \"to\", msg.data.enabled);\n          setActiveSession({ ...activeSession, concentrationMode: msg.data.enabled });\n        } else {\n          console.log(\"No activeSession, cannot update concentration mode\");\n        }\n        break;\n      case \"chat_message\":\n        setChatMessages(prev => [...prev, msg.data]);\n        setTimeout(() => {\n          chatScrollRef.current?.scrollIntoView({ behavior: \"smooth\" });\n        }, 100);\n        break;\n      case \"action_blocked\":\n        toast({\n          title: \"Action Blocked\",\n          description: msg.data.reason,\n          variant: \"destructive\",\n        });\n        break;\n    }\n  };\n\n  const fetchParticipants = async (sessionId: string) => {\n    try {\n      const response = await fetch(`/api/collab/sessions/${sessionId}/participants`, {\n        credentials: \"include\",\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setParticipants(data);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch participants:\", error);\n    }\n  };\n\n  const fetchWhiteboard = async (sessionId: string) => {\n    try {\n      const response = await fetch(`/api/collab/sessions/${sessionId}/whiteboard`, {\n        credentials: \"include\",\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setWhiteboardContent(data.content);\n        renderCanvas(data.content);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch whiteboard:\", error);\n    }\n  };\n\n  const saveWhiteboard = async (content: any) => {\n    if (!activeSession) return;\n    try {\n      const wbRes = await fetch(`/api/collab/sessions/${activeSession.id}/whiteboard`, {\n        credentials: \"include\",\n      });\n      if (wbRes.ok) {\n        const whiteboard = await wbRes.json();\n        await fetch(`/api/collab/whiteboards/${whiteboard.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          credentials: \"include\",\n          body: JSON.stringify({ content }),\n        });\n      }\n    } catch (error) {\n      console.error(\"Failed to save whiteboard:\", error);\n    }\n  };\n\n  // Canvas drawing\n  const startDrawing = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!canvasRef.current) return;\n    setIsDrawing(true);\n    const rect = canvasRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    // Broadcast drawing state to show active user\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"drawing_state\",\n        sessionId: activeSession.id,\n        data: { isDrawing: true, tool: drawTool, color: drawColor, size: drawSize },\n      }));\n    }\n    \n    const newContent = {\n      ...whiteboardContent,\n      elements: [...whiteboardContent.elements, { \n        type: \"path\", \n        tool: drawTool,\n        color: drawColor, \n        size: drawSize,\n        points: [{ x, y }] \n      }],\n    };\n    setWhiteboardContent(newContent);\n  };\n\n  const draw = (e: React.MouseEvent<HTMLCanvasElement>) => {\n    if (!isDrawing || !canvasRef.current) return;\n    \n    const rect = canvasRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    const newContent = { ...whiteboardContent };\n    const lastElement = newContent.elements[newContent.elements.length - 1];\n    if (lastElement && lastElement.type === \"path\") {\n      lastElement.points.push({ x, y });\n    }\n    setWhiteboardContent(newContent);\n    renderCanvas(newContent);\n    \n    // Broadcast to other participants\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"whiteboard_update\",\n        sessionId: activeSession.id,\n        data: newContent,\n      }));\n    }\n  };\n\n  const stopDrawing = () => {\n    if (isDrawing && activeSession) {\n      setIsDrawing(false);\n      \n      // Broadcast stopped drawing state\n      if (wsRef.current && activeSession) {\n        wsRef.current.send(JSON.stringify({\n          type: \"drawing_state\",\n          sessionId: activeSession.id,\n          data: { isDrawing: false, tool: drawTool, color: drawColor, size: drawSize },\n        }));\n      }\n      \n      // Schedule auto-save (10 seconds after drawing stops)\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n      autoSaveTimerRef.current = setTimeout(() => {\n        saveWhiteboard(whiteboardContent);\n      }, 10000);\n    }\n  };\n\n  const renderCanvas = (content: any) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    \n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n    \n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    \n    content.elements?.forEach((element: any) => {\n      if (element.type === \"path\" && element.points?.length > 0) {\n        const tool = element.tool || \"pen\";\n        const size = element.size || 2;\n        \n        if (tool === \"eraser\") {\n          ctx.globalCompositeOperation = \"destination-out\";\n          ctx.strokeStyle = \"rgba(0,0,0,1)\";\n        } else if (tool === \"highlighter\") {\n          ctx.globalCompositeOperation = \"source-over\";\n          ctx.strokeStyle = element.color || \"#ffff00\";\n          ctx.globalAlpha = 0.3;\n        } else {\n          ctx.globalCompositeOperation = \"source-over\";\n          ctx.strokeStyle = element.color || \"#000000\";\n          ctx.globalAlpha = 1.0;\n        }\n        \n        ctx.lineWidth = size;\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        ctx.beginPath();\n        ctx.moveTo(element.points[0].x, element.points[0].y);\n        element.points.forEach((point: any) => {\n          ctx.lineTo(point.x, point.y);\n        });\n        ctx.stroke();\n        \n        // Reset for next element\n        ctx.globalAlpha = 1.0;\n        ctx.globalCompositeOperation = \"source-over\";\n      }\n    });\n  };\n\n  const clearCanvas = () => {\n    const newContent = { elements: [] };\n    setWhiteboardContent(newContent);\n    renderCanvas(newContent);\n    saveWhiteboard(newContent);\n    \n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"whiteboard_update\",\n        sessionId: activeSession.id,\n        data: newContent,\n      }));\n    }\n  };\n\n  const sendChatMessage = () => {\n    if (!chatInput.trim() || !wsRef.current || !activeSession) return;\n    \n    wsRef.current.send(JSON.stringify({\n      type: \"chat_message\",\n      sessionId: activeSession.id,\n      data: { content: chatInput },\n    }));\n    \n    setChatInput(\"\");\n  };\n\n  // Tab visibility detection\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden && activeSession && wsRef.current) {\n        wsRef.current.send(JSON.stringify({\n          type: \"tab_switch\",\n          sessionId: activeSession.id,\n        }));\n      }\n    };\n\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n  }, [activeSession]);\n\n  // Break timer countdown\n  useEffect(() => {\n    if (isOnBreak && breakTimeLeft > 0) {\n      const interval = setInterval(() => {\n        setBreakTimeLeft(prev => {\n          if (prev <= 1) {\n            setIsOnBreak(false);\n            return 0;\n          }\n          return prev - 1;\n        });\n      }, 1000);\n      return () => clearInterval(interval);\n    }\n  }, [isOnBreak, breakTimeLeft]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      disconnectWebSocket();\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n    };\n  }, []);\n\n  const copySessionCode = () => {\n    if (activeSession) {\n      navigator.clipboard.writeText(activeSession.sessionCode);\n      toast({\n        title: \"Copied!\",\n        description: \"Session code copied to clipboard\",\n      });\n    }\n  };\n\n  const startBreak = (minutes: number) => {\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"break_start\",\n        sessionId: activeSession.id,\n        data: { duration: minutes * 60 },\n      }));\n    }\n  };\n\n  const toggleConcentrationMode = () => {\n    if (wsRef.current && activeSession) {\n      console.log(\"Toggling concentration mode from\", activeSession.concentrationMode, \"to\", !activeSession.concentrationMode);\n      wsRef.current.send(JSON.stringify({\n        type: \"concentration_toggle\",\n        sessionId: activeSession.id,\n        data: { enabled: !activeSession.concentrationMode },\n      }));\n    } else {\n      console.log(\"Cannot toggle - wsRef:\", !!wsRef.current, \"activeSession:\", !!activeSession);\n    }\n  };\n\n  const kickParticipant = (targetUserId: string) => {\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"kick_participant\",\n        sessionId: activeSession.id,\n        data: { targetUserId },\n      }));\n    }\n  };\n\n  const muteAll = () => {\n    if (wsRef.current && activeSession) {\n      wsRef.current.send(JSON.stringify({\n        type: \"mute_all\",\n        sessionId: activeSession.id,\n      }));\n    }\n  };\n\n  const isHost = activeSession && user && activeSession.hostUserId === user.id;\n\n  if (!user) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <Card className=\"p-6\">\n          <p className=\"text-muted-foreground\">Please log in to access collaboration features.</p>\n        </Card>\n      </div>\n    );\n  }\n\n  if (activeSession) {\n    return (\n      <div className=\"h-full flex flex-col p-4 gap-4\" data-testid=\"collab-active-session\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\" data-testid=\"text-session-title\">{activeSession.title}</h1>\n            <div className=\"flex items-center gap-2 mt-1\">\n              <Badge variant=\"secondary\" data-testid=\"badge-session-code\">\n                Code: {activeSession.sessionCode}\n              </Badge>\n              <Button size=\"icon\" variant=\"ghost\" onClick={copySessionCode} data-testid=\"button-copy-code\">\n                <Copy className=\"h-4 w-4\" />\n              </Button>\n              {isHost && (\n                <Badge variant=\"outline\" data-testid=\"badge-host\">Host</Badge>\n              )}\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            {isHost && (\n              <>\n                <Button\n                  variant=\"outline\"\n                  onClick={toggleConcentrationMode}\n                  data-testid=\"button-toggle-concentration\"\n                >\n                  {activeSession.concentrationMode ? <EyeOff className=\"h-4 w-4 mr-2\" /> : <Eye className=\"h-4 w-4 mr-2\" />}\n                  {activeSession.concentrationMode ? \"Disable\" : \"Enable\"} Focus Mode\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={muteAll}\n                  data-testid=\"button-mute-all\"\n                >\n                  <VolumeX className=\"h-4 w-4 mr-2\" />\n                  Mute All\n                </Button>\n              </>\n            )}\n            <Button\n              variant=\"destructive\"\n              onClick={() => endSessionMutation.mutate(activeSession.id)}\n              data-testid=\"button-end-session\"\n            >\n              End Session\n            </Button>\n          </div>\n        </div>\n\n        {/* Break Timer Alert */}\n        {isOnBreak && (\n          <Card className=\"p-4 bg-yellow-50 dark:bg-yellow-950 border-yellow-200 dark:border-yellow-800\">\n            <div className=\"flex items-center gap-3\">\n              <Bell className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400\" />\n              <div className=\"flex-1\">\n                <p className=\"font-semibold text-yellow-900 dark:text-yellow-100\">Break Time</p>\n                <p className=\"text-sm text-yellow-700 dark:text-yellow-300\">\n                  Time remaining: {Math.floor(breakTimeLeft / 60)}:{(breakTimeLeft % 60).toString().padStart(2, '0')}\n                </p>\n              </div>\n            </div>\n          </Card>\n        )}\n\n        <div className=\"flex-1 grid grid-cols-3 gap-4 min-h-0\">\n          {/* Whiteboard */}\n          <Card className=\"col-span-2 flex flex-col\">\n            <div className=\"p-4 border-b space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <h2 className=\"font-semibold\">Collaborative Whiteboard</h2>\n                <Button size=\"sm\" variant=\"outline\" onClick={clearCanvas} data-testid=\"button-clear-canvas\">\n                  Clear\n                </Button>\n              </div>\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <div className=\"flex gap-1\">\n                  <Button\n                    size=\"sm\"\n                    variant={drawTool === \"pen\" ? \"default\" : \"outline\"}\n                    onClick={() => setDrawTool(\"pen\")}\n                    data-testid=\"button-tool-pen\"\n                  >\n                    <Pen className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={drawTool === \"eraser\" ? \"default\" : \"outline\"}\n                    onClick={() => setDrawTool(\"eraser\")}\n                    data-testid=\"button-tool-eraser\"\n                  >\n                    <Eraser className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={drawTool === \"highlighter\" ? \"default\" : \"outline\"}\n                    onClick={() => setDrawTool(\"highlighter\")}\n                    data-testid=\"button-tool-highlighter\"\n                  >\n                    <Highlighter className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                <Separator orientation=\"vertical\" className=\"h-6\" />\n                <div className=\"flex gap-1\">\n                  {[1, 2, 4, 8].map((size) => (\n                    <Button\n                      key={size}\n                      size=\"sm\"\n                      variant={drawSize === size ? \"default\" : \"outline\"}\n                      onClick={() => setDrawSize(size)}\n                      data-testid={`button-size-${size}`}\n                    >\n                      {size}px\n                    </Button>\n                  ))}\n                </div>\n                <Separator orientation=\"vertical\" className=\"h-6\" />\n                <Input\n                  type=\"color\"\n                  value={drawColor}\n                  onChange={(e) => setDrawColor(e.target.value)}\n                  className=\"w-12 h-9\"\n                  data-testid=\"input-draw-color\"\n                />\n              </div>\n            </div>\n            <div className=\"flex-1 p-4\">\n              <canvas\n                ref={canvasRef}\n                width={800}\n                height={500}\n                className=\"border rounded-md w-full h-full cursor-crosshair bg-white dark:bg-gray-900\"\n                onMouseDown={startDrawing}\n                onMouseMove={draw}\n                onMouseUp={stopDrawing}\n                onMouseLeave={stopDrawing}\n                data-testid=\"canvas-whiteboard\"\n              />\n            </div>\n          </Card>\n\n          {/* Participants & Controls */}\n          <div className=\"flex flex-col gap-4\">\n            {/* Tab Switch Counter */}\n            {activeSession.concentrationMode && (\n              <Card className=\"p-4\">\n                <div className=\"text-center\">\n                  <p className=\"text-sm text-muted-foreground\">Your Tab Switches</p>\n                  <p className=\"text-3xl font-bold text-primary\" data-testid=\"text-tab-switches\">{tabSwitchCount}</p>\n                </div>\n              </Card>\n            )}\n\n            {/* Break Timer Controls */}\n            <Card className=\"p-4\">\n              <h3 className=\"font-semibold mb-3\">Break Timer</h3>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button size=\"sm\" onClick={() => startBreak(5)} data-testid=\"button-break-5\">\n                  <Clock className=\"h-4 w-4 mr-1\" />\n                  5 min\n                </Button>\n                <Button size=\"sm\" onClick={() => startBreak(10)} data-testid=\"button-break-10\">\n                  <Clock className=\"h-4 w-4 mr-1\" />\n                  10 min\n                </Button>\n                <Button size=\"sm\" onClick={() => startBreak(15)} data-testid=\"button-break-15\">\n                  <Clock className=\"h-4 w-4 mr-1\" />\n                  15 min\n                </Button>\n                <Button size=\"sm\" onClick={() => startBreak(20)} data-testid=\"button-break-20\">\n                  <Clock className=\"h-4 w-4 mr-1\" />\n                  20 min\n                </Button>\n              </div>\n            </Card>\n\n            {/* Participants List */}\n            <Card className=\"flex-1 flex flex-col\">\n              <div className=\"p-4 border-b\">\n                <h3 className=\"font-semibold flex items-center gap-2\">\n                  <Users className=\"h-4 w-4\" />\n                  Participants ({participants.length})\n                </h3>\n              </div>\n              <ScrollArea className=\"flex-1\">\n                <div className=\"p-4 space-y-2\">\n                  {participants.map((participant) => (\n                    <div\n                      key={participant.id}\n                      className=\"flex items-center justify-between p-2 rounded-md hover-elevate\"\n                      data-testid={`participant-${participant.userId}`}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                          <span className=\"text-xs font-semibold\">\n                            {participant.user?.firstName?.[0]}{participant.user?.lastName?.[0]}\n                          </span>\n                        </div>\n                        <div>\n                          <p className=\"text-sm font-medium\">\n                            {participant.user?.firstName} {participant.user?.lastName}\n                          </p>\n                          {participant.role === \"host\" && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">Host</Badge>\n                          )}\n                        </div>\n                      </div>\n                      {isHost && participant.userId !== user.id && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => kickParticipant(participant.userId)}\n                          data-testid={`button-kick-${participant.userId}`}\n                        >\n                          <UserX className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            </Card>\n\n            {/* Group Chat */}\n            <Card className=\"flex-1 flex flex-col\">\n              <div className=\"p-4 border-b\">\n                <h3 className=\"font-semibold\">Group Chat</h3>\n              </div>\n              <ScrollArea className=\"flex-1 max-h-64\">\n                <div className=\"p-4 space-y-3\">\n                  {chatMessages.map((msg) => (\n                    <div key={msg.id} className=\"space-y-1\" data-testid={`chat-message-${msg.id}`}>\n                      <div className=\"flex items-baseline gap-2\">\n                        <span className=\"text-sm font-medium\">{msg.userName}</span>\n                        <span className=\"text-xs text-muted-foreground\">\n                          {new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                        </span>\n                      </div>\n                      <p className=\"text-sm\">{msg.content}</p>\n                    </div>\n                  ))}\n                  <div ref={chatScrollRef} />\n                </div>\n              </ScrollArea>\n              <div className=\"p-4 border-t\">\n                <div className=\"flex gap-2\">\n                  <Input\n                    placeholder=\"Type a message...\"\n                    value={chatInput}\n                    onChange={(e) => setChatInput(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" && !e.shiftKey) {\n                        e.preventDefault();\n                        sendChatMessage();\n                      }\n                    }}\n                    data-testid=\"input-chat-message\"\n                  />\n                  <Button\n                    size=\"icon\"\n                    onClick={sendChatMessage}\n                    disabled={!chatInput.trim()}\n                    data-testid=\"button-send-chat\"\n                  >\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-4xl mx-auto py-8\" data-testid=\"collab-lobby\">\n      <div className=\"text-center mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Study Collaboration</h1>\n        <p className=\"text-muted-foreground\">\n          Create or join a study session with friends. Share a whiteboard, track focus, and take synchronized breaks.\n        </p>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-4 mb-8\">\n        <Dialog open={createDialogOpen} onOpenChange={setCreateDialogOpen}>\n          <DialogTrigger asChild>\n            <Card className=\"p-6 cursor-pointer hover-elevate active-elevate-2\" data-testid=\"card-create-session\">\n              <div className=\"text-center\">\n                <Plus className=\"h-12 w-12 mx-auto mb-3 text-primary\" />\n                <h3 className=\"font-semibold mb-2\">Create Session</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Start a new collaboration session and invite friends\n                </p>\n              </div>\n            </Card>\n          </DialogTrigger>\n          <DialogContent data-testid=\"dialog-create-session\">\n            <DialogHeader>\n              <DialogTitle>Create Collaboration Session</DialogTitle>\n              <DialogDescription>\n                Enter a title for your study session. You'll get a code to share with friends.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"session-title\">Session Title</Label>\n                <Input\n                  id=\"session-title\"\n                  placeholder=\"e.g., Math Study Group\"\n                  value={sessionTitle}\n                  onChange={(e) => setSessionTitle(e.target.value)}\n                  data-testid=\"input-session-title\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                onClick={() => createSessionMutation.mutate(sessionTitle)}\n                disabled={!sessionTitle.trim() || createSessionMutation.isPending}\n                data-testid=\"button-create-confirm\"\n              >\n                {createSessionMutation.isPending ? \"Creating...\" : \"Create Session\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={joinDialogOpen} onOpenChange={setJoinDialogOpen}>\n          <DialogTrigger asChild>\n            <Card className=\"p-6 cursor-pointer hover-elevate active-elevate-2\" data-testid=\"card-join-session\">\n              <div className=\"text-center\">\n                <LogIn className=\"h-12 w-12 mx-auto mb-3 text-primary\" />\n                <h3 className=\"font-semibold mb-2\">Join Session</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Enter a session code to join your friends\n                </p>\n              </div>\n            </Card>\n          </DialogTrigger>\n          <DialogContent data-testid=\"dialog-join-session\">\n            <DialogHeader>\n              <DialogTitle>Join Collaboration Session</DialogTitle>\n              <DialogDescription>\n                Enter the session code shared by your friend to join.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"session-code\">Session Code</Label>\n                <Input\n                  id=\"session-code\"\n                  placeholder=\"e.g., ABC123XYZ\"\n                  value={sessionCode}\n                  onChange={(e) => setSessionCode(e.target.value.toUpperCase())}\n                  data-testid=\"input-session-code\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                onClick={() => joinSessionMutation.mutate(sessionCode)}\n                disabled={!sessionCode.trim() || joinSessionMutation.isPending}\n                data-testid=\"button-join-confirm\"\n              >\n                {joinSessionMutation.isPending ? \"Joining...\" : \"Join Session\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* My Sessions */}\n      {mySessions && mySessions.length > 0 && (\n        <div>\n          <h2 className=\"text-xl font-semibold mb-4\">Your Recent Sessions</h2>\n          <div className=\"space-y-2\">\n            {mySessions.slice(0, 5).map((session) => (\n              <Card key={session.id} className=\"p-4 flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium\" data-testid={`text-session-${session.id}-title`}>{session.title}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {session.isActive ? (\n                      <Badge variant=\"default\">Active</Badge>\n                    ) : (\n                      <span>Ended {new Date(session.endedAt!).toLocaleString()}</span>\n                    )}\n                  </p>\n                </div>\n                {session.isActive && (\n                  <Button\n                    size=\"sm\"\n                    onClick={() => {\n                      setActiveSession(session);\n                      connectWebSocket(session.id);\n                    }}\n                    data-testid={`button-rejoin-${session.id}`}\n                  >\n                    Rejoin\n                  </Button>\n                )}\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":34362},"client/src/components/MindMapCanvas.tsx":{"content":"import { useCallback, useEffect, useMemo, useState } from 'react';\nimport ReactFlow, {\n  Node,\n  Edge,\n  Controls,\n  Background,\n  useNodesState,\n  useEdgesState,\n  BackgroundVariant,\n  Position,\n  NodeProps,\n  Handle,\n  useReactFlow,\n  ReactFlowProvider,\n} from 'reactflow';\nimport dagre from 'dagre';\nimport 'reactflow/dist/style.css';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface MindMapNode {\n  id: string;\n  label: string;\n  children?: MindMapNode[];\n}\n\ninterface MindMapData {\n  nodes: MindMapNode;\n}\n\ninterface MindMapCanvasProps {\n  data: MindMapData;\n}\n\ninterface CollapsibleNodeData {\n  label: string;\n  hasChildren: boolean;\n  isCollapsed: boolean;\n  onToggleCollapse: () => void;\n}\n\nconst calculateNodeWidth = (label: string): number => {\n  const minWidth = 180;\n  const maxWidth = 400;\n  const charWidth = 8;\n  const padding = 60;\n  const calculatedWidth = label.length * charWidth + padding;\n  return Math.min(Math.max(calculatedWidth, minWidth), maxWidth);\n};\n\nconst nodeHeight = 60;\n\nconst CollapsibleNode = ({ data }: NodeProps<CollapsibleNodeData>) => {\n  return (\n    <div className=\"relative\">\n      <Handle type=\"target\" position={Position.Left} className=\"!bg-primary !w-2 !h-2\" />\n      <div className=\"flex items-center gap-2 px-4 py-3 bg-card dark:bg-card border-2 border-border dark:border-border rounded-lg shadow-sm hover-elevate max-w-[400px]\">\n        {data.hasChildren && (\n          <button\n            onClick={data.onToggleCollapse}\n            className=\"flex-shrink-0 w-6 h-6 flex items-center justify-center hover:bg-accent dark:hover:bg-accent rounded-md transition-colors\"\n            data-testid=\"button-collapse-toggle\"\n          >\n            {data.isCollapsed ? (\n              <ChevronRight className=\"h-4 w-4 text-foreground dark:text-foreground\" />\n            ) : (\n              <ChevronLeft className=\"h-4 w-4 text-foreground dark:text-foreground\" />\n            )}\n          </button>\n        )}\n        <span className=\"text-sm font-medium text-foreground dark:text-foreground leading-tight\">\n          {data.label}\n        </span>\n      </div>\n      <Handle type=\"source\" position={Position.Right} className=\"!bg-primary !w-2 !h-2\" />\n    </div>\n  );\n};\n\nconst nodeTypes = {\n  collapsible: CollapsibleNode,\n};\n\nconst getLayoutedElements = (nodes: Node[], edges: Edge[]) => {\n  const dagreGraph = new dagre.graphlib.Graph();\n  dagreGraph.setDefaultEdgeLabel(() => ({}));\n  dagreGraph.setGraph({ \n    rankdir: 'LR',\n    nodesep: 80,\n    ranksep: 180,\n    edgesep: 50,\n  });\n\n  nodes.forEach((node) => {\n    const width = node.width || calculateNodeWidth((node.data as CollapsibleNodeData).label);\n    dagreGraph.setNode(node.id, { width, height: nodeHeight });\n  });\n\n  edges.forEach((edge) => {\n    dagreGraph.setEdge(edge.source, edge.target);\n  });\n\n  dagre.layout(dagreGraph);\n\n  const layoutedNodes = nodes.map((node) => {\n    const nodeWithPosition = dagreGraph.node(node.id);\n    const width = node.width || calculateNodeWidth((node.data as CollapsibleNodeData).label);\n    return {\n      ...node,\n      position: {\n        x: nodeWithPosition.x - width / 2,\n        y: nodeWithPosition.y - nodeHeight / 2,\n      },\n      style: {\n        width: `${width}px`,\n      },\n    };\n  });\n\n  return { nodes: layoutedNodes, edges };\n};\n\nconst transformToReactFlow = (\n  rootNode: MindMapNode,\n  collapsedNodes: Set<string>,\n  onToggleCollapse: (nodeId: string) => void,\n  parentId: string | null = null\n): { nodes: Node[]; edges: Edge[] } => {\n  const nodes: Node[] = [];\n  const edges: Edge[] = [];\n\n  const traverse = (node: MindMapNode, parent: string | null, level: number = 0) => {\n    const nodeId = node.id;\n    const isCollapsed = collapsedNodes.has(nodeId);\n    const hasChildren = node.children && node.children.length > 0;\n    const nodeLabel = node.label || '';\n\n    nodes.push({\n      id: nodeId,\n      type: 'collapsible',\n      data: {\n        label: nodeLabel,\n        hasChildren: !!hasChildren,\n        isCollapsed,\n        onToggleCollapse: () => onToggleCollapse(nodeId),\n      },\n      position: { x: 0, y: 0 },\n      width: calculateNodeWidth(nodeLabel),\n    });\n\n    if (parent) {\n      edges.push({\n        id: `${parent}-${nodeId}`,\n        source: parent,\n        target: nodeId,\n        type: 'smoothstep',\n        style: { \n          stroke: 'hsl(var(--border))',\n          strokeWidth: 2,\n        },\n        animated: false,\n      });\n    }\n\n    if (hasChildren && !isCollapsed) {\n      node.children!.forEach((child) => traverse(child, nodeId, level + 1));\n    }\n  };\n\n  traverse(rootNode, parentId);\n  return { nodes, edges };\n};\n\nfunction MindMapCanvasInner({ data }: MindMapCanvasProps) {\n  const [collapsedNodes, setCollapsedNodes] = useState<Set<string>>(new Set());\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\n  const { fitView } = useReactFlow();\n\n  const handleToggleCollapse = useCallback((nodeId: string) => {\n    setCollapsedNodes((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(nodeId)) {\n        newSet.delete(nodeId);\n      } else {\n        newSet.add(nodeId);\n      }\n      return newSet;\n    });\n  }, []);\n\n  useEffect(() => {\n    if (!data?.nodes) return;\n\n    const { nodes: flowNodes, edges: flowEdges } = transformToReactFlow(\n      data.nodes,\n      collapsedNodes,\n      handleToggleCollapse\n    );\n\n    const { nodes: layoutedNodes, edges: layoutedEdges } = getLayoutedElements(\n      flowNodes,\n      flowEdges\n    );\n\n    setNodes(layoutedNodes);\n    setEdges(layoutedEdges);\n  }, [data, collapsedNodes, handleToggleCollapse, setNodes, setEdges]);\n\n  const handleFitView = useCallback(() => {\n    fitView({ padding: 0.2, duration: 300 });\n  }, [fitView]);\n\n  const handleExpandAll = useCallback(() => {\n    setCollapsedNodes(new Set());\n  }, []);\n\n  const handleCollapseAll = useCallback(() => {\n    if (!data?.nodes) return;\n    const allNodeIds = new Set<string>();\n    const traverse = (node: MindMapNode) => {\n      if (node.children && node.children.length > 0) {\n        allNodeIds.add(node.id);\n        node.children.forEach(traverse);\n      }\n    };\n    traverse(data.nodes);\n    setCollapsedNodes(allNodeIds);\n  }, [data]);\n\n  return (\n    <div className=\"relative w-full h-[600px] bg-background dark:bg-background border border-border dark:border-border rounded-lg overflow-hidden\">\n      <div className=\"absolute top-4 left-4 z-10 flex gap-2\">\n        <Button\n          size=\"sm\"\n          variant=\"secondary\"\n          onClick={handleFitView}\n          data-testid=\"button-fit-view\"\n        >\n          Fit View\n        </Button>\n        <Button\n          size=\"sm\"\n          variant=\"secondary\"\n          onClick={handleExpandAll}\n          data-testid=\"button-expand-all\"\n        >\n          Expand All\n        </Button>\n        <Button\n          size=\"sm\"\n          variant=\"secondary\"\n          onClick={handleCollapseAll}\n          data-testid=\"button-collapse-all\"\n        >\n          Collapse All\n        </Button>\n      </div>\n      <ReactFlow\n        nodes={nodes}\n        edges={edges}\n        onNodesChange={onNodesChange}\n        onEdgesChange={onEdgesChange}\n        nodeTypes={nodeTypes}\n        fitView\n        fitViewOptions={{ padding: 0.2 }}\n        minZoom={0.1}\n        maxZoom={2}\n        defaultEdgeOptions={{\n          type: 'smoothstep',\n        }}\n        proOptions={{ hideAttribution: true }}\n      >\n        <Background \n          variant={BackgroundVariant.Dots} \n          gap={16} \n          size={1} \n          className=\"bg-background dark:bg-background\" \n          color=\"hsl(var(--border))\"\n        />\n        <Controls className=\"bg-card dark:bg-card border border-border dark:border-border\" />\n      </ReactFlow>\n    </div>\n  );\n}\n\nexport function MindMapCanvas(props: MindMapCanvasProps) {\n  return (\n    <ReactFlowProvider>\n      <MindMapCanvasInner {...props} />\n    </ReactFlowProvider>\n  );\n}\n","size_bytes":8025},"server/textUtils.ts":{"content":"/**\n * Sanitize text by removing markdown formatting\n * Converts markdown to plain text while preserving readability\n */\nexport function sanitizeMarkdown(text: string): string {\n  if (!text) return text;\n\n  let sanitized = text;\n\n  // Remove bold markers (**text** or __text__)\n  sanitized = sanitized.replace(/\\*\\*(.+?)\\*\\*/g, '$1');\n  sanitized = sanitized.replace(/__(.+?)__/g, '$1');\n\n  // Remove italic markers (*text* or _text_)\n  sanitized = sanitized.replace(/\\*(.+?)\\*/g, '$1');\n  sanitized = sanitized.replace(/_(.+?)_/g, '$1');\n\n  // Remove strikethrough (~~text~~)\n  sanitized = sanitized.replace(/~~(.+?)~~/g, '$1');\n\n  // Remove code blocks (```code```)\n  sanitized = sanitized.replace(/```[\\s\\S]*?```/g, (match) => {\n    // Extract just the code content without the backticks\n    return match.replace(/```(\\w+)?\\n?/g, '').replace(/```/g, '');\n  });\n\n  // Remove inline code (`code`)\n  sanitized = sanitized.replace(/`(.+?)`/g, '$1');\n\n  // Convert headers to plain text with proper spacing\n  sanitized = sanitized.replace(/^#{1,6}\\s+(.+)$/gm, '$1\\n');\n\n  // Remove link syntax but keep the text [text](url) -> text\n  sanitized = sanitized.replace(/\\[(.+?)\\]\\(.+?\\)/g, '$1');\n\n  // Remove image syntax ![alt](url)\n  sanitized = sanitized.replace(/!\\[.*?\\]\\(.+?\\)/g, '');\n\n  // Remove bullet points and list markers\n  sanitized = sanitized.replace(/^[\\*\\-\\+]\\s+/gm, 'â¢ ');\n  sanitized = sanitized.replace(/^\\d+\\.\\s+/gm, (match) => {\n    const num = match.match(/\\d+/);\n    return num ? `${num[0]}. ` : 'â¢ ';\n  });\n\n  // Remove blockquote markers\n  sanitized = sanitized.replace(/^>\\s+/gm, '');\n\n  // Remove horizontal rules\n  sanitized = sanitized.replace(/^[-*_]{3,}$/gm, '');\n\n  // Clean up excessive whitespace\n  sanitized = sanitized.replace(/\\n{3,}/g, '\\n\\n');\n  sanitized = sanitized.trim();\n\n  return sanitized;\n}\n\n/**\n * Sanitize user input to prevent injection or formatting issues\n */\nexport function sanitizeUserInput(text: string): string {\n  if (!text) return text;\n\n  // Trim whitespace\n  let sanitized = text.trim();\n\n  // Remove null bytes and control characters except newlines and tabs\n  sanitized = sanitized.replace(/[\\x00-\\x08\\x0B-\\x0C\\x0E-\\x1F\\x7F]/g, '');\n\n  // Limit consecutive newlines to 2\n  sanitized = sanitized.replace(/\\n{3,}/g, '\\n\\n');\n\n  return sanitized;\n}\n\n/**\n * Sanitize text for text-to-speech\n * Removes markdown and converts special characters/symbols to readable text\n */\nexport function sanitizeForAudio(text: string): string {\n  if (!text) return text;\n\n  // First remove all markdown\n  let sanitized = sanitizeMarkdown(text);\n\n  // Convert common math symbols to words\n  sanitized = sanitized.replace(/â/g, 'sum');\n  sanitized = sanitized.replace(/â«/g, 'integral');\n  sanitized = sanitized.replace(/â/g, 'partial derivative');\n  sanitized = sanitized.replace(/â/g, 'delta');\n  sanitized = sanitized.replace(/Ï/g, 'pi');\n  sanitized = sanitized.replace(/Î±/g, 'alpha');\n  sanitized = sanitized.replace(/Î²/g, 'beta');\n  sanitized = sanitized.replace(/Î³/g, 'gamma');\n  sanitized = sanitized.replace(/Î¸/g, 'theta');\n  sanitized = sanitized.replace(/Î»/g, 'lambda');\n  sanitized = sanitized.replace(/Î¼/g, 'mu');\n  sanitized = sanitized.replace(/Ï/g, 'sigma');\n  sanitized = sanitized.replace(/Ï/g, 'omega');\n  sanitized = sanitized.replace(/Î£/g, 'Sigma');\n  sanitized = sanitized.replace(/Î©/g, 'Omega');\n  \n  // Convert math operators to words\n  sanitized = sanitized.replace(/â/g, 'approximately equals');\n  sanitized = sanitized.replace(/â /g, 'not equals');\n  sanitized = sanitized.replace(/â¤/g, 'less than or equal to');\n  sanitized = sanitized.replace(/â¥/g, 'greater than or equal to');\n  sanitized = sanitized.replace(/Ã/g, 'times');\n  sanitized = sanitized.replace(/Ã·/g, 'divided by');\n  sanitized = sanitized.replace(/Â±/g, 'plus or minus');\n  sanitized = sanitized.replace(/â/g, 'square root of');\n  sanitized = sanitized.replace(/â/g, 'infinity');\n  \n  // Convert common special characters\n  sanitized = sanitized.replace(/Â°/g, ' degrees');\n  sanitized = sanitized.replace(/Â©/g, 'copyright');\n  sanitized = sanitized.replace(/Â®/g, 'registered');\n  sanitized = sanitized.replace(/â¢/g, 'trademark');\n  sanitized = sanitized.replace(/â¬/g, 'euros');\n  sanitized = sanitized.replace(/Â£/g, 'pounds');\n  sanitized = sanitized.replace(/Â¥/g, 'yen');\n  \n  // Replace multiple consecutive special chars with single space\n  sanitized = sanitized.replace(/[^\\w\\s.,!?;:()\\-'\"]/g, ' ');\n  \n  // Clean up excessive whitespace\n  sanitized = sanitized.replace(/\\s+/g, ' ');\n  sanitized = sanitized.replace(/\\n{3,}/g, '\\n\\n');\n  sanitized = sanitized.trim();\n\n  return sanitized;\n}\n\n/**\n * Recursively sanitize mind map node labels\n */\nexport function sanitizeMindMapNode(node: any): any {\n  if (!node) return node;\n  return {\n    ...node,\n    label: sanitizeMarkdown(node.label || \"\"),\n    children: (node.children || []).map(sanitizeMindMapNode),\n  };\n}\n","size_bytes":4943}},"version":2}